"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1129],{1688:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var s=a(4848),o=a(8453);const i={},t=void 0,l={id:"integrations/aave/specification",title:"specification",description:"Especificaci\xf3n",source:"@site/docs/integrations/aave/specification.md",sourceDirName:"integrations/aave",slug:"/integrations/aave/specification",permalink:"/lido-docs-spanish/integrations/aave/specification",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/integrations/aave/specification.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Subgraph",permalink:"/lido-docs-spanish/integrations/subgraph"},next:{title:"aip",permalink:"/lido-docs-spanish/integrations/aave/aip"}},r={},d=[{value:"Especificaci\xf3n",id:"especificaci\xf3n",level:2},{value:"Token AStETH",id:"token-asteth",level:2},{value:"Tokens StableDebtSTETH y VariableDebtSTETH",id:"tokens-stabledebtsteth-y-variabledebtsteth",level:2},{value:"Controlador de Incentivos",id:"controlador-de-incentivos",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"especificaci\xf3n",children:"Especificaci\xf3n"}),"\n",(0,s.jsx)(n.p,{children:"El objetivo principal de la integraci\xf3n es proporcionar la capacidad de depositar stETH en AAVE y permitir su uso como colateral. No se supone que se permita el pr\xe9stamo de stETH (tanto estable como variable). La motivaci\xf3n detr\xe1s de este dise\xf1o es fomentar el uso de stETH como colateral en lugar de pedirlo prestado. stETH est\xe1 vinculado de manera estable a ETH, por lo que usarlo como colateral implica bajos riesgos de liquidaci\xf3n."}),"\n",(0,s.jsx)(n.p,{children:"El stETH se implementa como un token de rebase. En condiciones normales, los saldos de los usuarios se actualizan una vez al d\xeda con el informe del Oracle. En el fondo, stETH almacena los saldos de los usuarios como acciones del tenedor en la cantidad total de ether controlada por el protocolo Lido. stETH tiene un par de m\xe9todos para convertir acciones internas en saldos y viceversa:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"/// @return the amount of ether that corresponds to `_sharesAmount` token shares.\nfunction getPooledEthByShares(uint256 _sharesAmount) public view returns (uint256);\n\n/// @return the amount of shares that corresponds to `_ethAmount` protocol-controlled ether.\nfunction getSharesByPooledEth(uint256 _ethAmount) public view returns (uint256);\n"})}),"\n",(0,s.jsx)(n.p,{children:"El aSTETH, de manera similar a los aTokens regulares, es un token generador de recompensas que se acu\xf1a y quema en los dep\xf3sitos y retiros en el LendingPool. El valor de aSTETH est\xe1 vinculado al valor del token depositado correspondiente en una proporci\xf3n de 1:1 y puede almacenarse, transferirse o negociarse de manera segura. Todos los intereses recaudados por la reserva de aSTETH (de rebase y recompensas AAVE) se distribuyen directamente a los tenedores de aTokens mediante el aumento continuo de su saldo en la cartera (en caso de rebases negativos de stETH, podr\xeda disminuir)."}),"\n",(0,s.jsx)(n.p,{children:"La implementaci\xf3n de aSTETH garantiza lo siguiente:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"En cualquier momento, un usuario puede depositar X stETH para acu\xf1ar X aSTETH *"}),"\nLa oferta total de aSTETH aumenta en X."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"En cualquier momento, un usuario puede quemar x aSTETH por x stETH *"}),"\nLa oferta total de aSTETH disminuye en x."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"En cualquier momento, el usuarioA puede transferir X aSTETH al usuarioB *"}),"\nEl saldo de aSTETH del usuarioA se reduce en X.\nEl saldo de aSTETH del usuarioB aumenta en X.\nLa oferta total de aSTETH sigue siendo exactamente la misma."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cuando stETH hace rebase, aSTETH tambi\xe9n hace rebase."}),"\nSupongamos que hay 1000 stETH bloqueados en la reserva. Consideremos las siguientes situaciones:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Caso com\xfan: ocurre un rebase positivo y la oferta total de stETH aumenta en un 1%:"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"La oferta total del token aSTETH se vuelve igual a 1010 aSTETH."}),"\n",(0,s.jsx)(n.li,{children:"El saldo de cada tenedor de aSTETH tambi\xe9n aumenta en un 1%."}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Caso raro: ocurre un rebase negativo y la oferta total de stETH disminuye en un 1%:"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"La oferta total del token aSTETH se vuelve igual a 990 aSTETH."}),"\n",(0,s.jsx)(n.li,{children:"El saldo de cada tenedor de aSTETH tambi\xe9n disminuye en un 1%."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"*"})," La cantidad real de tokens ser\xe1 menor o igual a X debido a operaciones de redondeo enteras de la tasa de rebase del token subyacente y la tasa de inter\xe9s de AAVE. Sin embargo, el error de redondeo real no exceder\xe1 un par de WEI en ning\xfan momento."]}),"\n",(0,s.jsx)(n.h2,{id:"token-asteth",children:"Token AStETH"}),"\n",(0,s.jsxs)(n.p,{children:["Para implementar la l\xf3gica anterior, el contrato ",(0,s.jsx)(n.code,{children:"AStETH"})," modifica la implementaci\xf3n del aToken predeterminado pero se mantiene lo m\xe1s cercano posible al contrato original. Al igual que el contrato ",(0,s.jsx)(n.code,{children:"AToken"})," predeterminado, hereda de los contratos ",(0,s.jsx)(n.code,{children:"VersionedInitializable"})," y ",(0,s.jsx)(n.code,{children:"IncentivizedERC20"})," e implementa la interfaz ",(0,s.jsx)(n.code,{children:"IAToken"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"El aToken predeterminado implementa la interfaz ERC20 pero tiene dos m\xe9todos espec\xedficos:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"scaledBalanceOf(user)"})," - Devuelve el ",(0,s.jsx)(n.strong,{children:"saldo escalado"})," del usuario como un ",(0,s.jsx)(n.code,{children:"uint256"}),". El saldo escalado es el saldo del token subyacente del usuario (cantidad depositada), dividido por el \xedndice de liquidez actual en el momento de la actualizaci\xf3n. $scaledBalance = amountDeposited/currentLiquidityIndex$\nEsto esencialmente 'marca' cuando un usuario ha depositado en el pool de reservas y puede usarse para calcular el saldo actual compuesto de aToken del usuario.\nEjemplo:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"El usuario A deposita 1000 DAI con un \xedndice de liquidez de 1.1"}),"\n",(0,s.jsx)(n.li,{children:"El usuario B deposita otra cantidad en el mismo pool"}),"\n",(0,s.jsx)(n.li,{children:"El \xedndice de liquidez ahora es 1.2"}),"\n",(0,s.jsx)(n.li,{children:"Por lo tanto, para calcular el saldo compuesto actual de aToken del usuario A, se debe realizar la operaci\xf3n inversa: $aTokenBalance = scaledBalance*currentLiquidityIndex$"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"scaledTotalSupply()"})," - Devuelve la oferta total escalada del aToken como ",(0,s.jsx)(n.code,{children:"uint256"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Pero el enfoque anterior no puede usarse con el token stETH sin modificaciones porque no toma en consideraci\xf3n los rebases de stETH."}),"\n",(0,s.jsx)(n.p,{children:"Si se aplican las ecuaciones anteriores a stETH tal cual, el beneficio del staking no se distribuir\xe1 entre los tenedores de aSTETH, sino que se acumular\xe1 en el saldo del token aSTETH."}),"\n",(0,s.jsxs)(n.p,{children:["Para hacer que el beneficio de los rebases sea contable, ",(0,s.jsx)(n.code,{children:"AStETH"})," introduce un \xedndice adicional - ",(0,s.jsx)(n.strong,{children:"\xedndice de rebase de stETH"}),". El \xedndice de rebase de stETH expresa las recompensas de los rebases del token stETH en el tiempo. El \xedndice de rebase de stETH puede calcularse de la siguiente manera:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"function _stEthRebasingIndex() returns (uint256) {\n  // Below expression returns how much ether corresponds\n  // to 10 ** 27 shares. 10 ** 27 was taken  to provide\n  // same precision as AAVE's liquidity index, which\n  // counted in RAY's (decimals with 27 digits).\n  return stETH.getPooledEthByShares(WadRayMath.RAY);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Con el \xedndice de rebase de stETH, ",(0,s.jsx)(n.code,{children:"AStETH"})," permite que el beneficio de los rebases sea contable, aplicando un escalado adicional cuando ocurre la acu\xf1aci\xf3n o quema del token:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"function mint(address user, uint256 amount, uint256 liquidityIndex) {\n    ...\n    uint256 stEthRebasingIndex = _stEthRebasingIndex();\n    _mint(user, _toInternalAmount(amount, stEthRebasingIndex, liquidityIndex));\n    ...\n}\n\nfunction burn(address user, uint256 amount, uint256 liquidityIndex) {\n    ...\n    uint256 stEthRebasingIndex = _stEthRebasingIndex();\n    _burn(user, _toInternalAmount(amount, stEthRebasingIndex, liquidityIndex));\n    ...\n}\n\nfunction _toInternalAmount(\n    uint256 amount,\n    uint256 stEthRebasingIndex,\n    uint256 aaveLiquidityIndex\n  ) internal view returns (uint256) {\n    return amount.mul(WadRayMath.RAY).div(stEthRebasingIndex).rayDiv(aaveLiquidityIndex);\n  }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Luego, de acuerdo con las definiciones de AAVE, ",(0,s.jsx)(n.code,{children:"scaledTotalSupply()"})," y ",(0,s.jsx)(n.code,{children:"scaledBalanceOf()"})," pueden calcularse como:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"function scaledTotalSupply() returns (uint256) {\n  return _totalSupply.mul(_stEthRebasingIndex()).div(WadRayMath.RAY);\n}\n\nfunction scaledBalanceOf(address user) returns (uint256) {\n  return _balances[user].mul(_stEthRebasingIndex()).div(WadRayMath.RAY);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Adem\xe1s, el contrato ",(0,s.jsx)(n.code,{children:"AStETH"})," introduce los siguientes m\xe9todos:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"internalBalanceOf(user)"})," - devuelve el ",(0,s.jsx)(n.strong,{children:"saldo interno"})," del usuario. El saldo interno es el saldo del token subyacente del usuario (suma de los dep\xf3sitos del usuario), dividido por el \xedndice de liquidez actual en el momento de la actualizaci\xf3n y por el \xedndice de rebase de stETH actual."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"internalTotalSupply()"})," - Devuelve la oferta total interna del aSTETH."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-solidity",children:"function internalTotalSupply(address user) returns (uint256) {\n  return _totalSupply;\n}\n\nfunction internalBalanceOf(address user) returns (uint256) {\n  return _balances[user];\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tokens-stabledebtsteth-y-variabledebtsteth",children:"Tokens StableDebtSTETH y VariableDebtSTETH"}),"\n",(0,s.jsxs)(n.p,{children:["La integraci\xf3n actual no soporta pr\xe9stamos, ni con tasas de inter\xe9s variables ni estables. Debido a esto, los contratos StableDebtSTETH y VariableDebtSTETH extienden los contratos ",(0,s.jsx)(n.code,{children:"StableDebtToken"})," y ",(0,s.jsx)(n.code,{children:"VariableDebtToken"})," predeterminados, respectivamente, y anulan el m\xe9todo ",(0,s.jsx)(n.code,{children:"mint()"})," con un stub, que revierte con el error ",(0,s.jsx)(n.code,{children:"CONTRACT_NOT_ACTIVE"}),". Esto se hizo para hacer imposible el uso de pr\xe9stamos con aSTETH porque los tokens de deuda predeterminados no son compatibles con el contrato ",(0,s.jsx)(n.code,{children:"AStETH"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["En el futuro, se puede activar el pr\xe9stamo actualizando la implementaci\xf3n de los tokens de deuda. Pero los contratos ",(0,s.jsx)(n.code,{children:"StableDebtToken"})," y ",(0,s.jsx)(n.code,{children:"VariableDebtToken"})," ",(0,s.jsx)(n.strong,{children:"NO DEBEN"})," usarse con ",(0,s.jsx)(n.code,{children:"AStETH"})," porque no toman en consideraci\xf3n los rebases del token stETH y romper\xe1n la matem\xe1tica de la integraci\xf3n."]}),"\n",(0,s.jsx)(n.h2,{id:"controlador-de-incentivos",children:"Controlador de Incentivos"}),"\n",(0,s.jsxs)(n.p,{children:["Al inicio de la integraci\xf3n de stETH en el protocolo AAVE, no se supone que se use el controlador de incentivos. Si en el futuro Lido decide agregar incentivos a la integraci\xf3n, puede hacerse actualizando la implementaci\xf3n del token aSTETH. El ejemplo de implementaci\xf3n del ",(0,s.jsx)(n.code,{children:"IncentivesController"})," para el contrato ",(0,s.jsx)(n.code,{children:"AStETH"})," puede encontrarse aqu\xed: ",(0,s.jsx)(n.a,{href:"https://github.com/lidofinance/aave-asteth-incentives-controller",children:"https://github.com/lidofinance/aave-asteth-incentives-controller"})]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>l});var s=a(6540);const o={},i=s.createContext(o);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);