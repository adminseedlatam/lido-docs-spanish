"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2951],{8751:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>o});var n=t(4848),r=t(8453);const i={},d="ValidatorsExitBusOracle",a={id:"contracts/validators-exit-bus-oracle",title:"ValidatorsExitBusOracle",description:"- Source code",source:"@site/docs/contracts/validators-exit-bus-oracle.md",sourceDirName:"contracts",slug:"/contracts/validators-exit-bus-oracle",permalink:"/lido-docs-spanish/contracts/validators-exit-bus-oracle",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/validators-exit-bus-oracle.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"AccountingOracle",permalink:"/lido-docs-spanish/contracts/accounting-oracle"},next:{title:"HashConsensus",permalink:"/lido-docs-spanish/contracts/hash-consensus"}},l={},o=[{value:"What is ValidatorsExitBusOracle",id:"what-is-validatorsexitbusoracle",level:2},{value:"Report cycle",id:"report-cycle",level:2},{value:"Report data",id:"report-data",level:2},{value:"Constants",id:"constants",level:2},{value:"DATA_FORMAT_LIST()",id:"data_format_list",level:3},{value:"SECONDS_PER_SLOT()",id:"seconds_per_slot",level:3},{value:"GENESIS_TIME()",id:"genesis_time",level:3},{value:"PAUSE_INFINITELY()",id:"pause_infinitely",level:3},{value:"ProcessingState",id:"processingstate",level:2},{value:"View methods",id:"view-methods",level:2},{value:"getTotalRequestsProcessed()",id:"gettotalrequestsprocessed",level:3},{value:"getLastRequestedValidatorIndices()",id:"getlastrequestedvalidatorindices",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Reverts",id:"reverts",level:4},{value:"getProcessingState()",id:"getprocessingstate",level:3},{value:"getConsensusContract()",id:"getconsensuscontract",level:3},{value:"getConsensusReport()",id:"getconsensusreport",level:3},{value:"getConsensusVersion()",id:"getconsensusversion",level:3},{value:"getContractVersion()",id:"getcontractversion",level:3},{value:"getLastProcessingRefSlot()",id:"getlastprocessingrefslot",level:3},{value:"Returns",id:"returns",level:4},{value:"getResumeSinceTimestamp()",id:"getresumesincetimestamp",level:3},{value:"isPaused()",id:"ispaused",level:3},{value:"Methods",id:"methods",level:2},{value:"submitReportData()",id:"submitreportdata",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"Reverts",id:"reverts-1",level:4},{value:"pauseFor()",id:"pausefor",level:3},{value:"Parameters",id:"parameters-2",level:4},{value:"Reverts",id:"reverts-2",level:4},{value:"pauseUntil()",id:"pauseuntil",level:3},{value:"Parameters",id:"parameters-3",level:4},{value:"Reverts",id:"reverts-3",level:4},{value:"resume()",id:"resume",level:3},{value:"Reverts",id:"reverts-4",level:4},{value:"Permissions",id:"permissions",level:2},{value:"SUBMIT_DATA_ROLE()",id:"submit_data_role",level:3},{value:"PAUSE_ROLE()",id:"pause_role",level:3},{value:"RESUME_ROLE()",id:"resume_role",level:3},{value:"MANAGE_CONSENSUS_CONTRACT_ROLE()",id:"manage_consensus_contract_role",level:3},{value:"MANAGE_CONSENSUS_VERSION_ROLE()",id:"manage_consensus_version_role",level:3},{value:"Events",id:"events",level:2},{value:"ValidatorExitRequest()",id:"validatorexitrequest",level:3},{value:"WarnDataIncompleteProcessing()",id:"warndataincompleteprocessing",level:3},{value:"Paused()",id:"paused",level:3},{value:"Resumed()",id:"resumed",level:3}];function c(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"validatorsexitbusoracle",children:"ValidatorsExitBusOracle"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/oracle/ValidatorsExitBusOracle.sol",children:"Source code"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://etherscan.io/address/0x0De4Ea0184c2ad0BacA7183356Aea5B8d5Bf5c6e",children:"Deployed contract"})}),"\n",(0,n.jsxs)(s.li,{children:["Inherits ",(0,n.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/oracle/BaseOracle.sol",children:"BaseOracle"})]}),"\n"]}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["It's advised to read ",(0,n.jsx)(s.a,{href:"/guides/oracle-operator-manual#intro",children:"What is Lido Oracle mechanism"})," before"]})}),"\n",(0,n.jsx)(s.h2,{id:"what-is-validatorsexitbusoracle",children:"What is ValidatorsExitBusOracle"}),"\n",(0,n.jsx)(s.p,{children:'A contract that implements an on-chain "source of truth" message bus between the protocol\'s off-chain oracle and off-chain observers,\nwith the main goal of delivering validator exit requests to the Lido-participating node operators.'}),"\n",(0,n.jsx)(s.p,{children:"A report calculation consists of 4 key steps:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Calculate withdrawals amount to cover with ether."}),"\n",(0,n.jsx)(s.li,{children:"Calculate ether rewards prediction per epoch."}),"\n",(0,n.jsx)(s.li,{children:"Calculate withdrawal epoch for next validator eligible for exit to cover withdrawal requests if needed"}),"\n",(0,n.jsx)(s.li,{children:"Prepare validators exit order queue"}),"\n",(0,n.jsx)(s.li,{children:"Go through the queue until the exited validators\u2019 balances cover all withdrawal requests (considering the predicated final exited balance of each validator)."}),"\n"]}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsxs)(s.p,{children:["Placed exit requests via ",(0,n.jsx)(s.code,{children:"ValidatorsExitBusOracle"})," should be processed timely according to the ratified ",(0,n.jsx)(s.a,{href:"https://snapshot.org/#/lido-snapshot.eth/proposal/0xa4eb1220a15d46a1825d5a0f44de1b34644d4aa6bb95f910b86b29bb7654e330",children:"Lido on Ethereum Validator Exits Policy V1.0"}),"."]})}),"\n",(0,n.jsxs)(s.p,{children:["Access to lever methods is restricted using the functionality of the\n",(0,n.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/utils/access/AccessControlEnumerable.sol",children:"AccessControlEnumerable"}),"\ncontract and a bunch of ",(0,n.jsx)(s.a,{href:"#permissions",children:"granular roles"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"report-cycle",children:"Report cycle"}),"\n",(0,n.jsx)(s.p,{children:"The oracle work is delineated by equal time periods called frames. In normal operation, oracles finalize a report in each frame (the frame duration is 75 Ethereum Consensus Layer epochs, each frame starts at ~04:00, ~12:00, ~20:00 UTC). Each frame has a reference slot and processing deadline. Report data is gathered by looking at the world state (both Ethereum Execution and Consensus Layers) at the moment of the frame's reference slot (including any state changes made in that slot), and must be processed before the frame's processing deadline."}),"\n",(0,n.jsx)(s.p,{children:"Reference slot for each frame is set to the last slot of the epoch preceding the frame's first epoch. The processing deadline is set to the last slot of the last epoch of the frame."}),"\n",(0,n.jsxs)(s.p,{children:["It's worth noting that frame length ",(0,n.jsx)(s.a,{href:"./hash-consensus#setframeconfig",children:"can be changed"}),". And if oracle report is delayed it does not extend the report period, unless it's missed. In this case, the next report will have the report period increased."]}),"\n",(0,n.jsx)(s.p,{children:"The frame includes these stages:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Waiting"})," - oracle starts as a ",(0,n.jsx)(s.a,{href:"/guides/oracle-operator-manual#the-oracle-daemon",children:"daemon"})," and wakes up every 12 seconds (by default) in order to find the last finalized slot, trying to collate with it with the expected reference slot;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Data collection"}),": oracles monitor the state of both the execution and consensus layers and collect the data for the successfully arrived finalized reference slot;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Hash consensus"}),": oracles analyze the report data, compile the report and submit its hash to the ",(0,n.jsx)(s.a,{href:"/contracts/hash-consensus",children:"HashConsensus"})," smart contract;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Core update report"}),": once the ",(0,n.jsx)(s.a,{href:"./hash-consensus#getquorum",children:"quorum"})," of hashes is reached, meaning more than half of the oracles submitted the same hash (i.e., 5 of 9 oracle committee members at the moment of writing), one of the oracles chosen in turn submits the actual report to the ",(0,n.jsx)(s.code,{children:"ValidatorsExitBusOracle"})," contract, which triggers a chain of the ",(0,n.jsx)(s.a,{href:"#validatorexitrequest",children:(0,n.jsx)(s.code,{children:"ValidatorExitRequest"})})," events containing details about the next validators to be ejected (to initiate a voluntary exit from the Ethereum Consensus Layer side)."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"report-data",children:"Report data"}),"\n",(0,n.jsxs)(s.p,{children:["The function ",(0,n.jsx)(s.code,{children:"submitReportData()"})," accepts the following ",(0,n.jsx)(s.code,{children:"ReportData"})," structure."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"struct ReportData {\n    uint256 consensusVersion;\n    uint256 refSlot;\n    uint256 requestsCount;\n    uint256 dataFormat;\n    bytes data;\n}\n"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Oracle consensus info"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"consensusVersion"})," \u2014 Version of the oracle consensus rules. A current version expected by the oracle can be obtained by calling ",(0,n.jsx)(s.code,{children:"getConsensusVersion()"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"refSlot"})," \u2014 Reference slot for which the report was calculated. The state being reported must include all state changes resulting from the all blocks up to this reference slot (inclusive). The epoch containing the slot must be finalized prior to calculating the report."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Requests data"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"requestsCount"})," \u2014 Total number of validator exit requests in this report. Must not be greater\nthan the limit enforced by ",(0,n.jsx)(s.code,{children:"OracleReportSanityChecker.checkExitBusOracleReport"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dataFormat"})," \u2014 Format of the validator exit requests data. Currently, only the ",(0,n.jsx)(s.code,{children:"DATA_FORMAT_LIST=1"})," value is supported."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"data"})," \u2014 Validator exit requests data. Can differ based on the data format, see the constant defining a specific data format ",(0,n.jsx)(s.a,{href:"#data_format_list",children:"here"})," for more info."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"constants",children:"Constants"}),"\n",(0,n.jsx)(s.h3,{id:"data_format_list",children:"DATA_FORMAT_LIST()"}),"\n",(0,n.jsx)(s.p,{children:"The list format of the validator exit requests data."}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Each validator exit request is described by the following 64-byte array:"}),(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"    MSB <------------------------------------------------------- LSB\n    |  3 bytes   |  5 bytes   |     8 bytes      |    48 bytes     |\n    |  moduleId  |  nodeOpId  |  validatorIndex  | validatorPubkey |\n"})}),(0,n.jsxs)(s.p,{children:["All requests are tightly packed into a byte array where requests follow\none another without any separator or padding, and passed to the ",(0,n.jsx)(s.code,{children:"data"}),"\nfield of the report structure."]}),(0,n.jsxs)(s.p,{children:["Requests must be sorted in the ascending order by the following compound\nkey: ",(0,n.jsx)(s.code,{children:"(moduleId, nodeOpId, validatorIndex)"}),"."]})]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"uint256 public constant DATA_FORMAT_LIST = 1\n"})}),"\n",(0,n.jsx)(s.h3,{id:"seconds_per_slot",children:"SECONDS_PER_SLOT()"}),"\n",(0,n.jsxs)(s.p,{children:["See ",(0,n.jsx)(s.a,{href:"https://ethereum.org/en/developers/docs/blocks/#block-time",children:"https://ethereum.org/en/developers/docs/blocks/#block-time"})]}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsxs)(s.p,{children:["always returns 12 seconds due to ",(0,n.jsx)(s.a,{href:"https://ethereum.org/en/roadmap/merge/",children:"the Merge"})]})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"uint256 public immutable SECONDS_PER_SLOT\n"})}),"\n",(0,n.jsx)(s.h3,{id:"genesis_time",children:"GENESIS_TIME()"}),"\n",(0,n.jsxs)(s.p,{children:["See ",(0,n.jsx)(s.a,{href:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21",children:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21"})]}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsxs)(s.p,{children:["always returns 1606824023 (December 1, 2020, 12:00:23pm UTC) on ",(0,n.jsx)(s.a,{href:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21",children:"Mainnet"})]})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"uint256 public immutable GENESIS_TIME\n"})}),"\n",(0,n.jsx)(s.h3,{id:"pause_infinitely",children:"PAUSE_INFINITELY()"}),"\n",(0,n.jsxs)(s.p,{children:["Special value for the infinite pause.\nSee ",(0,n.jsx)(s.a,{href:"#pausefor",children:(0,n.jsx)(s.code,{children:"pauseFor"})})," and ",(0,n.jsx)(s.a,{href:"#pauseuntil",children:(0,n.jsx)(s.code,{children:"pauseUntil"})}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"uint256 public constant PAUSE_INFINITELY = type(uint256).max\n"})}),"\n",(0,n.jsx)(s.h2,{id:"processingstate",children:"ProcessingState"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"struct ProcessingState {\n    uint256 currentFrameRefSlot;\n    uint256 processingDeadlineTime;\n    bytes32 dataHash;\n    bool dataSubmitted;\n    uint256 dataFormat;\n    uint256 requestsCount;\n    uint256 requestsSubmitted;\n}\n"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"currentFrameRefSlot"})," \u2014 Reference slot for the current reporting frame."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"processingDeadlineTime"})," \u2014 The last time at which a report data can be submitted for the current reporting frame."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dataHash"})," \u2014 Hash of the report data. Zero bytes if consensus on the hash hasn't been reached yet for the current reporting frame."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dataSubmitted"})," \u2014 Whether any report data for the for the current reporting frame has been already submitted."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dataFormat"})," \u2014 Format of the report data for the current reporting frame."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"requestsCount"})," \u2014 Total number of validator exit requests for the current reporting frame."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"requestsSubmitted"})," \u2014 How many validator exit requests are already submitted for the current reporting frame."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"view-methods",children:"View methods"}),"\n",(0,n.jsx)(s.h3,{id:"gettotalrequestsprocessed",children:"getTotalRequestsProcessed()"}),"\n",(0,n.jsx)(s.p,{children:"Returns the total number of validator exit requests ever processed across all received reports."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getTotalRequestsProcessed() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getlastrequestedvalidatorindices",children:"getLastRequestedValidatorIndices()"}),"\n",(0,n.jsxs)(s.p,{children:["Returns the latest validator indices that were requested to exit for the given\n",(0,n.jsx)(s.code,{children:"nodeOpIds"})," in the given ",(0,n.jsx)(s.code,{children:"moduleId"}),". For node operators that were never requested to exit\nany validator, index is set to ",(0,n.jsx)(s.code,{children:"-1"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getLastRequestedValidatorIndices(uint256 moduleId, uint256[] calldata nodeOpIds)\n        external view returns (int256[] memory)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"parameters",children:"Parameters"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Name"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"moduleId"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"ID of the staking module."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"nodeOpIds"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"IDs of the staking module's node operators."})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"reverts",children:"Reverts"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ArgumentOutOfBounds()"})," if ",(0,n.jsx)(s.code,{children:"moduleId > UINT24_MAX"})]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ArgumentOutOfBounds()"})," if ",(0,n.jsx)(s.code,{children:"nodeOpId > UINT40_MAX"})]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"getprocessingstate",children:"getProcessingState()"}),"\n",(0,n.jsxs)(s.p,{children:["Returns data processing state for the current reporting frame. See the docs for the ",(0,n.jsx)(s.a,{href:"#processingstate",children:"ProcessingState"})," struct."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getProcessingState() external view returns (ProcessingState memory result)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getconsensuscontract",children:"getConsensusContract()"}),"\n",(0,n.jsxs)(s.p,{children:["Returns the address of the ",(0,n.jsx)(s.a,{href:"/contracts/hash-consensus",children:"HashConsensus"})," contract instance used by ",(0,n.jsx)(s.code,{children:"ValidatorsExitBusOracle"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getConsensusContract() external view returns (address)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getconsensusreport",children:"getConsensusReport()"}),"\n",(0,n.jsx)(s.p,{children:"Returns the last consensus report hash and metadata."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getConsensusReport() external view returns (\n    bytes32 hash,\n    uint256 refSlot,\n    uint256 processingDeadlineTime,\n    bool processingStarted\n)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getconsensusversion",children:"getConsensusVersion()"}),"\n",(0,n.jsx)(s.p,{children:"Returns the current consensus version expected by the oracle contract."}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsx)(s.p,{children:"Consensus version must change every time consensus rules change, meaning that\nan oracle looking at the same reference slot would calculate a different hash."})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getConsensusVersion() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getcontractversion",children:"getContractVersion()"}),"\n",(0,n.jsx)(s.p,{children:"Returns the current contract version."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getContractVersion() public view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getlastprocessingrefslot",children:"getLastProcessingRefSlot()"}),"\n",(0,n.jsx)(s.p,{children:"Returns the last reference slot for which processing of the report was started."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getLastProcessingRefSlot() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"returns",children:"Returns"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Name"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"hash"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bytes32"})}),(0,n.jsx)(s.td,{children:"The last reported hash"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"refSlot"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"The frame's reference slot: if the data the consensus is being reached upon includes or depends on any onchain state, this state should be queried at the reference slot. If the slot contains a block, the state should include all changes from that block."})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"processingDeadlineTime"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Timestamp of the last slot at which a report can be reported and processed"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"processingStarted"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bool"})}),(0,n.jsx)(s.td,{children:"Has the processing of the report been started or not"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"getresumesincetimestamp",children:"getResumeSinceTimestamp()"}),"\n",(0,n.jsxs)(s.p,{children:["Returns one of the ",(0,n.jsx)(s.code,{children:"timestamp"})," values:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"PAUSE_INFINITELY"})," if paused permanently (i.e., with no expiration timestamp)"]}),"\n",(0,n.jsxs)(s.li,{children:["a first second when get contract get resumed if paused for specific duration (if ",(0,n.jsx)(s.code,{children:"timestamp \u2265 block.timestamp"}),")"]}),"\n",(0,n.jsxs)(s.li,{children:["some timestamp in past if not paused (if ",(0,n.jsx)(s.code,{children:"timestamp < block.timestamp"}),")"]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function getResumeSinceTimestamp() external view returns (uint256 timestamp)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"ispaused",children:"isPaused()"}),"\n",(0,n.jsx)(s.p,{children:"Returns whether the contract is paused or not at the moment."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function isPaused() public view returns (bool)\n"})}),"\n",(0,n.jsx)(s.h2,{id:"methods",children:"Methods"}),"\n",(0,n.jsx)(s.h3,{id:"submitreportdata",children:"submitReportData()"}),"\n",(0,n.jsx)(s.p,{children:"Submits report data for processing."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function submitReportData(ReportData calldata data, uint256 contractVersion)\n        external whenResumed\n"})}),"\n",(0,n.jsx)(s.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Name"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"data"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"ReportData"})}),(0,n.jsxs)(s.td,{children:["The report data. See ",(0,n.jsx)(s.a,{href:"#report-data",children:(0,n.jsx)(s.code,{children:"ReportData"})})," for details."]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contractVersion"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Expected version of the oracle contract."})]})]})]}),"\n",(0,n.jsx)(s.h4,{id:"reverts-1",children:"Reverts"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"SenderNotAllowed()"})," if the caller doesn't have a ",(0,n.jsx)(s.code,{children:"SUBMIT_DATA_ROLE"})," role and is not a member of the oracle committee."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"UnexpectedContractVersion(expectedVersion, version)"})," if the provided contract version differs from the current one."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"UnexpectedConsensusVersion(expectedConsensusVersion, consensusVersion)"})," if the provided consensus version differs from the expected one."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"UnexpectedRefSlot(report.refSlot, refSlot)"})," if the provided reference slot differs from the current consensus frame's one."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"UnexpectedDataHash(report.hash, hash)"})," if a ",(0,n.jsx)(s.code,{children:"keccak256"})," hash of the ABI-encoded data differs from the last hash."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"NoConsensusReportToProcess()"})," if the report hash data is ",(0,n.jsx)(s.code,{children:"0"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"RefSlotAlreadyProcessing()"})," if the report reference slot is equal to the previous processing reference slot."]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"InvalidRequestsData()"})," if ",(0,n.jsx)(s.code,{children:"moduleId"})," in the provided data is ",(0,n.jsx)(s.code,{children:"0"})]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"InvalidRequestsDataLength()"})," if the provided data is packed incorrectly"]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"UnexpectedRequestsDataLength()"})," if the length of the provided packed data is not equal ",(0,n.jsx)(s.code,{children:"data.requestsCount"})]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"InvalidRequestsDataSortOrder"})," when the provided data is not sorted"]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"NodeOpValidatorIndexMustIncrease(       uint256 moduleId,       uint256 nodeOpId,       uint256 prevRequestedValidatorIndex,       uint256 requestedValidatorIndex   )"})," if ",(0,n.jsx)(s.code,{children:"requested validator index <= last requested index"})," from the same module"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"pausefor",children:"pauseFor()"}),"\n",(0,n.jsx)(s.p,{children:"Pause accepting the reports data and forming new validator exit requests for the provided duration in seconds."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function pauseFor(uint256 _duration) external\n"})}),"\n",(0,n.jsx)(s.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Name"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"_duration"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsxs)(s.td,{children:["pause duration, seconds (use ",(0,n.jsx)(s.code,{children:"PAUSE_INFINITELY"})," for unlimited)"]})]})})]}),"\n",(0,n.jsx)(s.h4,{id:"reverts-2",children:"Reverts"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ResumedExpected()"})," if contract is already paused"]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"AccessControl:..."})," reason if sender has no ",(0,n.jsx)(s.code,{children:"PAUSE_ROLE"})]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ZeroPauseDuration()"})," if zero duration is passed"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"pauseuntil",children:"pauseUntil()"}),"\n",(0,n.jsx)(s.p,{children:"Pause accepting the reports data and forming new validator exit requests till the given timestamp (inclusive)."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function pauseUntil(uint256 _pauseUntilInclusive) external\n"})}),"\n",(0,n.jsx)(s.h4,{id:"parameters-3",children:"Parameters"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Name"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"_pauseUntilInclusive"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"the last second to pause until (inclusive)"})]})})]}),"\n",(0,n.jsx)(s.h4,{id:"reverts-3",children:"Reverts"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ResumeSinceInPast()"})," if the provided timestamp is in the past"]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"AccessControl:..."})," reason if the sender has no ",(0,n.jsx)(s.code,{children:"PAUSE_ROLE"})]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"ResumedExpected()"})," if the contract is already paused"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"resume",children:"resume()"}),"\n",(0,n.jsx)(s.p,{children:"Resume accepting the reports data and forming new validator exit requests."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function resume() external\n"})}),"\n",(0,n.jsx)(s.h4,{id:"reverts-4",children:"Reverts"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"PausedExpected()"})," if contract is already resumed (i.e., not paused)"]}),"\n",(0,n.jsxs)(s.li,{children:["Reverts with ",(0,n.jsx)(s.code,{children:"AccessControl:..."})," reason if the sender has no ",(0,n.jsx)(s.code,{children:"RESUME_ROLE"})]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"permissions",children:"Permissions"}),"\n",(0,n.jsx)(s.h3,{id:"submit_data_role",children:"SUBMIT_DATA_ROLE()"}),"\n",(0,n.jsx)(s.p,{children:"An ACL role granting the permission to submit the data for a committee report."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:'bytes32 public constant SUBMIT_DATA_ROLE = keccak256("SUBMIT_DATA_ROLE")\n'})}),"\n",(0,n.jsx)(s.h3,{id:"pause_role",children:"PAUSE_ROLE()"}),"\n",(0,n.jsx)(s.p,{children:"An ACL role granting the permission to pause accepting the reports data and forming new validator exit requests."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:'bytes32 public constant PAUSE_ROLE = keccak256("PAUSE_ROLE")\n'})}),"\n",(0,n.jsx)(s.h3,{id:"resume_role",children:"RESUME_ROLE()"}),"\n",(0,n.jsx)(s.p,{children:"An ACL role granting the permission to resume accepting the reports data and forming new validator exit requests."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:'bytes32 public constant RESUME_ROLE = keccak256("RESUME_ROLE")\n'})}),"\n",(0,n.jsx)(s.h3,{id:"manage_consensus_contract_role",children:"MANAGE_CONSENSUS_CONTRACT_ROLE()"}),"\n",(0,n.jsxs)(s.p,{children:["An ACL role granting the permission to set the consensus contract address by calling ",(0,n.jsx)(s.code,{children:"setConsensusContract"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:'bytes32 public constant MANAGE_CONSENSUS_CONTRACT_ROLE = keccak256("MANAGE_CONSENSUS_CONTRACT_ROLE");\n'})}),"\n",(0,n.jsx)(s.h3,{id:"manage_consensus_version_role",children:"MANAGE_CONSENSUS_VERSION_ROLE()"}),"\n",(0,n.jsxs)(s.p,{children:["An ACL role granting the permission to set the consensus version by calling ",(0,n.jsx)(s.code,{children:"setConsensusVersion"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:'bytes32 public constant MANAGE_CONSENSUS_VERSION_ROLE = keccak256("MANAGE_CONSENSUS_VERSION_ROLE");\n'})}),"\n",(0,n.jsx)(s.h2,{id:"events",children:"Events"}),"\n",(0,n.jsx)(s.h3,{id:"validatorexitrequest",children:"ValidatorExitRequest()"}),"\n",(0,n.jsx)(s.p,{children:"Emits when the new report data submitted for processing."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"event ValidatorExitRequest(\n    uint256 indexed stakingModuleId,\n    uint256 indexed nodeOperatorId,\n    uint256 indexed validatorIndex,\n    bytes validatorPubkey,\n    uint256 timestamp\n)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"warndataincompleteprocessing",children:"WarnDataIncompleteProcessing()"}),"\n",(0,n.jsx)(s.p,{children:"Emits on attempt of new data submission having not all of the items processed yet."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"event WarnDataIncompleteProcessing(\n    uint256 indexed refSlot,\n    uint256 requestsProcessed,\n    uint256 requestsCount\n)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"paused",children:"Paused()"}),"\n",(0,n.jsxs)(s.p,{children:["Emits when the contract is paused either by the ",(0,n.jsx)(s.code,{children:"pauseFor"})," or ",(0,n.jsx)(s.code,{children:"pauseUntil"})," calls."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"event Paused(uint256 duration)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"resumed",children:"Resumed()"}),"\n",(0,n.jsxs)(s.p,{children:["Emits when the contract is resumed by the ",(0,n.jsx)(s.code,{children:"resume"})," call."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"event Resumed()\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>d,x:()=>a});var n=t(6540);const r={},i=n.createContext(r);function d(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);