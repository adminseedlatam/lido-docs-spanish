"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1685],{5027:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>t});var a=s(4848),o=s(8453);const r={},d="AccountingOracle",i={id:"contracts/accounting-oracle",title:"AccountingOracle",description:"- C\xf3digo fuente",source:"@site/docs/contracts/accounting-oracle.md",sourceDirName:"contracts",slug:"/contracts/accounting-oracle",permalink:"/contracts/accounting-oracle",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/accounting-oracle.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"EIP712StETH",permalink:"/contracts/eip712-steth"},next:{title:"ValidatorsExitBusOracle",permalink:"/contracts/validators-exit-bus-oracle"}},l={},t=[{value:"\xbfQu\xe9 es AccountingOracle?",id:"qu\xe9-es-accountingoracle",level:2},{value:"Ciclo de reporte",id:"ciclo-de-reporte",level:2},{value:"Procesamiento de informes",id:"procesamiento-de-informes",level:2},{value:"Datos del informe",id:"datos-del-informe",level:2},{value:"Datos adicionales",id:"datos-adicionales",level:5},{value:"Acceso y permisos",id:"acceso-y-permisos",level:2},{value:"Constantes",id:"constantes",level:2},{value:"LIDO()",id:"lido",level:3},{value:"LOCATOR()",id:"locator",level:3},{value:"LEGACY_ORACLE()",id:"legacy_oracle",level:3},{value:"SECONDS_PER_SLOT()",id:"seconds_per_slot",level:3},{value:"GENESIS_TIME()",id:"genesis_time",level:3},{value:"EXTRA_DATA_TYPE_STUCK_VALIDATORS()",id:"extra_data_type_stuck_validators",level:3},{value:"EXTRA_DATA_TYPE_EXITED_VALIDATORS()",id:"extra_data_type_exited_validators",level:3},{value:"EXTRA_DATA_FORMAT_EMPTY()",id:"extra_data_format_empty",level:3},{value:"EXTRA_DATA_FORMAT_LIST()",id:"extra_data_format_list",level:3},{value:"ProcessingState",id:"processingstate",level:2},{value:"M\xe9todos de vista",id:"m\xe9todos-de-vista",level:2},{value:"getConsensusContract()",id:"getconsensuscontract",level:3},{value:"getConsensusReport()",id:"getconsensusreport",level:3},{value:"Returns",id:"returns",level:4},{value:"getConsensusVersion()",id:"getconsensusversion",level:3},{value:"getContractVersion()",id:"getcontractversion",level:3},{value:"getLastProcessingRefSlot()",id:"getlastprocessingrefslot",level:3},{value:"getProcessingState()",id:"getprocessingstate",level:3},{value:"M\xe9todos",id:"m\xe9todos",level:2},{value:"submitReportData()",id:"submitreportdata",level:3},{value:"Par\xe1metros",id:"par\xe1metros",level:4},{value:"Reverts",id:"reverts",level:4},{value:"submitReportExtraDataEmpty()",id:"submitreportextradataempty",level:3},{value:"Reverts",id:"reverts-1",level:4},{value:"submitReportExtraDataList()",id:"submitreportextradatalist",level:3},{value:"Par\xe1metros",id:"par\xe1metros-1",level:4},{value:"Reverts",id:"reverts-2",level:4},{value:"submitConsensusReport()",id:"submitconsensusreport",level:3},{value:"Par\xe1metros",id:"par\xe1metros-2",level:4},{value:"discardConsensusReport()",id:"discardconsensusreport",level:3},{value:"setConsensusContract()",id:"setconsensuscontract",level:3},{value:"setConsensusVersion()",id:"setconsensusversion",level:3},{value:"Permisos",id:"permisos",level:2},{value:"SUBMIT_DATA_ROLE()",id:"submit_data_role",level:3},{value:"MANAGE_CONSENSUS_CONTRACT_ROLE()",id:"manage_consensus_contract_role",level:3},{value:"MANAGE_CONSENSUS_VERSION_ROLE()",id:"manage_consensus_version_role",level:3},{value:"Eventos",id:"eventos",level:2},{value:"ExtraDataSubmitted()",id:"extradatasubmitted",level:3},{value:"WarnExtraDataIncompleteProcessing()",id:"warnextradataincompleteprocessing",level:3},{value:"ConsensusHashContractSet()",id:"consensushashcontractset",level:3},{value:"ConsensusVersionSet()",id:"consensusversionset",level:3},{value:"ReportSubmitted()",id:"reportsubmitted",level:3},{value:"ReportDiscarded()",id:"reportdiscarded",level:3},{value:"ProcessingStarted()",id:"processingstarted",level:3},{value:"WarnProcessingMissed()",id:"warnprocessingmissed",level:3},{value:"Reverts",id:"reverts-3",level:2},{value:"submitReportData()",id:"submitreportdata-1",level:3},{value:"Contratos AccountingOracle y BaseOracle",id:"contratos-accountingoracle-y-baseoracle",level:4},{value:"OracleReportSanityChecker",id:"oraclereportsanitychecker",level:4},{value:"StakingRouter",id:"stakingrouter",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"accountingoracle",children:"AccountingOracle"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/oracle/AccountingOracle.sol",children:"C\xf3digo fuente"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://etherscan.io/address/0x852deD011285fe67063a08005c71a85690503Cee",children:"Contrato desplegado"})}),"\n",(0,a.jsxs)(n.li,{children:["Hereda de ",(0,a.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/oracle/BaseOracle.sol",children:"BaseOracle"})]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Se recomienda leer ",(0,a.jsx)(n.a,{href:"/gu%C3%ADas/oracle-operator-manual#introducci%C3%B3n",children:"\xbfQu\xe9 es el mecanismo de Lido Oracle?"})," antes."]})}),"\n",(0,a.jsx)(n.h2,{id:"qu\xe9-es-accountingoracle",children:"\xbfQu\xe9 es AccountingOracle?"}),"\n",(0,a.jsxs)(n.p,{children:["AccountingOracle es un contrato que recopila informaci\xf3n enviada por los or\xe1culos fuera de la cadena sobre el estado de los validadores que participan en Lido y sus saldos, la cantidad de fondos acumulados en las b\xf3vedas del protocolo (es decir, ",(0,a.jsx)(n.a,{href:"./withdrawal-vault",children:"retiro"})," y ",(0,a.jsx)(n.a,{href:"./lido-execution-layer-rewards-vault",children:"recompensas de la capa de ejecuci\xf3n"}),"), el n\xfamero de validadores ",(0,a.jsx)(n.a,{href:"./staking-router#exited-and-stuck-validators",children:"salidos y atascados"}),", el n\xfamero de ",(0,a.jsx)(n.a,{href:"./withdrawal-queue-erc721#request",children:"solicitudes de retiro"})," que el protocolo puede procesar y distribuye las recompensas a los operadores de nodos."]}),"\n",(0,a.jsx)(n.h2,{id:"ciclo-de-reporte",children:"Ciclo de reporte"}),"\n",(0,a.jsx)(n.p,{children:"El trabajo del or\xe1culo se delimita por per\xedodos de tiempo iguales llamados marcos. En operaci\xf3n normal, los or\xe1culos finalizan un informe en cada marco (la duraci\xf3n del marco es de 225 \xe9pocas de la capa de consenso de Ethereum, cada marco comienza alrededor de las 12:00 del mediod\xeda UTC). Cada marco tiene un slot de referencia y un plazo de procesamiento. Los datos del informe se recopilan observando el estado mundial (tanto de las capas de ejecuci\xf3n como de consenso de Ethereum) en el momento del slot de referencia del marco (incluyendo cualquier cambio de estado realizado en ese slot), y deben procesarse antes del plazo de procesamiento del marco."}),"\n",(0,a.jsx)(n.p,{children:"El slot de referencia para cada marco se establece en el \xfaltimo slot de la \xe9poca que precede a la primera \xe9poca del marco. El plazo de procesamiento se establece en el \xfaltimo slot de la \xfaltima \xe9poca del marco."}),"\n",(0,a.jsxs)(n.p,{children:["Vale la pena se\xf1alar que la duraci\xf3n del marco ",(0,a.jsx)(n.a,{href:"./hash-consensus#setframeconfig",children:"puede cambiarse"}),". Y si el informe del or\xe1culo se retrasa, no extiende el per\xedodo del informe, a menos que se pierda. En este caso, el pr\xf3ximo informe tendr\xe1 el per\xedodo del informe incrementado."]}),"\n",(0,a.jsx)(n.p,{children:"El marco incluye estas etapas:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Esperando:"})," el or\xe1culo comienza como un ",(0,a.jsx)(n.a,{href:"/gu%C3%ADas/oracle-operator-manual#el-daemon-del-or%C3%A1culo",children:"daemon"})," y se despierta cada 12 segundos (por defecto) para encontrar el \xfaltimo slot finalizado, intentando colisionarlo con el slot de referencia esperado;"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Recopilaci\xf3n de datos:"})," los or\xe1culos monitorean el estado de ambas capas de ejecuci\xf3n y consenso y recopilan los datos para el slot de referencia finalizado que ha llegado con \xe9xito;"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consenso de hash:"})," los or\xe1culos analizan los datos, compilan el informe y env\xedan su hash al contrato inteligente ",(0,a.jsx)(n.a,{href:"./hash-consensus",children:(0,a.jsx)(n.code,{children:"HashConsensus"})}),";"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Informe de actualizaci\xf3n central:"})," una vez que se alcanza el ",(0,a.jsx)(n.a,{href:"./hash-consensus#getquorum",children:"qu\xf3rum"})," de hashes, lo que significa que m\xe1s de la mitad de los or\xe1culos enviaron el mismo hash (es decir, 5 de 9 miembros del comit\xe9 de or\xe1culos en el momento de escribir), uno de los or\xe1culos elegido a su vez env\xeda el informe real al contrato ",(0,a.jsx)(n.code,{children:"AccountingOracle"}),", lo que desencadena la actualizaci\xf3n del estado central del protocolo, incluyendo la rebase del token, la distribuci\xf3n de recompensas a los operadores de nodos, la finalizaci\xf3n de las solicitudes de retiro y la decisi\xf3n del modo del protocolo: si entrar en modo b\xfanker, y"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Informe de datos adicionales:"})," un informe adicional que lleva informaci\xf3n adicional que no es vital para la actualizaci\xf3n central se env\xeda a ",(0,a.jsx)(n.code,{children:"AccountingOracle"}),", y puede enviarse en partes (por ejemplo, estados de claves de operadores de nodos y datos de distribuci\xf3n de recompensas)."]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Como se dijo, los informes diarios del or\xe1culo no deben darse por sentados.\nLos daemons de los or\xe1culos podr\xedan dejar de enviar sus informes por per\xedodos prolongados en caso de no haber ",(0,a.jsx)(n.a,{href:"https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/#finality",children:"finalidad"})," en la capa de consenso de Ethereum.\nEsto resultar\xeda en \xfaltima instancia en la ausencia de informes del or\xe1culo y en la falta de rebases de stETH durante todo ese per\xedodo."]})}),"\n",(0,a.jsx)(n.h2,{id:"procesamiento-de-informes",children:"Procesamiento de informes"}),"\n",(0,a.jsxs)(n.p,{children:["La ",(0,a.jsx)(n.a,{href:"./accounting-oracle#submitreportdata",children:"env\xedo"})," del informe principal a ",(0,a.jsx)(n.code,{children:"AccountingOracle"})," desencadena los siguientes procesos en orden, aunque dentro de una \xfanica transacci\xf3n:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Actualizar el conteo de validadores salidos para cada m\xf3dulo de staking en StakingRouter;"}),"\n",(0,a.jsx)(n.li,{children:"Actualizar el estado de modo b\xfanker para WithdrawalQueue;"}),"\n",(0,a.jsx)(n.li,{children:"Manejar la funci\xf3n en el contrato Lido que realiza el cambio principal de estado del protocolo."}),"\n",(0,a.jsx)(n.li,{children:"Almacenar informaci\xf3n sobre ExtraData."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"El diagrama muestra la interacci\xf3n con los contratos."}),"\n",(0,a.jsx)(n.mermaid,{value:"graph LR;\n  A[/  \\]--submitReportData--\x3eAccountingOracle--handleConsensusLayerReport---\x3eLegacyOracle;\n  AccountingOracle--handleOracleReport--\x3eLido--handlePostTokenRebase--\x3eLegacyOracle\n  AccountingOracle--checkAccountingExtraDataListItemsCount--\x3eOracleReportSanityChecker;\n  AccountingOracle--updateExitedValidatorsCountByStakingModule--\x3eStakingRouter;\n  AccountingOracle--checkExitedValidatorsRatePerDay--\x3eOracleReportSanityChecker;\n  AccountingOracle--'onOracleReport'--\x3eWithdrawalQueue;"}),"\n",(0,a.jsx)(n.h2,{id:"datos-del-informe",children:"Datos del informe"}),"\n",(0,a.jsxs)(n.p,{children:["La funci\xf3n ",(0,a.jsx)(n.code,{children:"submitReportData()"})," acepta la siguiente estructura ",(0,a.jsx)(n.code,{children:"ReportData"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"struct ReportData {\n    uint256 consensusVersion;\n    uint256 refSlot;\n    uint256 numValidators;\n    uint256 clBalanceGwei;\n    uint256[] stakingModuleIdsWithNewlyExitedValidators;\n    uint256[] numExitedValidatorsByStakingModule;\n    uint256 withdrawalVaultBalance;\n    uint256 elRewardsVaultBalance;\n    uint256 sharesRequestedToBurn;\n    uint256[] withdrawalFinalizationBatches;\n    uint256 simulatedShareRate;\n    bool isBunkerMode;\n    uint256 extraDataFormat;\n    bytes32 extraDataHash;\n    uint256 extraDataItemsCount;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Informaci\xf3n de consenso del or\xe1culo"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"consensusVersion"})," \u2014 Versi\xf3n de las reglas de consenso del or\xe1culo. La versi\xf3n actual esperada por el or\xe1culo puede obtenerse llamando a ",(0,a.jsx)(n.code,{children:"getConsensusVersion()"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"refSlot"})," \u2014 Slot de referencia para el cual se calcul\xf3 el informe. El estado informado debe incluir todos los cambios de estado resultantes de todos los bloques hasta este slot de referencia (inclusive). La \xe9poca que contiene el slot debe estar finalizada antes de calcular el informe."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Valores de la CL"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"numValidators"})," \u2014 El n\xfamero de validadores en la capa de consenso de Ethereum que alguna vez fueron depositados a trav\xe9s de Lido, observado en el slot de referencia."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"clBalanceGwei"})," \u2014 Saldo acumulado nominado en gwei de todos los validadores de Lido en la capa de consenso de Ethereum observado en el slot de referencia."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"stakingModuleIdsWithNewlyExitedValidators"})," \u2014 IDs de m\xf3dulos de staking que tienen m\xe1s validadores salidos que el n\xfamero almacenado en el contrato del m\xf3dulo de staking respectivo, observado en el slot de referencia."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"numExitedValidatorsByStakingModule"})," \u2014 N\xfamero de validadores que han salido alguna vez para cada uno de los m\xf3dulos de staking del array ",(0,a.jsx)(n.code,{children:"stakingModuleIdsWithNewlyExitedValidators"}),", observado en el slot de referencia."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Valores de la EL"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"withdrawalVaultBalance"})," \u2014 Saldo en ether de la ",(0,a.jsx)(n.a,{href:"/contracts/withdrawal-vault",children:"b\xf3veda de retiros"})," de Lido observado en el slot de referencia."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"elRewardsVaultBalance"})," \u2014 Saldo en ether de la ",(0,a.jsx)(n.a,{href:"/contracts/lido-execution-layer-rewards-vault",children:"b\xf3veda de recompensas de la capa de ejecuci\xf3n"})," de Lido observado en el slot de referencia."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"sharesRequestedToBurn"})," \u2014 La cantidad de acciones solicitadas para quemar a trav\xe9s del ",(0,a.jsx)(n.a,{href:"/contracts/burner",children:"Burner"})," observado en el slot de referencia. El valor puede obtenerse de la siguiente manera:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"(coverSharesToBurn, nonCoverSharesToBurn) = IBurner(burner).getSharesRequestedToBurn()\nsharesRequestedToBurn = coverSharesToBurn + nonCoverSharesToBurn\n"})}),"\n",(0,a.jsx)(n.h1,{id:"decisi\xf3n-de-finalizaci\xf3n-de-retiros",children:"Decisi\xf3n de finalizaci\xf3n de retiros"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"withdrawalFinalizationBatches"})," \u2014 Array ordenado ascendentemente de IDs de solicitudes de retiro obtenidos por el daemon del or\xe1culo al recopilar el informe llamando a ",(0,a.jsx)(n.a,{href:"./withdrawal-queue-erc721#calculatefinalizationbatches",children:(0,a.jsx)(n.code,{children:"WithdrawalQueue.calculateFinalizationBatches"})}),". Un array vac\xedo significa que no hay solicitudes de retiro para finalizar."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"simulatedShareRate"})," \u2014 La tasa de participaci\xf3n (es decir, ",(0,a.jsx)(n.a,{href:"./lido#gettotalpooledether",children:"total de ether agrupado"})," dividido por ",(0,a.jsx)(n.a,{href:"./lido#gettotalshares",children:"total de acciones"}),") con una precisi\xf3n de 10^27 (es decir, multiplicado por 10^27) que ser\xeda efectiva como resultado de aplicar este informe del or\xe1culo en el slot de referencia, con ",(0,a.jsx)(n.code,{children:"withdrawalFinalizationBatches"})," establecido en array vac\xedo y ",(0,a.jsx)(n.code,{children:"simulatedShareRate"})," establecido en 0. Para estimar ",(0,a.jsx)(n.code,{children:"simulatedShareRate"})," se debe realizar una llamada de vista ",(0,a.jsx)(n.a,{href:"/contracts/lido#handleoraclereport",children:"Lido.handleOracleReport"})," directamente a trav\xe9s de la API JSON-RPC ",(0,a.jsx)(n.a,{href:"https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_call",children:(0,a.jsx)(n.code,{children:"eth_call"})})," y calcularlo de la siguiente manera:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"_simulatedShareRate = (postTotalPooledEther * 10**27) / postTotalShares\n"})}),"\n",(0,a.jsxs)(n.p,{children:["donde ",(0,a.jsx)(n.code,{children:"postTotalPooledEther"})," y ",(0,a.jsx)(n.code,{children:"postTotalShares"})," se recuperaron como valores de retorno de la llamada de vista realizada."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"isBunkerMode"})," \u2014 Si, basado en el estado observado en el slot de referencia, el protocolo debe estar en modo b\xfanker o en modo turbo (regular)."]}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.h5,{id:"datos-adicionales",children:"Datos adicionales"}),(0,a.jsx)(n.p,{children:"Datos adicionales \u2014 la informaci\xf3n del or\xe1culo que permite el procesamiento asincr\xf3nico, potencialmente en partes, despu\xe9s de que se procesan los datos principales. El or\xe1culo no impone que los datos adicionales adjuntos al mismo informe de datos se procesen en su totalidad antes de que expire el plazo de procesamiento o comience a procesarse un nuevo informe de datos, pero impone que no es posible procesar datos adicionales para un informe despu\xe9s de que expire su plazo de procesamiento o llegue un nuevo informe de datos."}),(0,a.jsx)(n.p,{children:"Los datos adicionales son un array de elementos, cada elemento codificado de la siguiente manera:"}),(0,a.jsx)(n.p,{children:"3 bytes    2 bytes      X bytes\n| itemIndex | itemType | itemPayload |"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"itemIndex"})," es un \xedndice basado en 0 en el array de datos adicionales;"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"itemType"})," es el tipo de elemento de datos adicionales;"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"itemPayload"})," es el dato del elemento cuya interpretaci\xf3n depende del tipo de elemento."]}),"\n"]}),(0,a.jsxs)(n.p,{children:["Los elementos deben estar ordenados de manera ascendente por la clave compuesta ",(0,a.jsx)(n.code,{children:"(itemType, ...itemSortingKey)"})," donde el c\xe1lculo de ",(0,a.jsx)(n.code,{children:"itemSortingKey"})," depende del tipo de elemento (ver m\xe1s abajo)."]}),(0,a.jsx)(n.hr,{}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"itemType=0"})})," (",(0,a.jsx)(n.code,{children:"EXTRA_DATA_TYPE_STUCK_VALIDATORS"}),"): validadores atascados por operadores de nodos."]}),(0,a.jsxs)(n.p,{children:["El campo ",(0,a.jsx)(n.code,{children:"itemPayload"})," tiene el siguiente formato:"]}),(0,a.jsx)(n.p,{children:"| 3 bytes  |   8 bytes    |  nodeOpsCount * 8 bytes  |  nodeOpsCount * 16 bytes  |\n| moduleId | nodeOpsCount |      nodeOperatorIds     |   stuckValidatorsCounts   |"}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"moduleId"})," es el m\xf3dulo de staking para el cual se informan los conteos de claves salidas."]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"nodeOperatorIds"})," contiene un array de IDs de operadores de nodos que tienen cambios en los conteos totales de validadores atascados en comparaci\xf3n con el almacenamiento del contrato inteligente del m\xf3dulo de staking observado en el slot de referencia. Cada ID es un uint de 8 bytes, los IDs est\xe1n empaquetados de forma compacta."]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"nodeOpsCount"})," contiene el n\xfamero de IDs de operadores de nodos contenidos en el array ",(0,a.jsx)(n.code,{children:"nodeOperatorIds"}),". As\xed,"]}),(0,a.jsx)(n.p,{children:"nodeOpsCount = byteLength(nodeOperatorIds) / 8"}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"stuckValidatorsCounts"})," contiene un array de conteos totales de validadores atascados, observado en el slot de referencia, para los operadores de nodos del array ",(0,a.jsx)(n.code,{children:"nodeOperatorIds"}),", en el mismo orden. Cada conteo es un uint de 16 bytes, los conteos est\xe1n empaquetados de forma compacta. As\xed,"]}),(0,a.jsx)(n.p,{children:"byteLength(stuckValidatorsCounts) = nodeOpsCount * 16"}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"nodeOpsCount"})," no debe ser mayor que ",(0,a.jsx)(n.code,{children:"maxAccountingExtraDataListItemsCount"})," especificado en el contrato ",(0,a.jsx)(n.a,{href:"./oracle-report-sanity-checker",children:(0,a.jsx)(n.code,{children:"OracleReportSanityChecker"})}),". Si un m\xf3dulo de staking tiene m\xe1s operadores de nodos con cambios en los conteos totales de validadores atascados en comparaci\xf3n con el almacenamiento del contrato inteligente del m\xf3dulo de staking (observado en el slot de referencia), los informes para ese m\xf3dulo deben dividirse en m\xfaltiples elementos."]}),(0,a.jsx)(n.p,{children:"La clave de ordenaci\xf3n del elemento es una clave compuesta que consiste en el ID del m\xf3dulo y el ID del primer operador de nodos informado:"}),(0,a.jsx)(n.p,{children:"itemSortingKey = (moduleId, nodeOperatorIds[0:8])"}),(0,a.jsx)(n.hr,{}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"itemType=1"})})," (",(0,a.jsx)(n.code,{children:"EXTRA_DATA_TYPE_EXITED_VALIDATORS"}),"): validadores salidos por operadores de nodos."]}),(0,a.jsxs)(n.p,{children:["El formato de carga \xfatil es exactamente el mismo que para ",(0,a.jsx)(n.code,{children:"itemType=EXTRA_DATA_TYPE_STUCK_VALIDATORS"}),", excepto que, en lugar de los conteos de validadores atascados, se informan los conteos de validadores salidos. La clave de ordenaci\xf3n del elemento se calcula de manera id\xe9ntica."]}),(0,a.jsx)(n.hr,{}),(0,a.jsxs)(n.p,{children:["El daemon del or\xe1culo debe informar los conteos de validadores salidos/atascados SOLO para aquellos pares ",(0,a.jsx)(n.code,{children:"(moduleId, nodeOperatorId)"})," que contienen conteos desactualizados en el almacenamiento del contrato inteligente del m\xf3dulo de staking observado en el slot de referencia."]}),(0,a.jsx)(n.p,{children:"El array de datos adicionales puede pasarse en diferentes formatos, ver m\xe1s abajo."})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataFormat"})," - Formato de los datos adicionales. Actualmente, solo se admiten los formatos ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_EMPTY=0"})," y ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_LIST=1"}),". Ver la constante que define un formato de datos espec\xedfico para m\xe1s informaci\xf3n."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataHash"})," - Hash de los datos adicionales. Ver la constante que define un formato de datos adicionales espec\xedfico para obtener informaci\xf3n sobre c\xf3mo calcular el hash. Debe establecerse en un hash nulo si el informe del or\xe1culo no contiene datos adicionales."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataItemsCount"})," - N\xfamero de elementos de datos adicionales. Debe establecerse en cero si el informe del or\xe1culo no contiene datos adicionales."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"acceso-y-permisos",children:"Acceso y permisos"}),"\n",(0,a.jsxs)(n.p,{children:["El acceso a los m\xe9todos de palanca est\xe1 restringido utilizando la funcionalidad del contrato ",(0,a.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/utils/access/AccessControlEnumerable.sol",children:"AccessControlEnumerable"})," y un conjunto de ",(0,a.jsx)(n.a,{href:"#permisos",children:"roles granulares"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"constantes",children:"Constantes"}),"\n",(0,a.jsx)(n.h3,{id:"lido",children:"LIDO()"}),"\n",(0,a.jsxs)(n.p,{children:["Devuelve una direcci\xf3n del contrato ",(0,a.jsx)(n.a,{href:"/contracts/lido",children:"Lido"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"address public immutable LIDO\n"})}),"\n",(0,a.jsx)(n.h3,{id:"locator",children:"LOCATOR()"}),"\n",(0,a.jsxs)(n.p,{children:["Devuelve la direcci\xf3n del contrato ",(0,a.jsx)(n.a,{href:"/contracts/lido-locator",children:"LidoLocator"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"ILidoLocator public immutable LOCATOR\n"})}),"\n",(0,a.jsx)(n.h3,{id:"legacy_oracle",children:"LEGACY_ORACLE()"}),"\n",(0,a.jsxs)(n.p,{children:["Devuelve la direcci\xf3n del contrato ",(0,a.jsx)(n.a,{href:"/contracts/legacy-oracle",children:"LegacyOracle"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"address public immutable LEGACY_ORACLE\n"})}),"\n",(0,a.jsx)(n.h3,{id:"seconds_per_slot",children:"SECONDS_PER_SLOT()"}),"\n",(0,a.jsxs)(n.p,{children:["Ver ",(0,a.jsx)(n.a,{href:"https://ethereum.org/en/developers/docs/blocks/#block-time",children:"https://ethereum.org/en/developers/docs/blocks/#block-time"})]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["siempre devuelve 12 segundos debido a ",(0,a.jsx)(n.a,{href:"https://ethereum.org/en/roadmap/merge/",children:"the Merge"})]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public immutable SECONDS_PER_SLOT\n"})}),"\n",(0,a.jsx)(n.h3,{id:"genesis_time",children:"GENESIS_TIME()"}),"\n",(0,a.jsxs)(n.p,{children:["Ver ",(0,a.jsx)(n.a,{href:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21",children:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21"})]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["siempre devuelve 1606824023 (1 de diciembre de 2020, 12:00:23 pm UTC) en ",(0,a.jsx)(n.a,{href:"https://blog.ethereum.org/2020/11/27/eth2-quick-update-no-21",children:"Mainnet"})]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public immutable GENESIS_TIME\n"})}),"\n",(0,a.jsx)(n.h3,{id:"extra_data_type_stuck_validators",children:"EXTRA_DATA_TYPE_STUCK_VALIDATORS()"}),"\n",(0,a.jsxs)(n.p,{children:["Este tipo lleva los detalles de los validador(es) ",(0,a.jsx)(n.a,{href:"/contracts/staking-router#exited-and-stuck-validators",children:"atascados"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant EXTRA_DATA_TYPE_STUCK_VALIDATORS = 1\n"})}),"\n",(0,a.jsx)(n.h3,{id:"extra_data_type_exited_validators",children:"EXTRA_DATA_TYPE_EXITED_VALIDATORS()"}),"\n",(0,a.jsxs)(n.p,{children:["Este tipo contiene los detalles de los validador(es) ",(0,a.jsx)(n.a,{href:"/contracts/staking-router#exited-and-stuck-validators",children:"salidos"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant EXTRA_DATA_TYPE_EXITED_VALIDATORS = 2\n"})}),"\n",(0,a.jsx)(n.h3,{id:"extra_data_format_empty",children:"EXTRA_DATA_FORMAT_EMPTY()"}),"\n",(0,a.jsxs)(n.p,{children:["El formato de datos adicionales utilizado para significar que el informe del or\xe1culo no contiene ",(0,a.jsx)(n.a,{href:"/contracts/accounting-oracle#datos-adicionales",children:"datos adicionales"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Enviado como parte de la ",(0,a.jsx)(n.a,{href:"/gu%C3%ADas/oracle-operator-manual#fase-3-env%C3%ADo-de-datos-adicionales-del-informe",children:"Fase 3"})," del or\xe1culo."]}),"\n",(0,a.jsxs)(n.p,{children:["Este formato se usa cuando no hay nuevos validadores ",(0,a.jsx)(n.a,{href:"/contracts/staking-router#exited-and-stuck-validators",children:"atascados"})," o ",(0,a.jsx)(n.a,{href:"/contracts/staking-router#exited-and-stuck-validators",children:"salidos"})," en el per\xedodo del informe."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant EXTRA_DATA_FORMAT_EMPTY = 0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"extra_data_format_list",children:"EXTRA_DATA_FORMAT_LIST()"}),"\n",(0,a.jsx)(n.p,{children:"El formato de lista para el array de datos adicionales. Se utiliza cuando todo el procesamiento de datos adicionales cabe en una sola transacci\xf3n."}),"\n",(0,a.jsx)(n.p,{children:"Los datos adicionales se pasan en una sola transacci\xf3n como un array de bytes que contiene todos los elementos de datos empaquetados de manera compacta."}),"\n",(0,a.jsxs)(n.p,{children:["El hash es un hash ",(0,a.jsx)(n.code,{children:"keccak256"})," calculado sobre los elementos del array de bytes. El equivalente en Solidity del c\xf3digo de c\xe1lculo del hash ser\xeda ",(0,a.jsx)(n.code,{children:"keccak256(array)"}),", donde ",(0,a.jsx)(n.code,{children:"array"})," tiene el tipo ",(0,a.jsx)(n.code,{children:"bytes"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant EXTRA_DATA_FORMAT_LIST = 1\n"})}),"\n",(0,a.jsx)(n.h2,{id:"processingstate",children:"ProcessingState"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"struct ProcessingState {\n    uint256 currentFrameRefSlot;\n    uint256 processingDeadlineTime;\n    bytes32 mainDataHash;\n    bool mainDataSubmitted;\n    bytes32 extraDataHash;\n    uint256 extraDataFormat;\n    bool extraDataSubmitted;\n    uint256 extraDataItemsCount;\n    uint256 extraDataItemsSubmitted;\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"currentFrameRefSlot"})," - Slot de referencia para el marco de informes actual."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"processingDeadlineTime"})," - El \xfaltimo tiempo en el que se pueden enviar datos para el marco de informes actual."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"mainDataHash"})," - Hash de los datos del informe principal. Bytes cero si no se ha alcanzado el consenso sobre el hash para el marco de informes actual."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"mainDataSubmitted"})," - Si los datos del informe principal para el marco de informes actual ya se han enviado."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataHash"})," - Hash de los datos del informe adicional. Debe ser ignorado a menos que ",(0,a.jsx)(n.code,{children:"mainDataSubmitted"})," sea verdadero."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataFormat"})," - Formato de los datos del informe adicional para el marco de informes actual. Debe ser ignorado a menos que ",(0,a.jsx)(n.code,{children:"mainDataSubmitted"})," sea verdadero."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataSubmitted"})," - N\xfamero total de elementos de datos del informe adicional para el marco de informes actual. Debe ser ignorado a menos que ",(0,a.jsx)(n.code,{children:"mainDataSubmitted"})," sea verdadero."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"extraDataItemsSubmitted"})," - Cu\xe1ntos elementos de datos del informe adicional ya se han enviado para el marco de informes actual."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"m\xe9todos-de-vista",children:"M\xe9todos de vista"}),"\n",(0,a.jsx)(n.h3,{id:"getconsensuscontract",children:"getConsensusContract()"}),"\n",(0,a.jsxs)(n.p,{children:["Devuelve la direcci\xf3n de la instancia del contrato ",(0,a.jsx)(n.a,{href:"/contracts/hash-consensus",children:"HashConsensus"})," utilizada por ",(0,a.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getConsensusContract() external view returns (address)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getconsensusreport",children:"getConsensusReport()"}),"\n",(0,a.jsx)(n.p,{children:"Devuelve el \xfaltimo hash del informe de consenso y los metadatos."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getConsensusReport() external view returns (\n    bytes32 hash,\n    uint256 refSlot,\n    uint256 processingDeadlineTime,\n    bool processingStarted\n)\n"})}),"\n",(0,a.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Nombre"}),(0,a.jsx)(n.th,{children:"Tipo"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"hash"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"bytes32"})}),(0,a.jsx)(n.td,{children:"El \xfaltimo hash reportado"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"refSlot"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uint256"})}),(0,a.jsx)(n.td,{children:"El slot de referencia del marco: si los datos sobre los cuales se est\xe1 alcanzando el consenso incluyen o dependen de alg\xfan estado on-chain, este estado debe consultarse en el slot de referencia. El estado reportado debe incluir todos los cambios de estado resultantes de todos los bloques hasta este slot de referencia (inclusive)."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"processingDeadlineTime"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uint256"})}),(0,a.jsx)(n.td,{children:"Marca de tiempo del \xfaltimo slot en el cual un informe puede ser reportado y procesado"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"processingStarted"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"bool"})}),(0,a.jsx)(n.td,{children:"Indica si se ha iniciado o no el procesamiento del informe"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"getconsensusversion",children:"getConsensusVersion()"}),"\n",(0,a.jsx)(n.p,{children:"Devuelve la versi\xf3n actual de consenso esperada por el contrato del or\xe1culo."}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"La versi\xf3n de consenso debe cambiar cada vez que cambian las reglas de consenso, lo que significa que un or\xe1culo que observa el mismo slot de referencia calcular\xeda un hash diferente."})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getConsensusVersion() external view returns (uint256)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getcontractversion",children:"getContractVersion()"}),"\n",(0,a.jsx)(n.p,{children:"Devuelve la versi\xf3n actual del contrato."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getContractVersion() public view returns (uint256)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getlastprocessingrefslot",children:"getLastProcessingRefSlot()"}),"\n",(0,a.jsx)(n.p,{children:"Devuelve el \xfaltimo slot de referencia para el cual se inici\xf3 el procesamiento del informe."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getLastProcessingRefSlot() external view returns (uint256)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"getprocessingstate",children:"getProcessingState()"}),"\n",(0,a.jsxs)(n.p,{children:["Devuelve el estado del procesamiento de datos para el marco de informes actual. Ver la documentaci\xf3n para la estructura ",(0,a.jsx)(n.a,{href:"#processingstate",children:"ProcessingState"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function getProcessingState() external view returns (ProcessingState memory result)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"m\xe9todos",children:"M\xe9todos"}),"\n",(0,a.jsx)(n.h3,{id:"submitreportdata",children:"submitReportData()"}),"\n",(0,a.jsx)(n.p,{children:"Env\xeda los datos del informe para su procesamiento."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function submitReportData(ReportData calldata data, uint256 contractVersion)\n"})}),"\n",(0,a.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Nombre"}),(0,a.jsx)(n.th,{children:"Tipo"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"data"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"ReportData"})}),(0,a.jsxs)(n.td,{children:["Los datos. Ver la documentaci\xf3n de la estructura ",(0,a.jsx)(n.a,{href:"./accounting-oracle#datos-del-informe",children:"ReportData"})," para m\xe1s detalles."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"contractVersion"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uint256"})}),(0,a.jsx)(n.td,{children:"Versi\xf3n esperada del contrato del or\xe1culo."})]})]})]}),"\n",(0,a.jsx)(n.h4,{id:"reverts",children:"Reverts"}),"\n",(0,a.jsxs)(n.p,{children:["Para m\xe1s informaci\xf3n sobre reverts, ver una secci\xf3n separada ",(0,a.jsx)(n.a,{href:"#reverts-3",children:"aqu\xed"})]}),"\n",(0,a.jsx)(n.h3,{id:"submitreportextradataempty",children:"submitReportExtraDataEmpty()"}),"\n",(0,a.jsx)(n.p,{children:"Dispara el procesamiento requerido cuando no hay datos adicionales presentes en el informe, es decir, cuando el formato de datos adicionales es igual a EXTRA_DATA_FORMAT_EMPTY."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function submitReportExtraDataEmpty()\n"})}),"\n",(0,a.jsx)(n.h4,{id:"reverts-1",children:"Reverts"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Revi\xe9rtese con ",(0,a.jsx)(n.code,{children:"SenderNotAllowed()"})," si el remitente no tiene un rol ",(0,a.jsx)(n.code,{children:"SUBMIT_DATA_ROLE"})," y el remitente no es un miembro del consenso."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"submitreportextradatalist",children:"submitReportExtraDataList()"}),"\n",(0,a.jsx)(n.p,{children:"Env\xeda los datos adicionales del informe en el formato EXTRA_DATA_FORMAT_LIST para su procesamiento."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function submitReportExtraDataList(bytes calldata items)\n"})}),"\n",(0,a.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Nombre"}),(0,a.jsx)(n.th,{children:"Tipo"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsx)(n.tbody,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"items"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"bytes"})}),(0,a.jsxs)(n.td,{children:["La lista de elementos de datos adicionales. Ver la documentaci\xf3n para la constante ",(0,a.jsx)(n.a,{href:"#extra_data_format_list",children:"EXTRA_DATA_FORMAT_LIST"})," para m\xe1s detalles."]})]})})]}),"\n",(0,a.jsx)(n.h4,{id:"reverts-2",children:"Reverts"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Revi\xe9rtese con ",(0,a.jsx)(n.code,{children:"SenderNotAllowed()"})," si el remitente no tiene un rol ",(0,a.jsx)(n.code,{children:"SUBMIT_DATA_ROLE"})," y el remitente no es un miembro del consenso."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"submitconsensusreport",children:"submitConsensusReport()"}),"\n",(0,a.jsxs)(n.p,{children:["Llamado por el contrato ",(0,a.jsx)(n.a,{href:"/contracts/hash-consensus",children:"AccountingOracle HashConsensus"})," para enviar un informe de consenso para su procesamiento."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Tenga en cuenta que enviar el informe no requiere que el procesador comience a procesarlo de inmediato, esto puede suceder m\xe1s tarde (ver ",(0,a.jsx)(n.a,{href:"#getlastprocessingrefslot",children:(0,a.jsx)(n.code,{children:"getLastProcessingRefSlot"})}),"). Hasta que se inicie el procesamiento, HashConsensus es libre de alcanzar el consenso sobre otro informe para el mismo marco de informes y enviarlo usando esta misma funci\xf3n, o perder el consenso sobre el informe enviado, notificando al procesador a trav\xe9s de ",(0,a.jsx)(n.code,{children:"discardConsensusReport"}),"."]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function submitConsensusReport(bytes32 reportHash, uint256 refSlot, uint256 deadline)\n"})}),"\n",(0,a.jsx)(n.h4,{id:"par\xe1metros-2",children:"Par\xe1metros"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Nombre"}),(0,a.jsx)(n.th,{children:"Tipo"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"reportHash"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"bytes32"})}),(0,a.jsx)(n.td,{children:"Hash de los datos calculados para el slot de referencia dado."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"refSlot"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uint256"})}),(0,a.jsx)(n.td,{children:"El slot de referencia para el cual se calcularon los datos. Revierte si no coincide con el slot de referencia actual."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"deadline"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uint256"})}),(0,a.jsx)(n.td,{children:"La marca de tiempo del \xfaltimo slot en el cual el informe puede ser procesado por el contrato de procesamiento de informes."})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"discardconsensusreport",children:"discardConsensusReport()"}),"\n",(0,a.jsx)(n.p,{children:"Llamado por el contrato HashConsensus para notificar que el informe para el slot de referencia dado\nya no es un informe de consenso y debe ser descartado. Esto puede suceder cuando un miembro\ncambia su informe, es removido del conjunto, o cuando se incrementa el valor del qu\xf3rum."}),"\n",(0,a.jsx)(n.p,{children:"Solo se llama cuando, para el slot de referencia dado:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Anteriormente hubo un informe de consenso; Y"}),"\n",(0,a.jsx)(n.li,{children:"El procesamiento del informe de consenso no ha comenzado a\xfan; Y"}),"\n",(0,a.jsx)(n.li,{children:"La fecha l\xedmite para el procesamiento del informe no ha expirado a\xfan; Y"}),"\n",(0,a.jsxs)(n.li,{children:["Actualmente no hay un informe de consenso (de lo contrario, se llama a ",(0,a.jsx)(n.a,{href:"#submitconsensusreport",children:"submitConsensusReport"}),")."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Puede ser llamado incluso cuando no hay un informe de consenso no descartado presentado para el slot de referencia actual, es decir, puede ser llamado m\xfaltiples veces sucesivamente."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function discardConsensusReport(uint256 refSlot)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"setconsensuscontract",children:"setConsensusContract()"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function setConsensusContract(address addr)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"setconsensusversion",children:"setConsensusVersion()"}),"\n",(0,a.jsx)(n.p,{children:"Establece la versi\xf3n de consenso esperada por el contrato del or\xe1culo."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"function setConsensusVersion(uint256 version)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"permisos",children:"Permisos"}),"\n",(0,a.jsx)(n.h3,{id:"submit_data_role",children:"SUBMIT_DATA_ROLE()"}),"\n",(0,a.jsx)(n.p,{children:"Un rol de ACL que otorga permiso para enviar los datos para un informe del comit\xe9."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:'bytes32 public constant SUBMIT_DATA_ROLE = keccak256("SUBMIT_DATA_ROLE");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"manage_consensus_contract_role",children:"MANAGE_CONSENSUS_CONTRACT_ROLE()"}),"\n",(0,a.jsx)(n.p,{children:"Un rol de ACL que otorga permiso para establecer la direcci\xf3n del contrato de consenso llamando a setConsensusContract."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:'bytes32 public constant MANAGE_CONSENSUS_CONTRACT_ROLE = keccak256("MANAGE_CONSENSUS_CONTRACT_ROLE");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"manage_consensus_version_role",children:"MANAGE_CONSENSUS_VERSION_ROLE()"}),"\n",(0,a.jsx)(n.p,{children:"Un rol de ACL que otorga permiso para establecer la versi\xf3n de consenso llamando a setConsensusVersion."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:'bytes32 public constant MANAGE_CONSENSUS_VERSION_ROLE = keccak256("MANAGE_CONSENSUS_VERSION_ROLE");\n'})}),"\n",(0,a.jsx)(n.h2,{id:"eventos",children:"Eventos"}),"\n",(0,a.jsx)(n.h3,{id:"extradatasubmitted",children:"ExtraDataSubmitted()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se han enviado datos adicionales para el marco de informes actual."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"ExtraDataSubmitted(uint256 indexed refSlot, uint256 itemsProcessed, uint256 itemsCount)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"warnextradataincompleteprocessing",children:"WarnExtraDataIncompleteProcessing()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se intenta enviar el mismo informe, pero a\xfan no se han procesado todos los elementos."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event WarnExtraDataIncompleteProcessing(\n    uint256 indexed refSlot,\n    uint256 processedItemsCount,\n    uint256 itemsCount\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"consensushashcontractset",children:"ConsensusHashContractSet()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se cambia el valor del hash del contrato."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event ConsensusHashContractSet(address indexed addr, address indexed prevAddr)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"consensusversionset",children:"ConsensusVersionSet()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se cambia el valor de la versi\xf3n de consenso."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event ConsensusVersionSet(uint256 indexed version, uint256 indexed prevVersion)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"reportsubmitted",children:"ReportSubmitted()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se env\xeda un nuevo hash de informe de consenso"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event ReportSubmitted(uint256 indexed refSlot, bytes32 hash, uint256 processingDeadlineTime)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"reportdiscarded",children:"ReportDiscarded()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se descarta un informe de consenso."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event ReportDiscarded(uint256 indexed refSlot, bytes32 hash)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"processingstarted",children:"ProcessingStarted()"}),"\n",(0,a.jsx)(n.p,{children:"Se emite cuando se env\xedan datos de informe"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event ProcessingStarted(uint256 indexed refSlot, bytes32 hash)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"warnprocessingmissed",children:"WarnProcessingMissed()"}),"\n",(0,a.jsxs)(n.p,{children:["Se emite en ",(0,a.jsx)(n.a,{href:"#submitconsensusreport",children:"submitConsensusReport"})," cuando ",(0,a.jsx)(n.code,{children:"refSlot != prevSubmittedRefSlot && prevProcessingRefSlot != prevSubmittedRefSlot"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"event WarnProcessingMissed(uint256 indexed refSlot)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"reverts-3",children:"Reverts"}),"\n",(0,a.jsx)(n.h3,{id:"submitreportdata-1",children:"submitReportData()"}),"\n",(0,a.jsx)(n.p,{children:"Para asegurarse de que los datos reportados est\xe1n dentro de los valores posibles, la funci\xf3n manejadora realiza una serie de comprobaciones de sanidad. Al comprobar, pueden ocurrir reverts en diferentes contratos."}),"\n",(0,a.jsx)(n.h4,{id:"contratos-accountingoracle-y-baseoracle",children:"Contratos AccountingOracle y BaseOracle"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"SenderNotAllowed()"})," si el llamador no tiene un rol ",(0,a.jsx)(n.code,{children:"SUBMIT_DATA_ROLE"})," y no es un miembro del comit\xe9 del or\xe1culo."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedContractVersion(expectedVersion, version)"})," si la versi\xf3n del contrato proporcionada es diferente de la actual."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedConsensusVersion(expectedConsensusVersion, consensusVersion)"})," si la versi\xf3n de consenso proporcionada es diferente de la esperada."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedRefSlot(report.refSlot, refSlot)"})," si el slot de referencia proporcionado difiere del del marco de consenso actual."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedDataHash(report.hash, hash)"})," si el hash keccak256 de los datos codificados en ABI es diferente del \xfaltimo hash."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"NoConsensusReportToProcess()"})," si los datos del hash del informe son 0."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"RefSlotAlreadyProcessing()"})," si el slot de referencia del informe es igual al slot de referencia de procesamiento previo."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedExtraDataHash(bytes32(0), data.extraDataHash)"})," si ",(0,a.jsx)(n.code,{children:"data.extraDataFormat"})," es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_EMPTY"})," y ",(0,a.jsx)(n.code,{children:"data.extraDataHash"})," es 0."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnexpectedExtraDataItemsCount(0, data.extraDataItemsCount)"})," si ",(0,a.jsx)(n.code,{children:"data.extraDataFormat"})," es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_EMPTY"})," y ",(0,a.jsx)(n.code,{children:"data.extraDataItemsCount"})," no es 0."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"UnsupportedExtraDataFormat(data.extraDataFormat)"})," si ",(0,a.jsx)(n.code,{children:"data.extraDataFormat"})," no es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_EMPTY"})," y no es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_LIST"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ExtraDataItemsCountCannotBeZeroForNonEmptyData()"})," si ",(0,a.jsx)(n.code,{children:"data.extraDataFormat"})," es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_LIST"})," y ",(0,a.jsx)(n.code,{children:"data.extraDataItemsCount"})," es 0."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ExtraDataHashCannotBeZeroForNonEmptyData()"})," si ",(0,a.jsx)(n.code,{children:"data.extraDataFormat"})," es ",(0,a.jsx)(n.code,{children:"EXTRA_DATA_FORMAT_LIST"})," y ",(0,a.jsx)(n.code,{children:"data.extraDataHash"})," es 0."]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"InvalidExitedValidatorsData()"})," si los datos de validadores salientes proporcionados no cumplen con las comprobaciones de seguridad."]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"oraclereportsanitychecker",children:"OracleReportSanityChecker"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Revierte con el error ",(0,a.jsx)(n.code,{children:"MaxAccountingExtraDataItemsCountExceeded(uint256 maxItemsCount, uint256 receivedItemsCount)"})," cuando la comprobaci\xf3n falla, m\xe1s informaci\xf3n ",(0,a.jsx)(n.a,{href:"/contracts/oracle-report-sanity-checker#checkaccountingextradatalistitemscount",children:"aqu\xed"})]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ExitedValidatorsLimitExceeded(uint256 limitPerDay, uint256 exitedPerDay)"})," si los datos de validadores salientes proporcionados no cumplen con las comprobaciones de seguridad. (OracleReportSanityChecker)"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"stakingrouter",children:"StakingRouter"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ArraysLengthMismatch(_stakingModuleIds.length, _exitedValidatorsCounts.length)"})," si los datos de validadores salientes proporcionados no cumplen con las comprobaciones de seguridad. (StakingRouter)"]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ExitedValidatorsCountCannotDecrease()"})," si los datos de validadores salientes proporcionados no cumplen con las comprobaciones de seguridad. (StakingRouter)"]}),"\n",(0,a.jsxs)(n.li,{children:["Revierte con ",(0,a.jsx)(n.code,{children:"ReportedExitedValidatorsExceedDeposited(uint256 reportedExitedValidatorsCount,uint256 depositedValidatorsCount)"})," si los datos de validadores salientes proporcionados no cumplen con las comprobaciones de seguridad. (StakingRouter)"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Otras reverts en ",(0,a.jsx)(n.code,{children:"Lido.handleOracleReport()"})]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>i});var a=s(6540);const o={},r=a.createContext(o);function d(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);