"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9173],{1174:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(4848),d=s(8453);const r={},t="EIP712StETH",a={id:"contracts/eip712-steth",title:"EIP712StETH",description:"- C\xf3digo fuente",source:"@site/docs/contracts/eip712-steth.md",sourceDirName:"contracts",slug:"/contracts/eip712-steth",permalink:"/contracts/eip712-steth",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/eip712-steth.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Lido",permalink:"/contracts/lido"},next:{title:"AccountingOracle",permalink:"/contracts/accounting-oracle"}},o={},c=[{value:"Por qu\xe9 se necesita este auxiliar",id:"por-qu\xe9-se-necesita-este-auxiliar",level:2},{value:"M\xe9todos de vista",id:"m\xe9todos-de-vista",level:2},{value:"domainSeparatorV4()",id:"domainseparatorv4",level:3},{value:"hashTypedDataV4()",id:"hashtypeddatav4",level:3},{value:"Par\xe1metros",id:"par\xe1metros",level:4},{value:"eip712Domain()",id:"eip712domain",level:3},{value:"Par\xe1metros",id:"par\xe1metros-1",level:4},{value:"Devoluciones",id:"devoluciones",level:4},{value:"Enlaces Externos \xdatiles",id:"enlaces-externos-\xfatiles",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"eip712steth",children:"EIP712StETH"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/EIP712StETH.sol",children:"C\xf3digo fuente"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://etherscan.io/address/0x8F73e4C2A6D852bb4ab2A45E6a9CF5715b3228B7",children:"Contrato desplegado"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"EIP712StETH"})," sirve como un contrato auxiliar dedicado para ",(0,i.jsx)(n.code,{children:"stETH"}),", crucial para el soporte completo de las ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:"aprobaciones firmadas compatibles con ERC-2612"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"por-qu\xe9-se-necesita-este-auxiliar",children:"Por qu\xe9 se necesita este auxiliar"}),"\n",(0,i.jsxs)(n.p,{children:["El contrato original ",(0,i.jsx)(n.a,{href:"/contracts/lido",children:(0,i.jsx)(n.code,{children:"Lido/StETH"})})," est\xe1 implementado en Solidity ",(0,i.jsx)(n.code,{children:"0.4.24"}),", mientras que este auxiliar est\xe1 implementado en Solidity ",(0,i.jsx)(n.code,{children:"0.8.9"}),". La versi\xf3n m\xe1s nueva del compilador permite acceder al ",(0,i.jsx)(n.code,{children:"chain id"})," actual de la red a trav\xe9s de la variable globalmente disponible ",(0,i.jsx)(n.a,{href:"https://docs.soliditylang.org/en/v0.8.9/units-and-global-variables.html#block-and-transaction-properties",children:(0,i.jsx)(n.code,{children:"block.chainid"})}),". El ",(0,i.jsx)(n.code,{children:"chain id"})," es obligatorio para incluir en la firma seg\xfan ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-155",children:"EIP-155"})," para prevenir ataques de repetici\xf3n, donde un atacante intercepta una transmisi\xf3n v\xe1lida de red y luego la retransmite en otro fork de la red. Por lo tanto, el cumplimiento de ",(0,i.jsx)(n.code,{children:"EIP-155"})," es crucial para asegurar las aprobaciones firmadas de ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:(0,i.jsx)(n.code,{children:"ERC-2612"})}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"m\xe9todos-de-vista",children:"M\xe9todos de vista"}),"\n",(0,i.jsx)(n.h3,{id:"domainseparatorv4",children:"domainSeparatorV4()"}),"\n",(0,i.jsxs)(n.p,{children:["Este m\xe9todo devuelve el ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-712#definition-of-domainseparator",children:"separador de dominio"})," hash compatible con ",(0,i.jsx)(n.code,{children:"EIP712"}),", que es v\xe1lido para las firmas de permisos del token ",(0,i.jsx)(n.code,{children:"stETH"}),". El separador de dominio es esencial para evitar que una firma destinada a una dApp funcione en otra (evitando as\xed colisiones de firma en un sentido m\xe1s amplio)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function domainSeparatorV4(address _stETH) returns (bytes32)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Tambi\xe9n considera el m\xe9todo ",(0,i.jsx)(n.a,{href:"/contracts/eip712-steth#eip712domain",children:(0,i.jsx)(n.code,{children:"eip712Domain()"})})," que puede construir un separador de dominio a partir de campos espec\xedficos de ",(0,i.jsx)(n.code,{children:"StETH"})," en el lado del cliente, como dentro de una dApp o una cartera. Por ejemplo, Metamask utiliza ",(0,i.jsx)(n.a,{href:"https://docs.metamask.io/wallet/how-to/sign-data/#use-eth_signtypeddata_v4",children:(0,i.jsx)(n.code,{children:"eth_signTypedData_v4"})}),", que requiere que se proporcione un separador de dominio no hash."]}),"\n",(0,i.jsx)(n.h3,{id:"hashtypeddatav4",children:"hashTypedDataV4()"}),"\n",(0,i.jsxs)(n.p,{children:["Este m\xe9todo devuelve el hash de un mensaje totalmente codificado compatible con ",(0,i.jsx)(n.code,{children:"EIP712"})," para este dominio. El m\xe9todo puede validar los datos de entrada contra los componentes ",(0,i.jsx)(n.code,{children:"v, r, s"})," secp256k1 proporcionados."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function hashTypedDataV4(address _stETH, bytes32 _structHash) returns (bytes32)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Nombre"}),(0,i.jsx)(n.th,{children:"Tipo"}),(0,i.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_stETH"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"address"})}),(0,i.jsxs)(n.td,{children:["Direcci\xf3n del token ",(0,i.jsx)(n.code,{children:"stETH"})," desplegado"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_structHash"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bytes32"})}),(0,i.jsx)(n.td,{children:"Hash de la estructura de datos"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Para un caso de uso espec\xedfico, consulta la implementaci\xf3n de ",(0,i.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.4.24/StETHPermit.sol#L99-L112",children:"StETHPermit.permit()"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"eip712domain",children:"eip712Domain()"}),"\n",(0,i.jsxs)(n.p,{children:["Este m\xe9todo devuelve los campos y valores necesarios para construir un separador de dominio en el lado del cliente. El m\xe9todo se asemeja al propuesto en ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-5267",children:"ERC-5267"}),", con la \xfanica diferencia de que no devuelve campos no utilizados."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function eip712Domain(address _stETH) returns (\n    string memory name,\n    string memory version,\n    uint256 chainId,\n    address verifyingContract\n)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Nombre"}),(0,i.jsx)(n.th,{children:"Tipo"}),(0,i.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"_stETH"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"address"})}),(0,i.jsxs)(n.td,{children:["Direcci\xf3n del token ",(0,i.jsx)(n.code,{children:"stETH"})," desplegado"]})]})})]}),"\n",(0,i.jsx)(n.h4,{id:"devoluciones",children:"Devoluciones"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Nombre"}),(0,i.jsx)(n.th,{children:"Tipo"}),(0,i.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"name"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"Nombre del token"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"version"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:"Versi\xf3n del token"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"chainId"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"uint256"})}),(0,i.jsx)(n.td,{children:"Identificador de la cadena"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"verifyingContract"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"address"})}),(0,i.jsx)(n.td,{children:"Direcci\xf3n del contrato del token"})]})]})]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsxs)(n.p,{children:["Dada la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_stETH"})," ",(0,i.jsx)(n.a,{href:"/deployed-contracts",children:"desplegada"})," correcta, devuelve:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'("Liquid staked Ether 2.0", "2", 1, 0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84) para Mainnet.'}),"\n",(0,i.jsx)(n.li,{children:'("Liquid staked Ether 2.0", "2", 5, 0x1643E812aE58766192Cf7D2Cf9567dF2C37e9B7F) para G\xf6rli.'}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"Este m\xe9todo facilita la construcci\xf3n del separador de dominio en el lado del cliente, como en una cartera o widget:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"function makeDomainSeparator(name, version, chainId, verifyingContract) {\n  return web3.utils.keccak256(\n    web3.eth.abi.encodeParameters(\n      ['bytes32', 'bytes32', 'bytes32', 'uint256', 'address'],\n      [\n        web3.utils.keccak256('EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'),\n        web3.utils.keccak256(name),\n        web3.utils.keccak256(version),\n        chainId,\n        verifyingContract,\n      ]\n    )\n  )\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"enlaces-externos-\xfatiles",children:"Enlaces Externos \xdatiles"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://medium.com/mycrypto/the-magic-of-digital-signatures-on-ethereum-98fe184dc9c7",children:"La magia de las firmas digitales en Ethereum"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://medium.com/frak-defi/erc-2612-the-ultimate-guide-to-gasless-erc-20-approvals-2cd32ddee534",children:"ERC-2612: La gu\xeda definitiva para aprobaciones ERC-20 sin gas"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.metamask.io/wallet/how-to/sign-data/#use-eth_signtypeddata_v4",children:"Metamask sign-data"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(6540);const d={},r=i.createContext(d);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);