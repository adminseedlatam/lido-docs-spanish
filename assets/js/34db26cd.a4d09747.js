"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9173],{1174:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>l,frontMatter:()=>r,metadata:()=>a,toc:()=>h});var t=n(4848),i=n(8453);const r={},d="EIP712StETH",a={id:"contracts/eip712-steth",title:"EIP712StETH",description:"- Source code",source:"@site/docs/contracts/eip712-steth.md",sourceDirName:"contracts",slug:"/contracts/eip712-steth",permalink:"/contracts/eip712-steth",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/eip712-steth.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Lido",permalink:"/contracts/lido"},next:{title:"AccountingOracle",permalink:"/contracts/accounting-oracle"}},c={},h=[{value:"Why This Helper Is Needed",id:"why-this-helper-is-needed",level:2},{value:"View Methods",id:"view-methods",level:2},{value:"domainSeparatorV4()",id:"domainseparatorv4",level:3},{value:"hashTypedDataV4()",id:"hashtypeddatav4",level:3},{value:"Parameters",id:"parameters",level:4},{value:"eip712Domain()",id:"eip712domain",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"Returns",id:"returns",level:4},{value:"Useful External Links",id:"useful-external-links",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"eip712steth",children:"EIP712StETH"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/EIP712StETH.sol",children:"Source code"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://etherscan.io/address/0x8F73e4C2A6D852bb4ab2A45E6a9CF5715b3228B7",children:"Deployed contract"})}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"EIP712StETH"})," serves as a dedicated helper contract for ",(0,t.jsx)(s.code,{children:"stETH"}),", crucial for complete support of ",(0,t.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:"ERC-2612 compliant signed approvals"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"why-this-helper-is-needed",children:"Why This Helper Is Needed"}),"\n",(0,t.jsxs)(s.p,{children:["The original ",(0,t.jsx)(s.a,{href:"/contracts/lido",children:(0,t.jsx)(s.code,{children:"Lido/StETH"})})," contract is implemented in Solidity ",(0,t.jsx)(s.code,{children:"0.4.24"}),", while this helper is implemented in Solidity ",(0,t.jsx)(s.code,{children:"0.8.9"}),". The newer compiler version enables access to the current network's chain id via the globally available variable ",(0,t.jsx)(s.a,{href:"https://docs.soliditylang.org/en/v0.8.9/units-and-global-variables.html#block-and-transaction-properties",children:(0,t.jsx)(s.code,{children:"block.chainid"})}),". The chain id is mandatory for signature inclusion as per ",(0,t.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-155",children:"EIP-155"})," to prevent replay attacks, wherein an attacker intercepts a valid network transmission and then rebroadcasts it on another network fork. Consequently, ",(0,t.jsx)(s.code,{children:"EIP-155"})," compliance is critical for securing ",(0,t.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:(0,t.jsx)(s.code,{children:"ERC-2612"})})," signed approvals."]}),"\n",(0,t.jsx)(s.h2,{id:"view-methods",children:"View Methods"}),"\n",(0,t.jsx)(s.h3,{id:"domainseparatorv4",children:"domainSeparatorV4()"}),"\n",(0,t.jsxs)(s.p,{children:["This method returns the ",(0,t.jsx)(s.code,{children:"EIP712"}),"-compatible hashed ",(0,t.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-712#definition-of-domainseparator",children:"domain separator"}),", which is valid for ",(0,t.jsx)(s.code,{children:"stETH"})," token permit signatures. The domain separator is essential in preventing a signature intended for one dApp from functioning in another (thereby averting a signature collision in a broader sense)."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sol",children:"function domainSeparatorV4(address _stETH) returns (bytes32)\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Also, consider the ",(0,t.jsx)(s.a,{href:"/contracts/eip712-steth#eip712domain",children:(0,t.jsx)(s.code,{children:"eip712Domain()"})})," method that can construct a domain separator from ",(0,t.jsx)(s.code,{children:"StETH"}),"-specific fields on the client's side, such as within a dApp or a wallet. For instance, Metamask relies on ",(0,t.jsx)(s.a,{href:"https://docs.metamask.io/wallet/how-to/sign-data/#use-eth_signtypeddata_v4",children:(0,t.jsx)(s.code,{children:"eth_signTypedData_v4"})}),", which requires a non-hashed domain separator being provided."]}),"\n",(0,t.jsx)(s.h3,{id:"hashtypeddatav4",children:"hashTypedDataV4()"}),"\n",(0,t.jsxs)(s.p,{children:["This method returns the hash of a fully encoded ",(0,t.jsx)(s.code,{children:"EIP712"}),"-compatible message for this domain. The method can validate the input data against the provided ",(0,t.jsx)(s.code,{children:"v, r, s"})," secp256k1 components."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sol",children:"function hashTypedDataV4(address _stETH, bytes32 _structHash) returns (bytes32)\n"})}),"\n",(0,t.jsx)(s.h4,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"_stETH"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"address"})}),(0,t.jsxs)(s.td,{children:["Address of the deployed ",(0,t.jsx)(s.code,{children:"stETH"})," token"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"_structHash"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"bytes32"})}),(0,t.jsx)(s.td,{children:"Hash of the data structure"})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:["For a specific use case, see the ",(0,t.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.4.24/StETHPermit.sol#L99-L112",children:"StETHPermit.permit()"})," implementation."]}),"\n",(0,t.jsx)(s.h3,{id:"eip712domain",children:"eip712Domain()"}),"\n",(0,t.jsxs)(s.p,{children:["This method returns the fields and values necessary to construct a domain separator on the client's side. The method resembles the one proposed in ",(0,t.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-5267",children:"ERC-5267"}),", with the only difference being that it doesn't return unused fields."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sol",children:"function eip712Domain(address _stETH) returns (\n    string memory name,\n    string memory version,\n    uint256 chainId,\n    address verifyingContract\n)\n"})}),"\n",(0,t.jsx)(s.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"_stETH"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"address"})}),(0,t.jsxs)(s.td,{children:["Address of the deployed ",(0,t.jsx)(s.code,{children:"stETH"})," token"]})]})})]}),"\n",(0,t.jsx)(s.h4,{id:"returns",children:"Returns"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"name"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"string"})}),(0,t.jsx)(s.td,{children:"Name of the token"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"version"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"string"})}),(0,t.jsx)(s.td,{children:"Version of the token"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"chainId"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"uint256"})}),(0,t.jsx)(s.td,{children:"Chain identifier"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"verifyingContract"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"address"})}),(0,t.jsx)(s.td,{children:"Address of the token contract"})]})]})]}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsxs)(s.p,{children:["Provided the correct ",(0,t.jsx)(s.code,{children:"_stETH"})," ",(0,t.jsx)(s.a,{href:"/deployed-contracts",children:"deployed"})," address, it returns:"]}),(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:'("Liquid staked Ether 2.0", "2", 1, 0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84) for Mainnet.'}),"\n",(0,t.jsx)(s.li,{children:'("Liquid staked Ether 2.0", "2", 5, 0x1643E812aE58766192Cf7D2Cf9567dF2C37e9B7F) for G\xf6rli.'}),"\n"]})]}),"\n",(0,t.jsx)(s.p,{children:"This method facilitates domain separator construction on the client's side, such as in a wallet or widget:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"function makeDomainSeparator(name, version, chainId, verifyingContract) {\n  return web3.utils.keccak256(\n    web3.eth.abi.encodeParameters(\n      ['bytes32', 'bytes32', 'bytes32', 'uint256', 'address'],\n      [\n        web3.utils.keccak256('EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'),\n        web3.utils.keccak256(name),\n        web3.utils.keccak256(version),\n        chainId,\n        verifyingContract,\n      ]\n    )\n  )\n}\n"})}),"\n",(0,t.jsx)(s.h2,{id:"useful-external-links",children:"Useful External Links"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://medium.com/mycrypto/the-magic-of-digital-signatures-on-ethereum-98fe184dc9c7",children:"The Magic of Digital Signatures on Ethereum"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://medium.com/frak-defi/erc-2612-the-ultimate-guide-to-gasless-erc-20-approvals-2cd32ddee534",children:"ERC-2612: The Ultimate Guide to Gasless ERC-20 Approvals"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.metamask.io/wallet/how-to/sign-data/#use-eth_signtypeddata_v4",children:"Metamask sign-data"})}),"\n"]})]})}function l(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>a});var t=n(6540);const i={},r=t.createContext(i);function d(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);