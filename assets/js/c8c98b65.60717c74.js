"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1571],{365:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var i=s(4848),d=s(8453);const a={},r="WithdrawalQueueERC721",l={id:"contracts/withdrawal-queue-erc721",title:"WithdrawalQueueERC721",description:"- C\xf3digo fuente",source:"@site/docs/contracts/withdrawal-queue-erc721.md",sourceDirName:"contracts",slug:"/contracts/withdrawal-queue-erc721",permalink:"/contracts/withdrawal-queue-erc721",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/withdrawal-queue-erc721.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"NodeOperatorsRegistry",permalink:"/contracts/node-operators-registry"},next:{title:"WithdrawalVault",permalink:"/contracts/withdrawal-vault"}},c={},o=[{value:"\xbfQu\xe9 es WithdrawalQueueERC721?",id:"qu\xe9-es-withdrawalqueueerc721",level:2},{value:"Solicitud",id:"solicitud",level:2},{value:"Finalizaci\xf3n",id:"finalizaci\xf3n",level:2},{value:"Reclamo",id:"reclamo",level:2},{value:"Est\xe1ndares",id:"est\xe1ndares",level:2},{value:"M\xe9todos relacionados con <code>ERC-721</code>",id:"m\xe9todos-relacionados-con-erc-721",level:2},{value:"name()",id:"name",level:3},{value:"symbol()",id:"symbol",level:3},{value:"tokenURI()",id:"tokenuri",level:3},{value:"balanceOf()",id:"balanceof",level:3},{value:"ownerOf()",id:"ownerof",level:3},{value:"approve()",id:"approve",level:3},{value:"getApproved()",id:"getapproved",level:3},{value:"setApprovalForAll()",id:"setapprovalforall",level:3},{value:"isApprovedForAll()",id:"isapprovedforall",level:3},{value:"safeTransferFrom()",id:"safetransferfrom",level:3},{value:"transferFrom()",id:"transferfrom",level:3},{value:"getBaseUri()",id:"getbaseuri",level:3},{value:"getNFTDescriptorAddress()",id:"getnftdescriptoraddress",level:3},{value:"M\xe9todos relacionados con <code>ERC-165</code>",id:"m\xe9todos-relacionados-con-erc-165",level:2},{value:"supportsInterface()",id:"supportsinterface",level:3},{value:"M\xe9todos relacionados con la cola",id:"m\xe9todos-relacionados-con-la-cola",level:2},{value:"requestWithdrawals()",id:"requestwithdrawals",level:3},{value:"requestWithdrawalsWstETH()",id:"requestwithdrawalswsteth",level:3},{value:"requestWithdrawalsWithPermit()",id:"requestwithdrawalswithpermit",level:3},{value:"requestWithdrawalsWstETHWithPermit()",id:"requestwithdrawalswstethwithpermit",level:3},{value:"getWithdrawalRequests()",id:"getwithdrawalrequests",level:3},{value:"getWithdrawalStatus()",id:"getwithdrawalstatus",level:3},{value:"getClaimableEther()",id:"getclaimableether",level:3},{value:"claimWithdrawalsTo()",id:"claimwithdrawalsto",level:3},{value:"claimWithdrawals()",id:"claimwithdrawals",level:3},{value:"claimWithdrawal()",id:"claimwithdrawal",level:3},{value:"findCheckpointHints()",id:"findcheckpointhints",level:3},{value:"isBunkerModeActive()",id:"isbunkermodeactive",level:3},{value:"bunkerModeSinceTimestamp()",id:"bunkermodesincetimestamp",level:3},{value:"getLastRequestId()",id:"getlastrequestid",level:3},{value:"getLastFinalizedRequestId()",id:"getlastfinalizedrequestid",level:3},{value:"getLockedEtherAmount()",id:"getlockedetheramount",level:3},{value:"getLastCheckpointIndex()",id:"getlastcheckpointindex",level:3},{value:"unfinalizedRequestNumber()",id:"unfinalizedrequestnumber",level:3},{value:"unfinalizedStETH()",id:"unfinalizedsteth",level:3},{value:"calculateFinalizationBatches()",id:"calculatefinalizationbatches",level:3},{value:"prefinalize()",id:"prefinalize",level:3},{value:"M\xe9todos protegidos",id:"m\xe9todos-protegidos",level:2},{value:"Roles",id:"roles",level:3},{value:"finalize()",id:"finalize",level:3},{value:"pauseFor()",id:"pausefor",level:3},{value:"pauseUntil()",id:"pauseuntil",level:3},{value:"resume()",id:"resume",level:3},{value:"onOracleReport()",id:"onoraclereport",level:3},{value:"setBaseUri()",id:"setbaseuri",level:3},{value:"setNFTDescriptorAddress()",id:"setnftdescriptoraddress",level:3}];function t(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"withdrawalqueueerc721",children:"WithdrawalQueueERC721"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/WithdrawalQueueERC721.sol",children:"C\xf3digo fuente"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://etherscan.io/address/0x889edC2eDab5f40e902b864aD4d7AdE8E412F9B1",children:"Contrato desplegado"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Una cola FIFO para solicitudes de retiro de ",(0,i.jsx)(n.code,{children:"stETH"})," y una implementaci\xf3n de NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," que representa la posici\xf3n en la cola."]}),"\n",(0,i.jsxs)(n.p,{children:["El acceso a los m\xe9todos de palanca est\xe1 restringido mediante la funcionalidad del contrato ",(0,i.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/utils/access/AccessControlEnumerable.sol",children:"AccessControlEnumerable"}),"\ny una serie de ",(0,i.jsx)(n.a,{href:"#roles",children:"roles granulares"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"qu\xe9-es-withdrawalqueueerc721",children:"\xbfQu\xe9 es WithdrawalQueueERC721?"}),"\n",(0,i.jsxs)(n.p,{children:["Este contrato es un punto de entrada principal para intercambiar ",(0,i.jsx)(n.code,{children:"stETH"})," por ether subyacente directamente a trav\xe9s del protocolo Lido.\nEs responsable de:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"gestionar una cola de solicitudes de retiro"}),"\n",(0,i.jsxs)(n.li,{children:["comprometer la finalizaci\xf3n de la solicitud de retiro como parte del informe del ",(0,i.jsx)(n.a,{href:"/contracts/accounting-oracle",children:"AccountingOracle"})]}),"\n",(0,i.jsxs)(n.li,{children:["almacenar ",(0,i.jsx)(n.code,{children:"stETH"})," antes y ether despu\xe9s de la finalizaci\xf3n"]}),"\n",(0,i.jsx)(n.li,{children:"transferir ether reservado al usuario al reclamar"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Adem\xe1s, el contrato es un NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-721",children:"ERC-721"})," con extensi\xf3n de metadatos que representa el derecho a reclamar el ether subyacente una vez que se finalice la solicitud.\nEste NFT se acu\xf1a al solicitarlo y se quema al reclamarlo. Se utiliza ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-4906",children:"ERC-4906"})," para actualizar los metadatos tan pronto como cambia el estado de finalizaci\xf3n de la solicitud."]}),"\n",(0,i.jsx)(n.h2,{id:"solicitud",children:"Solicitud"}),"\n",(0,i.jsxs)(n.p,{children:["Para solicitar un retiro, se debe aprobar la cantidad de ",(0,i.jsx)(n.code,{children:"stETH"})," o ",(0,i.jsx)(n.code,{children:"wstETH"})," a este contrato o firmar el ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:"Permiso ERC-2612"})," y luego llamar al m\xe9todo ",(0,i.jsx)(n.code,{children:"requestWithdrawals*"})," apropiado."]}),"\n",(0,i.jsxs)(n.p,{children:["La ",(0,i.jsx)(n.strong,{children:"cantidad m\xednima"})," para una solicitud es de ",(0,i.jsx)(n.code,{children:"100 wei"}),", y la ",(0,i.jsx)(n.strong,{children:"m\xe1xima"})," es de ",(0,i.jsx)(n.code,{children:"1000 eth"}),". Cantidades mayores deben dividirse en varias solicitudes, lo que nos permite evitar congestionar la cola con una solicitud demasiado grande."]}),"\n",(0,i.jsxs)(n.p,{children:["Durante esta llamada, la solicitud se coloca en la cola y se acu\xf1a el NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," relacionado. La siguiente estructura representa la solicitud:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"struct WithdrawalRequestStatus {\n    uint256 amountOfStETH;\n    uint256 amountOfShares;\n    address owner;\n    uint256 timestamp;\n    bool isFinalized;\n    bool isClaimed;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"amountOfStETH"})})," \u2014 la cantidad de tokens ",(0,i.jsx)(n.code,{children:"stETH"})," transferidos al contrato al solicitar"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"amountOfShares"})})," \u2014 la cantidad de participaciones subyacentes correspondientes a los tokens ",(0,i.jsx)(n.code,{children:"stETH"})," transferidos.\nConsulta el ",(0,i.jsx)(n.a,{href:"/contracts/lido#rebase",children:"cap\xedtulo de rebalanceo de Lido"})," para aprender sobre la mec\xe1nica de las participaciones"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"owner"})})," \u2014 la direcci\xf3n del propietario de esta solicitud. El propietario tambi\xe9n es titular del NFT ",(0,i.jsx)(n.code,{children:"unstETH"}),"\ny puede transferir la propiedad y reclamar el ether subyacente una vez finalizado"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"timestamp"})})," \u2014 la hora de creaci\xf3n de la solicitud"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"isFinalized"})})," \u2014 estado de finalizaci\xf3n de la solicitud; las solicitudes finalizadas est\xe1n disponibles para reclamar"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"isClaimed"})})," \u2014 estado de reclamaci\xf3n de la solicitud. Una vez reclamada, el NFT se quema y la solicitud no est\xe1 disponible para reclamar nuevamente"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["La cantidad de ether que se retirar\xe1 est\xe1 limitada por el n\xfamero de tokens ",(0,i.jsx)(n.code,{children:"stETH"})," transferidos a este contrato en el momento de la solicitud. Por lo tanto, el usuario no recibir\xe1 las recompensas por el per\xedodo de tiempo en que sus tokens permanezcan en la cola."]})}),"\n",(0,i.jsx)(n.h2,{id:"finalizaci\xf3n",children:"Finalizaci\xf3n"}),"\n",(0,i.jsxs)(n.p,{children:["Despu\xe9s de presentar una solicitud de retiro, solo se puede reclamar una vez que se produzca la finalizaci\xf3n.\nEl informe del ",(0,i.jsx)(n.a,{href:"/contracts/accounting-oracle",children:"Accounting Oracle"})," finaliza un lote de solicitudes de retiro,\neligiendo el ",(0,i.jsx)(n.code,{children:"_maxShareRate"})," y el tama\xf1o del lote teniendo en cuenta los siguientes factores:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si hay suficiente ether para cumplir con la solicitud. El ether puede obtenerse del buffer de Lido, que se llena con la participaci\xf3n de nuevos usuarios, retiros parciales y totales de la cadena Beacon, propinas del protocolo y recompensas MEV.\nLos retiros tienen prioridad sobre los dep\xf3sitos, por lo que el ether no puede depositarse en la cadena Beacon si algunas solicitudes de retiro pueden ser cumplidas."}),"\n",(0,i.jsx)(n.li,{children:"Si ha pasado suficiente tiempo desde que se coloc\xf3 la solicitud de retiro en la cola (bloqueo de tiempo)"}),"\n",(0,i.jsx)(n.li,{children:"Si ha habido alguna p\xe9rdida masiva para el protocolo en el lado de la cadena Beacon desde que se present\xf3 la solicitud de retiro.\nEsto puede llevar a la finalizaci\xf3n a una tasa inferior a 1:1 si la p\xe9rdida es lo suficientemente alta como para no ser cubierta con las recompensas diarias (nunca ha sucedido antes)"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["En resumen, los titulares de tokens no reciben recompensas pero a\xfan as\xed asumen riesgos durante el retiro. Las recompensas adquiridas\ndesde que el ",(0,i.jsx)(n.code,{children:"stETH"})," se bloque\xf3 en el WithdrawalQueue se queman al finalizar, distribuy\xe9ndolas efectivamente entre los otros titulares de tokens."]})}),"\n",(0,i.jsxs)(n.p,{children:["Entonces, la finalizaci\xf3n establece el valor final de la solicitud, bloquea el ether en el balance de este contrato, quema el ",(0,i.jsx)(n.code,{children:"stETH"})," subyacente y la cola puede verse as\xed en un momento arbitrario:"]}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    subgraph queue\n    direction LR\n    B---D\n    subgraph unfinalized;\n        A[1 stETH]---B[1.1 stETH]\n    end\n    subgraph finalized;\n        D(0.3 ETH)---E(1000 ETH)\n    end\n    end\n\n    classDef gr fill:#d0f0c0,stroke:#333,stroke-width:3px;;\n    classDef r fill:#fa8072,stroke:#333,stroke-width:3px;;\n\n    class A,B r;\n    class D,E gr;\n"}),"\n",(0,i.jsx)(n.h2,{id:"reclamo",children:"Reclamo"}),"\n",(0,i.jsx)(n.p,{children:"Cuando la solicitud est\xe1 finalizada, puede ser reclamada por el propietario actual, transfiriendo la cantidad reservada de ether a\nla direcci\xf3n del destinatario y quemando el NFT de retiro."}),"\n",(0,i.jsxs)(n.p,{children:["Para ver si la solicitud es reclamable, se puede obtener su estado usando ",(0,i.jsx)(n.code,{children:"getWithdrawalStatus()"})," o suscribirse al evento ",(0,i.jsx)(n.code,{children:"WithdrawalsFinalized(uint256 from, uint256 to, ...)"}),", que se emite una vez que el lote de solicitudes\ncon ids en el rango ",(0,i.jsx)(n.code,{children:"(from, to]"})," es finalizado."]}),"\n",(0,i.jsx)(n.h2,{id:"est\xe1ndares",children:"Est\xe1ndares"}),"\n",(0,i.jsx)(n.p,{children:"El contrato implementa los siguientes est\xe1ndares de Ethereum:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-721",children:"ERC-721: Est\xe1ndar de Token No Fungible"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-165",children:"ERC-165: Detecci\xf3n de Interfaz Est\xe1ndar"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-4906",children:"ERC-4906: Extensi\xf3n de Actualizaci\xf3n de Metadatos de EIP-721"})}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"m\xe9todos-relacionados-con-erc-721",children:["M\xe9todos relacionados con ",(0,i.jsx)(n.code,{children:"ERC-721"})]}),"\n",(0,i.jsx)(n.h3,{id:"name",children:"name()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el nombre de la colecci\xf3n de tokens."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function name() view returns (string memory)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"symbol",children:"symbol()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el s\xedmbolo de la colecci\xf3n de tokens."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function symbol() view returns (string memory)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tokenuri",children:"tokenURI()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve el Identificador de Recurso Uniforme (URI) para el token ",(0,i.jsx)(n.code,{children:"_requestId"}),". Devuelve una cadena vac\xeda si no se ha establecido un URI base ni una direcci\xf3n ",(0,i.jsx)(n.code,{children:"NFTDescriptor"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function tokenURI(uint256 _requestId) view returns (string memory)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"balanceof",children:"balanceOf()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve el n\xfamero de tokens en la cuenta de ",(0,i.jsx)(n.code,{children:"_owner"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function balanceOf(address _owner) view returns (uint256 balance)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Revierte si ",(0,i.jsx)(n.code,{children:"_owner"})," es una direcci\xf3n cero"]})}),"\n",(0,i.jsx)(n.h3,{id:"ownerof",children:"ownerOf()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve el propietario del token ",(0,i.jsx)(n.code,{children:"_requestId"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function ownerOf(uint256 _requestId) view returns (address owner)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["La solicitud ",(0,i.jsx)(n.code,{children:"_requestId"})," debe existir."]}),"\n",(0,i.jsxs)(n.li,{children:["La solicitud ",(0,i.jsx)(n.code,{children:"_requestId"})," no debe estar reclamada."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"approve",children:"approve()"}),"\n",(0,i.jsxs)(n.p,{children:["Da permiso a ",(0,i.jsx)(n.code,{children:"_to"})," para transferir el token ",(0,i.jsx)(n.code,{children:"_requestId"})," a otra cuenta. La aprobaci\xf3n se elimina cuando el token se transfiere."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Approval"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function approve(address _to, uint256 _requestId)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"El llamante debe poseer el token o ser un operador aprobado."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_requestId"})," debe existir."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_to"})," no debe ser el propietario."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"getapproved",children:"getApproved()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la cuenta aprobada para el token ",(0,i.jsx)(n.code,{children:"_requestId"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getApproved(uint256 _requestId) view returns (address)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Revierte si no existe ",(0,i.jsx)(n.code,{children:"_requestId"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"setapprovalforall",children:"setApprovalForAll()"}),"\n",(0,i.jsxs)(n.p,{children:["Aprueba o elimina a ",(0,i.jsx)(n.code,{children:"_operator"})," como operador para el llamante. Los operadores pueden llamar a ",(0,i.jsx)(n.code,{children:"transferFrom"})," o ",(0,i.jsx)(n.code,{children:"safeTransferFrom"})," para cualquier token propiedad del llamante."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"ApprovalForAll"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function setApprovalForAll(address _operator, bool _approved)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Revierte si ",(0,i.jsx)(n.code,{children:"msg.sender"})," es igual a ",(0,i.jsx)(n.code,{children:"_operator"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"isapprovedforall",children:"isApprovedForAll()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve ",(0,i.jsx)(n.code,{children:"true"})," si el ",(0,i.jsx)(n.code,{children:"_operator"})," est\xe1 autorizado para gestionar todos los activos de ",(0,i.jsx)(n.code,{children:"_owner"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function isApprovedForAll(address _owner, address _operator) view returns (bool)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"safetransferfrom",children:"safeTransferFrom()"}),"\n",(0,i.jsxs)(n.p,{children:["Transfiere de forma segura el token ",(0,i.jsx)(n.code,{children:"_requestId"})," de ",(0,i.jsx)(n.code,{children:"_from"})," a ",(0,i.jsx)(n.code,{children:"_to"}),", verificando primero que los destinatarios del contrato sean conscientes del\nprotocolo ERC721 para evitar que los tokens queden bloqueados para siempre.\nSi se utiliza una versi\xf3n con el par\xe1metro ",(0,i.jsx)(n.code,{children:"_data"}),", se pasa a ",(0,i.jsx)(n.code,{children:"IERC721Receiver.onERC721Received()"})," del contrato inteligente de destino como argumento."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function safeTransferFrom(address _from, address _to, uint256 _requestId)\nfunction safeTransferFrom(address _from, address _to, uint256 _requestId, bytes memory _data)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_from"})," no puede ser la direcci\xf3n cero."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_to"})," no puede ser la direcci\xf3n cero."]}),"\n",(0,i.jsxs)(n.li,{children:["El token ",(0,i.jsx)(n.code,{children:"_requestId"})," debe existir y ser propiedad de ",(0,i.jsx)(n.code,{children:"_from"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el llamante no es ",(0,i.jsx)(n.code,{children:"_from"}),", debe tener permiso para mover este token mediante ",(0,i.jsx)(n.code,{children:"approve()"})," o ",(0,i.jsx)(n.code,{children:"setApprovalForAll()"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si ",(0,i.jsx)(n.code,{children:"_to"})," se refiere a un contrato inteligente, debe implementar la interfaz ",(0,i.jsx)(n.code,{children:"IERC721Receiver"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"transferfrom",children:"transferFrom()"}),"\n",(0,i.jsxs)(n.p,{children:["Transfiere el token ",(0,i.jsx)(n.code,{children:"_requestId"})," de ",(0,i.jsx)(n.code,{children:"_from"})," a ",(0,i.jsx)(n.code,{children:"_to"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"ADVERTENCIA"}),": El uso de este m\xe9todo no es recomendable, use ",(0,i.jsx)(n.code,{children:"safeTransferFrom()"})," siempre que sea posible."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function transferFrom(address _from, address _to, uint256 _requestId)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_from"})," no puede ser la direcci\xf3n cero."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_to"})," no puede ser la direcci\xf3n cero."]}),"\n",(0,i.jsxs)(n.li,{children:["El token ",(0,i.jsx)(n.code,{children:"_requestId"})," debe ser propiedad de ",(0,i.jsx)(n.code,{children:"_from"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Si el llamante no es ",(0,i.jsx)(n.code,{children:"_from"}),", debe tener aprobaci\xf3n para mover este token mediante ",(0,i.jsx)(n.code,{children:"approve()"})," o ",(0,i.jsx)(n.code,{children:"setApprovalForAll()"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"getbaseuri",children:"getBaseUri()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve el URI base para calcular el URI del token. Si est\xe1 establecido, el URI resultante para cada token ser\xe1 la concatenaci\xf3n del URI base y el ",(0,i.jsx)(n.code,{children:"_requestId"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getBaseURI() view returns (string memory)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"getnftdescriptoraddress",children:"getNFTDescriptorAddress()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la direcci\xf3n del contrato ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," responsable de la generaci\xf3n del URI del token."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getNFTDescriptorAddress() view returns (address)\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"m\xe9todos-relacionados-con-erc-165",children:["M\xe9todos relacionados con ",(0,i.jsx)(n.code,{children:"ERC-165"})]}),"\n",(0,i.jsx)(n.h3,{id:"supportsinterface",children:"supportsInterface()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve ",(0,i.jsx)(n.code,{children:"true"})," si este contrato implementa la interfaz definida por ",(0,i.jsx)(n.code,{children:"interfaceId"}),". Consulte el ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-165#how-interfaces-are-identified",children:"ERC-165"})," para obtener m\xe1s informaci\xf3n sobre\nc\xf3mo se crean estos ids."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function supportsInterface(bytes4 interfaceId) view returns (bool)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Este contrato devuelve ",(0,i.jsx)(n.code,{children:"true"})," para ",(0,i.jsx)(n.code,{children:"IERC721"}),", ",(0,i.jsx)(n.code,{children:"IERC721Metadata"}),", ",(0,i.jsx)(n.code,{children:"IERC4906"}),", ",(0,i.jsx)(n.code,{children:"IAccessControlEnumerable"}),", ",(0,i.jsx)(n.code,{children:"IAccessControl"})," y ",(0,i.jsx)(n.code,{children:"IERC165"})," en s\xed mismo."]})}),"\n",(0,i.jsx)(n.h2,{id:"m\xe9todos-relacionados-con-la-cola",children:"M\xe9todos relacionados con la cola"}),"\n",(0,i.jsx)(n.h3,{id:"requestwithdrawals",children:"requestWithdrawals()"}),"\n",(0,i.jsxs)(n.p,{children:["Solicita en lote las cantidades ",(0,i.jsx)(n.code,{children:"_amounts"})," de ",(0,i.jsx)(n.code,{children:"stETH"})," para retiro a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Para cada solicitud, la cantidad respectiva de ",(0,i.jsx)(n.code,{children:"stETH"})," se transfiere a esta direcci\xf3n del contrato, y se acu\xf1a un NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function requestWithdrawals(uint256[] _amounts, address _owner) returns (uint256[] requestIds)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la matriz de ids para cada solicitud creada. Emite eventos ",(0,i.jsx)(n.code,{children:"WithdrawalRequested"})," y ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los retiros no deben estar pausados."}),"\n",(0,i.jsxs)(n.li,{children:["El saldo de ",(0,i.jsx)(n.code,{children:"stETH"})," de ",(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser mayor o igual a la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Debe haber aprobaci\xf3n de ",(0,i.jsx)(n.code,{children:"msg.sender"})," a esta direcci\xf3n del contrato para la transferencia total de tokens ",(0,i.jsx)(n.code,{children:"stETH"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cada cantidad en ",(0,i.jsx)(n.code,{children:"_amounts"})," debe ser mayor o igual a ",(0,i.jsx)(n.code,{children:"MIN_STETH_WITHDRAWAL_AMOUNT"})," y menor o igual a ",(0,i.jsx)(n.code,{children:"MAX_STETH_WITHDRAWAL_AMOUNT"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"requestwithdrawalswsteth",children:"requestWithdrawalsWstETH()"}),"\n",(0,i.jsxs)(n.p,{children:["Solicita en lote las cantidades ",(0,i.jsx)(n.code,{children:"_amounts"})," de ",(0,i.jsx)(n.code,{children:"wstETH"})," para retiro a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Para cada solicitud, la cantidad respectiva de ",(0,i.jsx)(n.code,{children:"wstETH"})," se transfiere a esta direcci\xf3n del contrato, se convierte en ",(0,i.jsx)(n.code,{children:"stETH"}),", y se acu\xf1a un NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function requestWithdrawalsWstETH(uint256[] _amounts, address _owner) returns (uint256[] requestIds)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la matriz de ids para cada solicitud creada. Emite eventos ",(0,i.jsx)(n.code,{children:"WithdrawalRequested"})," y ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los retiros no deben estar pausados."}),"\n",(0,i.jsxs)(n.li,{children:["El saldo de ",(0,i.jsx)(n.code,{children:"wstETH"})," de ",(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser mayor o igual a la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Debe haber aprobaci\xf3n de ",(0,i.jsx)(n.code,{children:"msg.sender"})," a esta direcci\xf3n del contrato para la transferencia total de tokens ",(0,i.jsx)(n.code,{children:"wstETH"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cada cantidad en ",(0,i.jsx)(n.code,{children:"_amounts"})," debe tener ",(0,i.jsx)(n.code,{children:"getPooledEthByShares(amount)"})," siendo mayor que ",(0,i.jsx)(n.code,{children:"MIN_STETH_WITHDRAWAL_AMOUNT"}),"\ny menor que ",(0,i.jsx)(n.code,{children:"MAX_STETH_WITHDRAWAL_AMOUNT"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"requestwithdrawalswithpermit",children:"requestWithdrawalsWithPermit()"}),"\n",(0,i.jsxs)(n.p,{children:["Solicita en lote las cantidades ",(0,i.jsx)(n.code,{children:"_amounts"})," de ",(0,i.jsx)(n.code,{children:"stETH"})," para retiro a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Para cada solicitud,\nla cantidad respectiva de ",(0,i.jsx)(n.code,{children:"stETH"})," se transfiere a esta direcci\xf3n del contrato,\ny se acu\xf1a un NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Se utiliza el permiso de ",(0,i.jsx)(n.code,{children:"ERC-2612"})," para aprobar la transferencia de tokens."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function requestWithdrawalsWithPermit(\n    uint256[] _amounts,\n    address _owner,\n    PermitInput _permit\n) returns (uint256[] requestIds)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["donde ",(0,i.jsx)(n.code,{children:"_permit"})," es la estructura de permiso firmada ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:"ERC-2612"})," definida como:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"struct PermitInput {\n    uint256 value;\n    uint256 deadline;\n    uint8 v;\n    bytes32 r;\n    bytes32 s;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la matriz de ids para cada solicitud creada. Emite eventos ",(0,i.jsx)(n.code,{children:"WithdrawalRequested"})," y ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los retiros no deben estar pausados."}),"\n",(0,i.jsxs)(n.li,{children:["El saldo de ",(0,i.jsx)(n.code,{children:"stETH"})," de ",(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser mayor o igual a la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["El permiso debe tener una firma v\xe1lida, un ",(0,i.jsx)(n.code,{children:"value"})," mayor que la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"})," y que no haya expirado el ",(0,i.jsx)(n.code,{children:"deadline"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cada cantidad en ",(0,i.jsx)(n.code,{children:"_amounts"})," debe ser mayor o igual a ",(0,i.jsx)(n.code,{children:"MIN_STETH_WITHDRAWAL_AMOUNT"})," y menor o igual a ",(0,i.jsx)(n.code,{children:"MAX_STETH_WITHDRAWAL_AMOUNT"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"requestwithdrawalswstethwithpermit",children:"requestWithdrawalsWstETHWithPermit()"}),"\n",(0,i.jsxs)(n.p,{children:["Solicita en lote las cantidades ",(0,i.jsx)(n.code,{children:"_amounts"})," de ",(0,i.jsx)(n.code,{children:"wstETH"})," para retiro a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Para cada solicitud, la cantidad respectiva de ",(0,i.jsx)(n.code,{children:"wstETH"})," se transfiere a esta direcci\xf3n del contrato, se convierte en ",(0,i.jsx)(n.code,{children:"stETH"}),", y se acu\xf1a un NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),". Se utiliza el permiso de ",(0,i.jsx)(n.code,{children:"ERC-2612"})," para aprobar la transferencia de tokens."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function requestWithdrawalsWstETHWithPermit(\n  uint256[] _amounts,\n  address _owner,\n  PermitInput _permit\n) returns (uint256[] requestIds)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["donde ",(0,i.jsx)(n.code,{children:"_permit"})," es la estructura de permiso firmada ",(0,i.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-2612",children:"ERC-2612"})," definida como:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"struct PermitInput {\n    uint256 value;\n    uint256 deadline;\n    uint8 v;\n    bytes32 r;\n    bytes32 s;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la matriz de ids para cada solicitud creada. Emite eventos ",(0,i.jsx)(n.code,{children:"WithdrawalRequested"})," y ",(0,i.jsx)(n.code,{children:"Transfer"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Los retiros no deben estar pausados."}),"\n",(0,i.jsxs)(n.li,{children:["El saldo de ",(0,i.jsx)(n.code,{children:"wstETH"})," de ",(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser mayor o igual a la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["El permiso debe tener una firma v\xe1lida, un ",(0,i.jsx)(n.code,{children:"value"})," mayor que la suma de todos los ",(0,i.jsx)(n.code,{children:"_amounts"})," y que no haya expirado el ",(0,i.jsx)(n.code,{children:"deadline"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Cada cantidad en ",(0,i.jsx)(n.code,{children:"_amounts"})," debe tener ",(0,i.jsx)(n.code,{children:"getPooledEthByShares(amount)"})," siendo mayor que ",(0,i.jsx)(n.code,{children:"MIN_STETH_WITHDRAWAL_AMOUNT"}),"\ny menor que ",(0,i.jsx)(n.code,{children:"MAX_STETH_WITHDRAWAL_AMOUNT"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"getwithdrawalrequests",children:"getWithdrawalRequests()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve todas las solicitudes de retiro que pertenecen a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_owner"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getWithdrawalRequests(address _owner) view returns (uint256[] requestsIds)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Esta operaci\xf3n copiar\xe1 todo el almacenamiento en la memoria, lo que puede ser bastante costoso. Este m\xe9todo est\xe1 dise\xf1ado para ser usado principalmente por los accesores de vista que se consultan sin tarifas de gas. Los desarrolladores deben tener en cuenta que esta funci\xf3n tiene un costo ilimitado, y usarla como parte de una funci\xf3n que cambia el estado puede hacer que la funci\xf3n no se pueda llamar si el conjunto crece hasta el punto en que copiarlo a la memoria consume demasiado gas para caber en un bloque."})}),"\n",(0,i.jsx)(n.h3,{id:"getwithdrawalstatus",children:"getWithdrawalStatus()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve ",(0,i.jsx)(n.code,{children:"statuses"})," para las solicitudes con ids en ",(0,i.jsx)(n.code,{children:"_requestIds"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getWithdrawalStatus(uint256[] _requestIds)\n    view\n    returns (WithdrawalRequestStatus[] statuses)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve una matriz de estructuras ",(0,i.jsx)(n.code,{children:"WithdrawalRequestStatus"}),", definidas como:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"struct WithdrawalRequestStatus {\n    uint256 amountOfStETH;\n    uint256 amountOfShares;\n    address owner;\n    uint256 timestamp;\n    bool isFinalized;\n    bool isClaimed;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"amountOfStETH"})})," \u2014 el n\xfamero de tokens ",(0,i.jsx)(n.code,{children:"stETH"})," transferidos al contrato al momento de la solicitud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"amountOfShares"})})," \u2014 el n\xfamero de acciones subyacentes correspondientes a los tokens ",(0,i.jsx)(n.code,{children:"stETH"})," transferidos. Consulte el ",(0,i.jsx)(n.a,{href:"/contracts/lido#rebase",children:"cap\xedtulo de rebalanceo de Lido"})," para obtener informaci\xf3n sobre la mec\xe1nica de las acciones."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"owner"})})," \u2014 la direcci\xf3n del propietario de esta solicitud. El propietario tambi\xe9n es titular del NFT ",(0,i.jsx)(n.code,{children:"unstETH"})," y puede transferir la propiedad y reclamar el ether subyacente una vez finalizado."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"timestamp"})})," \u2014 la hora de creaci\xf3n de la solicitud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"isFinalized"})})," \u2014 estado de finalizaci\xf3n de la solicitud; las solicitudes finalizadas est\xe1n disponibles para ser reclamadas."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"isClaimed"})})," \u2014 estado de reclamaci\xf3n de la solicitud. Una vez reclamado, el NFT se quema y la solicitud no est\xe1 disponible para ser reclamada nuevamente."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"getclaimableether",children:"getClaimableEther()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve las cantidades de ether disponibles para reclamar para cada id de solicitud proporcionado."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getClaimableEther(uint256[] _requestIds, uint256[] _hints)\n    view\n    returns (uint256[] claimableEthValues)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_requestIds"})})," \u2014 la matriz de ids de solicitud para verificar el ether reclamable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_hints"})})," \u2014 pista de punto de control para cada id de solicitud. Se puede obtener llamando a ",(0,i.jsx)(n.a,{href:"#findcheckpointhints",children:(0,i.jsx)(n.code,{children:"findCheckpointHints()"})}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Devuelve la matriz de cantidades de ether disponibles para reclamar para cada id de solicitud. La cantidad es igual a 0 si la solicitud no est\xe1 finalizada o ya ha sido reclamada."}),"\n",(0,i.jsx)(n.h3,{id:"claimwithdrawalsto",children:"claimWithdrawalsTo()"}),"\n",(0,i.jsxs)(n.p,{children:["Reclama un lote de solicitudes de retiro si est\xe1n finalizadas, enviando ether a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"_recipient"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function claimWithdrawalsTo(uint256[] _requestIds, uint256[] _hints, address _recipient)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_requestIds"})})," \u2014 la matriz de ids de solicitud para verificar el ether reclamable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_hints"})})," \u2014 pista de punto de control para cada id de solicitud. Se puede obtener llamando a ",(0,i.jsx)(n.a,{href:"#findcheckpointhints",children:(0,i.jsx)(n.code,{children:"findCheckpointHints()"})}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_recipient"})})," \u2014 la direcci\xf3n del destinatario para el ether reclamado."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un lote de eventos ",(0,i.jsx)(n.code,{children:"Transfer"})," a la direcci\xf3n cero y eventos ",(0,i.jsx)(n.code,{children:"WithdrawalClaimed"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Todos los ",(0,i.jsx)(n.code,{children:"_requestIds"})," deben existir, estar finalizados y no reclamados."]}),"\n",(0,i.jsxs)(n.li,{children:["Todas las ",(0,i.jsx)(n.code,{children:"_hints"})," deben ser v\xe1lidas para las solicitudes respectivas."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser el propietario de todas las solicitudes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_recipient"})," no debe ser cero."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"claimwithdrawals",children:"claimWithdrawals()"}),"\n",(0,i.jsxs)(n.p,{children:["Reclama un lote de solicitudes de retiro si est\xe1n finalizadas, enviando ether a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"msg.sender"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function claimWithdrawals(uint256[] _requestIds, uint256[] _hints)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_requestIds"})})," \u2014 la matriz de ids de solicitud para verificar el ether reclamable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_hints"})})," \u2014 pista de punto de control para cada id de solicitud. Se puede obtener llamando a ",(0,i.jsx)(n.a,{href:"#findcheckpointhints",children:(0,i.jsx)(n.code,{children:"findCheckpointHints()"})}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un lote de eventos ",(0,i.jsx)(n.code,{children:"Transfer"})," a la direcci\xf3n cero y eventos ",(0,i.jsx)(n.code,{children:"WithdrawalClaimed"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Todos los ",(0,i.jsx)(n.code,{children:"_requestIds"})," deben existir, estar finalizados y no reclamados."]}),"\n",(0,i.jsxs)(n.li,{children:["Todas las ",(0,i.jsx)(n.code,{children:"_hints"})," deben ser v\xe1lidas para las solicitudes respectivas."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser el propietario de todas las solicitudes."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"claimwithdrawal",children:"claimWithdrawal()"}),"\n",(0,i.jsxs)(n.p,{children:["Reclama la solicitud de retiro ",(0,i.jsx)(n.code,{children:"_requestId"}),", enviando ether a la direcci\xf3n ",(0,i.jsx)(n.code,{children:"msg.sender"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function claimWithdrawal(uint256 _requestId)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Transfer"})," a la direcci\xf3n cero y un evento ",(0,i.jsx)(n.code,{children:"WithdrawalClaimed"}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe ser el propietario de la solicitud ",(0,i.jsx)(n.code,{children:"_requestId"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["La solicitud ",(0,i.jsx)(n.code,{children:"_requestId"})," debe existir, estar finalizada y no reclamada."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"findcheckpointhints",children:"findCheckpointHints()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve una matriz de pistas para los ",(0,i.jsx)(n.code,{children:"_requestIds"})," dados, buscando entre los puntos de control con \xedndices en el rango ",(0,i.jsx)(n.code,{children:"[_firstIndex, _lastIndex]"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function findCheckpointHints(uint256[] _requestIds, uint256 _firstIndex, uint256 _lastIndex)\n    view\n    returns (uint256[] hintIds)\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"La matriz de ids de solicitud debe estar ordenada."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_firstIndex"})," debe ser mayor que 0, porque la lista de puntos de control es una matriz basada en 1."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_lastIndex"})," debe ser menor o igual a ",(0,i.jsx)(n.a,{href:"#getlastcheckpointindex",children:(0,i.jsx)(n.code,{children:"getLastCheckpointIndex()"})}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"isbunkermodeactive",children:"isBunkerModeActive()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve ",(0,i.jsx)(n.code,{children:"true"})," si el modo bunker est\xe1 activo."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function isBunkerModeActive() view returns (bool)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bunkermodesincetimestamp",children:"bunkerModeSinceTimestamp()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la marca de tiempo de la \xfaltima activaci\xf3n del modo bunker, si est\xe1 activo ahora y ",(0,i.jsx)(n.code,{children:"BUNKER_MODE_DISABLED_TIMESTAMP"})," si el modo bunker est\xe1 desactivado (es decir, el protocolo est\xe1 en modo turbo)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function bunkerModeSinceTimestamp() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"getlastrequestid",children:"getLastRequestId()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el id de la \xfaltima solicitud en la cola."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getLastRequestId() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Las solicitudes se indexan desde ",(0,i.jsx)(n.code,{children:"1"}),", por lo que devuelve ",(0,i.jsx)(n.code,{children:"0"})," si no hay solicitudes en la cola."]})}),"\n",(0,i.jsx)(n.h3,{id:"getlastfinalizedrequestid",children:"getLastFinalizedRequestId()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el id de la \xfaltima solicitud finalizada en la cola."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getLastFinalizedRequestId() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Las solicitudes se indexan desde ",(0,i.jsx)(n.code,{children:"1"}),", por lo que devuelve ",(0,i.jsx)(n.code,{children:"0"})," si no hay solicitudes finalizadas en la cola."]})}),"\n",(0,i.jsx)(n.h3,{id:"getlockedetheramount",children:"getLockedEtherAmount()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve la cantidad de ether en el balance bloqueada para retiro y disponible para reclamar."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getLockedEtherAmount() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"getlastcheckpointindex",children:"getLastCheckpointIndex()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve la longitud de la matriz de puntos de control. \xdaltimo valor posible para la pista."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function getLastCheckpointIndex() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Los puntos de control se indexan desde ",(0,i.jsx)(n.code,{children:"1"}),", por lo que devuelve ",(0,i.jsx)(n.code,{children:"0"})," si a\xfan no hay puntos de control."]})}),"\n",(0,i.jsx)(n.h3,{id:"unfinalizedrequestnumber",children:"unfinalizedRequestNumber()"}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el n\xfamero de solicitudes no finalizadas en la cola."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function unfinalizedRequestNumber() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"unfinalizedsteth",children:"unfinalizedStETH()"}),"\n",(0,i.jsxs)(n.p,{children:["Devuelve la cantidad de ",(0,i.jsx)(n.code,{children:"stETH"})," en la cola que a\xfan no se ha finalizado."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function unfinalizedStETH() view returns (uint256)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"calculatefinalizationbatches",children:"calculateFinalizationBatches()"}),"\n",(0,i.jsxs)(n.p,{children:["Vista para uso fuera de la cadena por el demonio del or\xe1culo que calcula cu\xe1ntas solicitudes se pueden finalizar dentro del presupuesto dado, per\xedodo de tiempo y l\xedmites de tasa de acciones. Las solicitudes devueltas se dividen en lotes. Todas las solicitudes que pertenecen a un lote deben tener su tasa de participaci\xf3n por encima o por debajo (o igual) al ",(0,i.jsx)(n.code,{children:"_maxShareRate"}),". A continuaci\xf3n, puede ver un ejemplo de c\xf3mo 14 solicitudes con diferentes tasas de participaci\xf3n se dividir\xe1n en cinco lotes por este m\xe9todo:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:" ^ share rate\n |\n |         \u2022 \u2022\n |       \u2022    \u2022   \u2022 \u2022 \u2022\n |----------------------\u2022------   _maxShareRate\n |   \u2022          \u2022        \u2022 \u2022 \u2022\n | \u2022\n +-------------------------------\x3e requestId\n  | 1 |    2   |3|  4  |   5   |    batch number\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function calculateFinalizationBatches(\n    uint256 _maxShareRate,\n    uint256 _maxTimestamp,\n    uint256 _maxRequestsPerCall,\n    BatchesCalculationState _state\n) external view returns (BatchesCalculationState)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_maxShareRate"})})," \u2014 la tasa de participaci\xf3n m\xe1xima (ETH por participaci\xf3n) que se utilizar\xe1 para la finalizaci\xf3n (precisi\xf3n de 1e27)"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_maxTimestamp"})})," \u2014 la marca de tiempo m\xe1xima de la solicitud que se puede finalizar"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_maxRequestsPerCall"})})," \u2014 el n\xfamero m\xe1ximo de solicitudes que se puede procesar por iteraci\xf3n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_state"})})," \u2014 el estado actual del c\xe1lculo, representado con una estructura ",(0,i.jsx)(n.code,{children:"BatchesCalculationState"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"struct BatchesCalculationState {\n    uint256 remainingEthBudget;\n    bool finished;\n    uint256[MAX_BATCHES_LENGTH] batches;\n    uint256 batchesLength;\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"remainingEthBudget"})})," \u2014 la cantidad actual restante de ether. Debe establecerse en todo el presupuesto de\nla finalizaci\xf3n en la primera llamada."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"finished"})})," \u2014 la bandera que se establece en ",(0,i.jsx)(n.code,{children:"true"})," si se iteran todas las solicitudes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"batches"})})," \u2014 la matriz resultante de lotes, cada uno representado por el id de la \xfaltima solicitud en el lote."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"batchesLength"})})," \u2014 la longitud de la parte llena de la matriz ",(0,i.jsx)(n.code,{children:"batches"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Devuelve el estado actual del c\xe1lculo de lotes de finalizaci\xf3n."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Este m\xe9todo est\xe1 dise\xf1ado para uso iterativo bajo l\xedmites de gas. Por lo tanto, en el caso de que el n\xfamero de retiros sea demasiado grande para iterar en una sola llamada, se puede usar este m\xe9todo repetidamente, pasando el valor de retorno como argumento para la pr\xf3xima llamada mientras devuelva ",(0,i.jsx)(n.code,{children:"finished"})," igual a ",(0,i.jsx)(n.code,{children:"false"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"prefinalize",children:"prefinalize()"}),"\n",(0,i.jsx)(n.p,{children:"Verifica los lotes de finalizaci\xf3n y calcula la cantidad de ether necesaria para bloquear y la cantidad de participaciones a quemar."}),"\n",(0,i.jsxs)(n.p,{children:["Dise\xf1ado para usar durante el informe del or\xe1culo para encontrar la cantidad de ether que se debe enviar junto con la llamada ",(0,i.jsx)(n.code,{children:"finalize()"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function prefinalize(uint256[] _batches, uint256 _maxShareRate)\n    view\n    returns (uint256 ethToLock, uint256 sharesToBurn)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_batches"})})," \u2014 lotes de finalizaci\xf3n calculados fuera de la cadena utilizando ",(0,i.jsx)(n.code,{children:"calculateFinalizationBatches()"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_maxShareRate"})})," \u2014 tasa de participaci\xf3n m\xe1xima (ETH por participaci\xf3n) para la finalizaci\xf3n de solicitudes (precisi\xf3n de 1e27)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Devuelve"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"ethToLock"})})," \u2014 la cantidad de ether a enviar con el m\xe9todo ",(0,i.jsx)(n.code,{children:"finalize()"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"sharesToBurn"})})," \u2014 el n\xfamero de participaciones a quemar para coincidir con esta llamada de finalizaci\xf3n."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"m\xe9todos-protegidos",children:"M\xe9todos protegidos"}),"\n",(0,i.jsx)(n.h3,{id:"roles",children:"Roles"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FINALIZE_ROLE"})," \u2014 rol para finalizar solicitudes de retiro en la cola."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PAUSE_ROLE"})," \u2014 rol para pausar el retiro en el protocolo."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RESUME_ROLE"})," \u2014 rol para reanudar el retiro despu\xe9s de haber sido pausado."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ORACLE_ROLE"})," \u2014 rol para proporcionar los datos relacionados con el or\xe1culo necesarios, como la \xfaltima marca de tiempo del informe y si el protocolo est\xe1 en modo bunker."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MANAGE_TOKEN_URI_ROLE"})," \u2014 rol para establecer los par\xe1metros para construir el URI del token: el URI base\no la direcci\xf3n de ",(0,i.jsx)(n.code,{children:"NFTDescriptor"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"finalize",children:"finalize()"}),"\n",(0,i.jsxs)(n.p,{children:["Finaliza solicitudes desde la \xfaltima finalizada hasta ",(0,i.jsx)(n.code,{children:"_lastRequestIdToBeFinalized"})," utilizando ",(0,i.jsx)(n.code,{children:"_maxShareRate"}),"\ncomo tasa de participaci\xf3n base para ",(0,i.jsx)(n.code,{children:"stETH"})," y pasando junto con algo de ether como ",(0,i.jsx)(n.code,{children:"msg.value"}),".\nLa cantidad de ether a enviar debe precalcularse con el m\xe9todo ",(0,i.jsx)(n.code,{children:"prefinalize()"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"BatchMetadataUpdate"})," y un evento ",(0,i.jsx)(n.code,{children:"WithdrawalsFinalized"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function finalize(uint256 _lastRequestIdToBeFinalized, uint256 _maxShareRate) payable\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_lastRequestIdToBeFinalized"})})," \u2014 el \xfaltimo id de solicitud a finalizar."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_maxShareRate"})})," \u2014 la tasa de participaci\xf3n m\xe1xima (ETH por participaci\xf3n) para la finalizaci\xf3n de solicitudes (precisi\xf3n de 1e27)."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"los retiros no deben estar pausados."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe tener asignado el rol ",(0,i.jsx)(n.code,{children:"FINALIZE_ROLE"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_lastRequestIdToBeFinalized"})," debe ser un id de solicitud no finalizada existente."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.value"})," debe ser menor o igual a la suma de ",(0,i.jsx)(n.code,{children:"stETH"})," no finalizada hasta ",(0,i.jsx)(n.code,{children:"_lastRequestIdToBeFinalized"}),"."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"pausefor",children:"pauseFor()"}),"\n",(0,i.jsxs)(n.p,{children:["Pausa la colocaci\xf3n de solicitudes de retiro y la finalizaci\xf3n durante una ",(0,i.jsx)(n.code,{children:"_duration"})," particular. Reclamar solicitudes finalizadas seguir\xe1 estando disponible."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Paused"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function pauseFor(uint256 _duration) onlyRole(PAUSE_ROLE)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_duration"})})," \u2014 duraci\xf3n de la pausa en segundos (usar ",(0,i.jsx)(n.code,{children:"PAUSE_INFINITELY"})," para ilimitado)."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe tener asignado el rol ",(0,i.jsx)(n.code,{children:"PAUSE_ROLE"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_duration"})," no debe ser cero."]}),"\n",(0,i.jsx)(n.li,{children:"el contrato no debe estar ya pausado."}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"pauseuntil",children:"pauseUntil()"}),"\n",(0,i.jsxs)(n.p,{children:["Pausa la colocaci\xf3n de solicitudes de retiro y la finalizaci\xf3n hasta la marca de tiempo ",(0,i.jsx)(n.code,{children:"_pauseUntilInclusive"}),".\nReclamar solicitudes finalizadas seguir\xe1 estando disponible."]}),"\n",(0,i.jsxs)(n.p,{children:["Emite un evento ",(0,i.jsx)(n.code,{children:"Paused"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function pauseUntil(uint256 _pauseUntilInclusive) onlyRole(PAUSE_ROLE)\n"})}),"\n",(0,i.jsx)(n.p,{children:"donde"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_pauseUntilInclusive"})})," \u2014 la marca de tiempo ",(0,i.jsx)(n.code,{children:"block.timestamp"})," hasta la cual pausar (inclusive)."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requisitos:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," debe tener asignado el rol ",(0,i.jsx)(n.code,{children:"PAUSE_ROLE"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_pauseUntilInclusive"})," no debe estar en el pasado."]}),"\n",(0,i.jsx)(n.li,{children:"el contrato no debe estar ya pausado."}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"resume",children:"resume()"}),"\n",(0,i.jsx)(n.p,{children:"Resumes withdrawal requests placement and finalization.\nThe contract is deployed in a paused state and should be resumed explicitly."}),"\n",(0,i.jsxs)(n.p,{children:["Emits a ",(0,i.jsx)(n.code,{children:"Resumed"})," event."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function resume()\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requirements:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," must have a ",(0,i.jsx)(n.code,{children:"RESUME_ROLE"})," assigned"]}),"\n",(0,i.jsx)(n.li,{children:"the contract must not be already resumed"}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"onoraclereport",children:"onOracleReport()"}),"\n",(0,i.jsx)(n.p,{children:"Updates bunker mode state and last report timestamp."}),"\n",(0,i.jsxs)(n.p,{children:["Emits a ",(0,i.jsx)(n.code,{children:"BunkerModeEnabled"})," or a ",(0,i.jsx)(n.code,{children:"BunkerModeDisabled"})," event."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function onOracleReport(\n    bool _isBunkerModeNow,\n    uint256 _bunkerStartTimestamp,\n    uint256 _currentReportTimestamp\n)\n"})}),"\n",(0,i.jsx)(n.p,{children:"where"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_isBunkerModeNow"})})," \u2014 is bunker mode reported by the oracle"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_bunkerStartTimestamp"})})," \u2014 timestamp of the bunker mode activation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_currentReportTimestamp"})})," \u2014 timestamp of the current report ref slot"]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Requirements:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"msg.sender"})," must have an ",(0,i.jsx)(n.code,{children:"ORACLE_ROLE"})," assigned"]}),"\n",(0,i.jsx)(n.li,{children:"all timestamps must be in the past"}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"setbaseuri",children:"setBaseUri()"}),"\n",(0,i.jsx)(n.p,{children:"Sets the Base URI for computing token URI."}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," address isn't set, the ",(0,i.jsx)(n.code,{children:"baseURI"})," would be used for generating the ",(0,i.jsx)(n.code,{children:"ERC-721"})," token URI.\nOtherwise, the ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," address would be used as a first-priority method."]}),"\n",(0,i.jsxs)(n.p,{children:["Emits a ",(0,i.jsx)(n.code,{children:"BaseURISet"})," event"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function setBaseURI(string _baseURI) external onlyRole(MANAGE_TOKEN_URI_ROLE)\n"})}),"\n",(0,i.jsx)(n.p,{children:"where"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_baseURI"})})," \u2014 the base URI to derive the token URI from. Should not end on ",(0,i.jsx)(n.code,{children:"/"})]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Reverts if ",(0,i.jsx)(n.code,{children:"msg.sender"})," has no ",(0,i.jsx)(n.code,{children:"MANAGE_TOKEN_URI_ROLE"})," assigned."]})}),"\n",(0,i.jsx)(n.h3,{id:"setnftdescriptoraddress",children:"setNFTDescriptorAddress()"}),"\n",(0,i.jsxs)(n.p,{children:["Sets the address of the ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," contract responsible for token URI generation."]}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," address isn't set, the ",(0,i.jsx)(n.code,{children:"baseURI"})," would be used for generating the ",(0,i.jsx)(n.code,{children:"ERC-721"})," token URI.\nOtherwise, the ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," address would be used as a first-priority method."]}),"\n",(0,i.jsxs)(n.p,{children:["Emits a ",(0,i.jsx)(n.code,{children:"NftDescriptorAddressSet"})," event."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"function setNFTDescriptorAddress(address _nftDescriptorAddress) onlyRole(MANAGE_TOKEN_URI_ROLE)\n"})}),"\n",(0,i.jsx)(n.p,{children:"where"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"_nftDescriptorAddress"})})," \u2014 is the address of ",(0,i.jsx)(n.code,{children:"NFTDescriptor"})," contract,\nwhich must support the ",(0,i.jsx)(n.code,{children:"INFTDescriptor"})," interface:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sol",children:"interface INFTDescriptor {\n  function constructTokenURI(uint256 _requestId) external view returns (string memory)\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Reverts if ",(0,i.jsx)(n.code,{children:"msg.sender"})," has no ",(0,i.jsx)(n.code,{children:"MANAGE_TOKEN_URI_ROLE"})," assigned."]})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var i=s(6540);const d={},a=i.createContext(d);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);