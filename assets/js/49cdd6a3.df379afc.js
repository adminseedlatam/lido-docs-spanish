"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3997],{7519:(e,s,d)=>{d.r(s),d.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var n=d(4848),i=d(8453);const r={},l="M\xf3dulo de Seguridad de Dep\xf3sitos (DepositSecurityModule)",a={id:"contracts/deposit-security-module",title:"M\xf3dulo de Seguridad de Dep\xf3sitos (DepositSecurityModule)",description:"- C\xf3digo Fuente",source:"@site/docs/contracts/deposit-security-module.md",sourceDirName:"contracts",slug:"/contracts/deposit-security-module",permalink:"/contracts/deposit-security-module",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/deposit-security-module.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"wstETH",permalink:"/contracts/wsteth"},next:{title:"Burner",permalink:"/contracts/burner"}},c={},o=[{value:"M\xe9todos de Vista",id:"m\xe9todos-de-vista",level:2},{value:"getOwner()",id:"getowner",level:3},{value:"getPauseIntentValidityPeriodBlocks()",id:"getpauseintentvalidityperiodblocks",level:3},{value:"getMaxDeposits()",id:"getmaxdeposits",level:3},{value:"getMinDepositBlockDistance()",id:"getmindepositblockdistance",level:3},{value:"getGuardianQuorum()",id:"getguardianquorum",level:3},{value:"getGuardians()",id:"getguardians",level:3},{value:"isGuardian()",id:"isguardian",level:3},{value:"Par\xe1metros",id:"par\xe1metros",level:4},{value:"getGuardianIndex()",id:"getguardianindex",level:3},{value:"Par\xe1metros",id:"par\xe1metros-1",level:4},{value:"canDeposit()",id:"candeposit",level:3},{value:"Par\xe1metros",id:"par\xe1metros-2",level:4},{value:"M\xe9todos",id:"m\xe9todos",level:2},{value:"setOwner()",id:"setowner",level:3},{value:"Par\xe1metros",id:"par\xe1metros-3",level:4},{value:"setPauseIntentValidityPeriodBlocks()",id:"setpauseintentvalidityperiodblocks",level:3},{value:"Par\xe1metros",id:"par\xe1metros-4",level:4},{value:"setMaxDeposits()",id:"setmaxdeposits",level:3},{value:"Par\xe1metros",id:"par\xe1metros-5",level:4},{value:"setMinDepositBlockDistance()",id:"setmindepositblockdistance",level:3},{value:"Par\xe1metros",id:"par\xe1metros-6",level:4},{value:"setGuardianQuorum()",id:"setguardianquorum",level:3},{value:"Par\xe1metros",id:"par\xe1metros-7",level:4},{value:"addGuardian()",id:"addguardian",level:3},{value:"Par\xe1metros",id:"par\xe1metros-8",level:4},{value:"addGuardians()",id:"addguardians",level:3},{value:"Par\xe1metros",id:"par\xe1metros-9",level:4},{value:"removeGuardian()",id:"removeguardian",level:3},{value:"Par\xe1metros",id:"par\xe1metros-10",level:3},{value:"pauseDeposits()",id:"pausedeposits",level:3},{value:"Par\xe1metros",id:"par\xe1metros-11",level:3},{value:"unpauseDeposits()",id:"unpausedeposits",level:3},{value:"Par\xe1metros",id:"par\xe1metros-12",level:3},{value:"depositBufferedEther()",id:"depositbufferedether",level:3},{value:"Par\xe1metros",id:"par\xe1metros-13",level:3}];function t(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"m\xf3dulo-de-seguridad-de-dep\xf3sitos-depositsecuritymodule",children:"M\xf3dulo de Seguridad de Dep\xf3sitos (DepositSecurityModule)"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/DepositSecurityModule.sol",children:"C\xf3digo Fuente"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://etherscan.io/address/0xC77F8768774E1c9244BEed705C4354f2113CFc09",children:"Contrato Desplegado"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Debido a una vulnerabilidad de front-running, ",(0,n.jsx)(s.a,{href:"https://github.com/lidofinance/lido-improvement-proposals/blob/develop/LIPS/lip-5.md",children:"proponemos"})," establecer el Comit\xe9 de Seguridad de Dep\xf3sitos dedicado a garantizar la seguridad de los dep\xf3sitos en la cadena Beacon:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"monitorear el historial de dep\xf3sitos y el conjunto de claves de Lido disponibles para el dep\xf3sito, firmando y difundiendo mensajes que permitan dep\xf3sitos;"}),"\n",(0,n.jsx)(s.li,{children:"firmar el mensaje especial que permite a cualquier persona pausar los dep\xf3sitos una vez que se detecten pre-dep\xf3sitos maliciosos de operadores de nodos."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Cada miembro debe generar una direcci\xf3n EOA para firmar mensajes con su clave privada. Las direcciones de los miembros del comit\xe9 se a\xf1adir\xe1n al contrato inteligente."}),"\n",(0,n.jsx)(s.p,{children:"Para hacer un dep\xf3sito, proponemos recolectar un qu\xf3rum de 4/6 de las firmas de los miembros del comit\xe9. Los miembros del comit\xe9 pueden coludirse con los operadores de nodos y robar dinero firmando datos incorrectos que contienen pre-dep\xf3sitos maliciosos. Para mitigar esto, proponemos permitir que un solo miembro del comit\xe9 detenga los dep\xf3sitos y tambi\xe9n hacer cumplir los dep\xf3sitos espaciales en el tiempo (por ejemplo, no m\xe1s de 150 dep\xf3sitos con 25 bloques entre ellos) para proporcionar al participante honesto la capacidad de detener m\xe1s dep\xf3sitos incluso si la supermayor\xeda se colude."}),"\n",(0,n.jsxs)(s.p,{children:["El guardi\xe1n mismo, o cualquier otra persona que tenga un mensaje de pausa firmado, puede llamar a ",(0,n.jsx)(s.code,{children:"pauseDeposits"})," que pausa ",(0,n.jsx)(s.code,{children:"DepositSecurityModule"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["Para prevenir un ataque de repetici\xf3n, los guardianes firman el n\xfamero de bloque cuando se observan pre-dep\xf3sitos maliciosos. Despu\xe9s de un cierto n\xfamero de bloques (",(0,n.jsx)(s.code,{children:"pauseIntentValidityPeriodBlocks"}),") el mensaje se vuelve inv\xe1lido."]}),"\n",(0,n.jsxs)(s.p,{children:["Los valores de los par\xe1metros ",(0,n.jsx)(s.code,{children:"maxDepositsPerBlock"})," y ",(0,n.jsx)(s.code,{children:"minDepositBlockDistance"})," son controlados por Lido DAO y deben armonizarse con ",(0,n.jsx)(s.code,{children:"churnValidatorsPerDayLimit"})," de ",(0,n.jsx)(s.a,{href:"/contracts/oracle-report-sanity-checker",children:(0,n.jsx)(s.code,{children:"OracleReportSanityChecker"})}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"m\xe9todos-de-vista",children:"M\xe9todos de Vista"}),"\n",(0,n.jsx)(s.h3,{id:"getowner",children:"getOwner()"}),"\n",(0,n.jsx)(s.p,{children:"Devuelve la direcci\xf3n del propietario del contrato."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getOwner() external view returns (address);\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getpauseintentvalidityperiodblocks",children:"getPauseIntentValidityPeriodBlocks()"}),"\n",(0,n.jsxs)(s.p,{children:["Devuelve ",(0,n.jsx)(s.code,{children:"PAUSE_INTENT_VALIDITY_PERIOD_BLOCKS"})," (ver ",(0,n.jsx)(s.code,{children:"pauseDeposits"}),")."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getPauseIntentValidityPeriodBlocks() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getmaxdeposits",children:"getMaxDeposits()"}),"\n",(0,n.jsxs)(s.p,{children:["Devuelve la cantidad m\xe1xima de dep\xf3sitos por bloque (ver ",(0,n.jsx)(s.code,{children:"depositBufferedEther"}),")."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getMaxDeposits() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getmindepositblockdistance",children:"getMinDepositBlockDistance()"}),"\n",(0,n.jsxs)(s.p,{children:["Devuelve la distancia m\xednima en bloques entre dep\xf3sitos (ver ",(0,n.jsx)(s.code,{children:"depositBufferedEther"}),")."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getMinDepositBlockDistance() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getguardianquorum",children:"getGuardianQuorum()"}),"\n",(0,n.jsx)(s.p,{children:"Devuelve el n\xfamero de firmas v\xe1lidas de guardianes requeridas para verificar el par (depositRoot, nonce)."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getGuardianQuorum() external view returns (uint256)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"getguardians",children:"getGuardians()"}),"\n",(0,n.jsx)(s.p,{children:"Devuelve la lista de miembros del comit\xe9 de guardianes."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getGuardians() external view returns (address[] memory)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"isguardian",children:"isGuardian()"}),"\n",(0,n.jsx)(s.p,{children:"Verifica si la direcci\xf3n dada es un guardi\xe1n."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function isGuardian(address addr) external view returns (bool)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"addr"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address"})}),(0,n.jsx)(s.td,{children:"Direcci\xf3n ETH-1 v\xe1lida"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"getguardianindex",children:"getGuardianIndex()"}),"\n",(0,n.jsx)(s.p,{children:"Devuelve el \xedndice del guardi\xe1n, o -1 si la direcci\xf3n no es un guardi\xe1n."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function getGuardianIndex(address addr) external view returns (int256)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-1",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"addr"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address"})}),(0,n.jsx)(s.td,{children:"Direcci\xf3n ETH-1 v\xe1lida"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"candeposit",children:"canDeposit()"}),"\n",(0,n.jsxs)(s.p,{children:["Devuelve si se puede llamar a ",(0,n.jsx)(s.code,{children:"LIDO.deposit()"})," y hacer un dep\xf3sito para el m\xf3dulo de staking con id ",(0,n.jsx)(s.code,{children:"stakingModuleId"}),", dado que el llamador proporcionar\xe1 las certificaciones de los guardianes de la ra\xedz de dep\xf3sito no obsoleta y ",(0,n.jsx)(s.code,{children:"nonce"}),", y el n\xfamero de tales certificaciones ser\xe1 suficiente para alcanzar un qu\xf3rum."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function canDeposit(uint256 stakingModuleId) external view returns (bool)\n"})}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-2",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stakingModuleId"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Id del m\xf3dulo de staking"})]})})]}),"\n",(0,n.jsx)(s.h2,{id:"m\xe9todos",children:"M\xe9todos"}),"\n",(0,n.jsx)(s.h3,{id:"setowner",children:"setOwner()"}),"\n",(0,n.jsx)(s.p,{children:"Establece un nuevo propietario."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function setOwner(address newValue) external;\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"newValue"})," es la direcci\xf3n cero."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-3",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newValue"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address"})}),(0,n.jsx)(s.td,{children:"Nueva direcci\xf3n del propietario"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"setpauseintentvalidityperiodblocks",children:"setPauseIntentValidityPeriodBlocks()"}),"\n",(0,n.jsxs)(s.p,{children:["Establece ",(0,n.jsx)(s.code,{children:"pauseIntentValidityPeriodBlocks"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function setPauseIntentValidityPeriodBlocks(uint256 newValue)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"newValue"})," es 0 (cero)."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-4",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newValue"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"N\xfamero de bloques despu\xe9s de los cuales el mensaje se vuelve inv\xe1lido"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"setmaxdeposits",children:"setMaxDeposits()"}),"\n",(0,n.jsxs)(s.p,{children:["Establece ",(0,n.jsx)(s.code,{children:"maxDepositsPerBlock"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["El valor debe armonizarse con el par\xe1metro ",(0,n.jsx)(s.code,{children:"churnValidatorsPerDayLimit"})," de ",(0,n.jsx)(s.a,{href:"/contracts/oracle-report-sanity-checker",children:"OracleReportSanityChecker"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function setMaxDeposits(uint256 newValue)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-5",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newValue"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor del par\xe1metro maxDepositsPerBlock"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"setmindepositblockdistance",children:"setMinDepositBlockDistance()"}),"\n",(0,n.jsxs)(s.p,{children:["Establece ",(0,n.jsx)(s.code,{children:"minDepositBlockDistance"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["El valor debe armonizarse con el par\xe1metro ",(0,n.jsx)(s.code,{children:"churnValidatorsPerDayLimit"})," de ",(0,n.jsx)(s.a,{href:"/contracts/oracle-report-sanity-checker",children:"OracleReportSanityChecker"}),"."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function setMinDepositBlockDistance(uint256 newValue)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-6",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newValue"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor del par\xe1metro minDepositBlockDistance"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"setguardianquorum",children:"setGuardianQuorum()"}),"\n",(0,n.jsx)(s.p,{children:'Establece el n\xfamero de firmas v\xe1lidas de guardianes requeridas para verificar el par (depositRoot, nonce) (tambi\xe9n conocido como "qu\xf3rum").'}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function setGuardianQuorum(uint256 newValue)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-7",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newValue"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor del qu\xf3rum"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"addguardian",children:"addGuardian()"}),"\n",(0,n.jsx)(s.p,{children:"A\xf1ade una direcci\xf3n de guardi\xe1n y establece un nuevo valor de qu\xf3rum."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function addGuardian(address addr, uint256 newQuorum)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"addr"})," ya es un guardi\xe1n."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-8",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"addr"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address"})}),(0,n.jsx)(s.td,{children:"Direcci\xf3n del guardi\xe1n"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newQuorum"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor del qu\xf3rum"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"addguardians",children:"addGuardians()"}),"\n",(0,n.jsx)(s.p,{children:"A\xf1ade un conjunto de direcciones de guardianes y establece un nuevo valor de qu\xf3rum."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function addGuardians(address[] memory addresses, uint256 newQuorum)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n",(0,n.jsxs)(s.li,{children:["cualquiera de las ",(0,n.jsx)(s.code,{children:"addresses"})," ya es un guardi\xe1n."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h4,{id:"par\xe1metros-9",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"addresses"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address[]"})}),(0,n.jsx)(s.td,{children:"Array de direcciones de guardianes"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newQuorum"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor del qu\xf3rum"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"removeguardian",children:"removeGuardian()"}),"\n",(0,n.jsx)(s.p,{children:"Elimina un guardi\xe1n con la direcci\xf3n dada y establece un nuevo valor de qu\xf3rum."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sol",children:"function removeGuardian(address addr, uint256 newQuorum)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revierte si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario;"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"addr"})," no es un guardi\xe1n."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h3,{id:"par\xe1metros-10",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"addr"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"address"})}),(0,n.jsx)(s.td,{children:"Direcci\xf3n del guardi\xe1n"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"newQuorum"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nuevo valor de qu\xf3rum"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"pausedeposits",children:"pauseDeposits()"}),"\n",(0,n.jsx)(s.p,{children:"Pausa los dep\xf3sitos para el m\xf3dulo de staking siempre que se cumplan ambas condiciones (de lo contrario, revierte):"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["La funci\xf3n es llamada por el guardi\xe1n con \xedndice ",(0,n.jsx)(s.code,{children:"guardianIndex"})," O ",(0,n.jsx)(s.code,{children:"sig"})," es una firma v\xe1lida por el guardi\xe1n con \xedndice ",(0,n.jsx)(s.code,{children:"guardianIndex"})," de los datos definidos a continuaci\xf3n."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.code,{children:"block.number - blockNumber <= pauseIntentValidityPeriodBlocks"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["La firma, si est\xe1 presente, debe ser producida para el hash ",(0,n.jsx)(s.code,{children:"keccak256"})," del siguiente mensaje (cada componente tomando 32 bytes):"]}),"\n",(0,n.jsx)(s.p,{children:"| PAUSE_MESSAGE_PREFIX | blockNumber | stakingModuleId |"}),"\n",(0,n.jsxs)(s.p,{children:["Si el m\xf3dulo de staking no est\xe1 activo, no hace nada.\nEn caso de una emergencia, se supone que la funci\xf3n ",(0,n.jsx)(s.code,{children:"pauseDeposits"})," ser\xe1 llamada por todos los guardianes. Por lo tanto, solo la primera llamada realizar\xe1 el cambio real. As\xed que las otras llamadas ser\xe1n operaciones OK desde el punto de vista de la l\xf3gica del protocolo."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function pauseDeposits(uint256 blockNumber, uint256 stakingModuleId, Signature memory sig)\n"})}),"\n",(0,n.jsx)(s.h3,{id:"par\xe1metros-11",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"blockNumber"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"N\xfamero de bloque donde se han observado pre-dep\xf3sitos maliciosos por el guardi\xe1n"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stakingModuleId"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Id del m\xf3dulo de staking para pausar los dep\xf3sitos"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"sig"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"Signature"})}),(0,n.jsxs)(s.td,{children:["Firma corta de guardianes ECDSA como se define en ",(0,n.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-2098",children:"EIP-2098"})]})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"unpausedeposits",children:"unpauseDeposits()"}),"\n",(0,n.jsx)(s.p,{children:"Reanuda los dep\xf3sitos para el m\xf3dulo de staking.\nSi el m\xf3dulo de staking no est\xe1 pausado, no hace nada."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function unpauseDeposits(uint256 stakingModuleId)\n"})}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revoca si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"msg.sender"})," no es el propietario."]}),"\n"]})]}),"\n",(0,n.jsx)(s.h3,{id:"par\xe1metros-12",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsx)(s.tbody,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stakingModuleId"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Id del m\xf3dulo de staking"})]})})]}),"\n",(0,n.jsx)(s.h3,{id:"depositbufferedether",children:"depositBufferedEther()"}),"\n",(0,n.jsxs)(s.p,{children:["Verifica que se cumplan las condiciones de seguridad del dep\xf3sito y llama a ",(0,n.jsx)(s.code,{children:"LIDO.deposit(maxDepositsPerBlock, stakingModuleId, depositCalldata)"}),". De lo contrario, revoca."]}),"\n",(0,n.jsxs)(s.admonition,{type:"note",children:[(0,n.jsx)(s.p,{children:"Revoca si alguna de las siguientes condiciones es verdadera:"}),(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"IDepositContract.get_deposit_root() != depositRoot"}),";"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"StakingModule.getNonce() != nonce"}),";"]}),"\n",(0,n.jsxs)(s.li,{children:["El n\xfamero de firmas de guardianes es menor que ",(0,n.jsx)(s.code,{children:"getGuardianQuorum()"}),";"]}),"\n",(0,n.jsx)(s.li,{children:"Se recibi\xf3 una firma no v\xe1lida o no de un guardi\xe1n;"}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"block.number - StakingModule.getLastDepositBlock() < minDepositBlockDistance"}),";"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"blockhash(blockNumber) != blockHash"}),"."]}),"\n"]})]}),"\n",(0,n.jsxs)(s.p,{children:["Las firmas deben estar ordenadas en orden ascendente por el \xedndice del guardi\xe1n. Cada firma debe ser producida para el hash ",(0,n.jsx)(s.code,{children:"keccak256"})," del siguiente mensaje (cada componente tomando 32 bytes):"]}),"\n",(0,n.jsx)(s.p,{children:"| ATTEST_MESSAGE_PREFIX | blockNumber | blockHash | depositRoot | stakingModuleId | nonce |"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-solidity",children:"function depositBufferedEther(\n        uint256 blockNumber,\n        bytes32 blockHash,\n        bytes32 depositRoot,\n        uint256 stakingModuleId,\n        uint256 nonce,\n        bytes calldata depositCalldata,\n        Signature[] calldata sortedGuardianSignatures\n    )\n"})}),"\n",(0,n.jsx)(s.h3,{id:"par\xe1metros-13",children:"Par\xe1metros"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Nombre"}),(0,n.jsx)(s.th,{children:"Tipo"}),(0,n.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"blockNumber"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"N\xfamero del bloque de dep\xf3sito actual"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"blockHash"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bytes32"})}),(0,n.jsx)(s.td,{children:"Hash del bloque de dep\xf3sito actual"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"depositRoot"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bytes32"})}),(0,n.jsx)(s.td,{children:"Ra\xedz de dep\xf3sito del contrato de dep\xf3sito Ethereum"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"stakingModuleId"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Id del m\xf3dulo de staking para realizar el dep\xf3sito"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"nonce"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"uint256"})}),(0,n.jsx)(s.td,{children:"Nonce de las operaciones clave del m\xf3dulo de staking"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"depositCalldata"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"bytes"})}),(0,n.jsx)(s.td,{children:"Datos de calldata del dep\xf3sito del m\xf3dulo de staking"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"sortedGuardianSignatures"})}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"Signature[]"})}),(0,n.jsxs)(s.td,{children:["Firmas cortas de guardianes ECDSA seg\xfan se define en ",(0,n.jsx)(s.a,{href:"https://eips.ethereum.org/EIPS/eip-2098",children:"EIP-2098"})]})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(t,{...e})}):t(e)}},8453:(e,s,d)=>{d.d(s,{R:()=>l,x:()=>a});var n=d(6540);const i={},r=n.createContext(i);function l(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);