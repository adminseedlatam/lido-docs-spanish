"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9755],{2642:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>a});var d=r(4848),s=r(8453);const o={},c="LegacyOracle",l={id:"contracts/legacy-oracle",title:"LegacyOracle",description:"- C\xf3digo fuente",source:"@site/docs/contracts/legacy-oracle.md",sourceDirName:"contracts",slug:"/contracts/legacy-oracle",permalink:"/contracts/legacy-oracle",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/contracts/legacy-oracle.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"hash-consensus",permalink:"/contracts/hash-consensus"},next:{title:"OracleReportSanityChecker",permalink:"/contracts/oracle-report-sanity-checker"}},t={},a=[{value:"\xbfQu\xe9 es LegacyOracle?",id:"qu\xe9-es-legacyoracle",level:2},{value:"Cambios clave",id:"cambios-clave",level:2},{value:"\xbfC\xf3mo recibe LegacyOracle los reportes de AccountingOracle de todos modos? (flujo)",id:"c\xf3mo-recibe-legacyoracle-los-reportes-de-accountingoracle-de-todos-modos-flujo",level:3},{value:"Rebase y APR",id:"rebase-y-apr",level:3},{value:"C\xf3mo era con LidoOracle",id:"c\xf3mo-era-con-lidooracle",level:4},{value:"Lo nuevo desde Lido V2",id:"lo-nuevo-desde-lido-v2",level:4},{value:"\xbfPor qu\xe9 es importante?",id:"por-qu\xe9-es-importante",level:4},{value:"M\xe9todos de vista",id:"m\xe9todos-de-vista",level:2},{value:"getLido()",id:"getlido",level:3},{value:"getAccountingOracle()",id:"getaccountingoracle",level:3},{value:"getContractVersion()",id:"getcontractversion",level:3},{value:"getVersion()",id:"getversion",level:3},{value:"getBeaconSpec()",id:"getbeaconspec",level:3},{value:"Devoluciones",id:"devoluciones",level:4},{value:"getCurrentEpochId()",id:"getcurrentepochid",level:3},{value:"getCurrentFrame()",id:"getcurrentframe",level:3},{value:"Devoluciones",id:"devoluciones-1",level:4},{value:"getLastCompletedEpochId()",id:"getlastcompletedepochid",level:3},{value:"getLastCompletedReportDelta()",id:"getlastcompletedreportdelta",level:3},{value:"Devoluciones",id:"devoluciones-2",level:4},{value:"M\xe9todos",id:"m\xe9todos",level:2},{value:"handlePostTokenRebase()",id:"handleposttokenrebase",level:3},{value:"Par\xe1metros",id:"par\xe1metros",level:4},{value:"handleConsensusLayerReport()",id:"handleconsensuslayerreport",level:3},{value:"Par\xe1metros",id:"par\xe1metros-1",level:4},{value:"Eventos",id:"eventos",level:2},{value:"Completed()",id:"completed",level:3},{value:"Par\xe1metros",id:"par\xe1metros-2",level:4},{value:"PostTotalShares()",id:"posttotalshares",level:3},{value:"Par\xe1metros",id:"par\xe1metros-3",level:4}];function i(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h1,{id:"legacyoracle",children:"LegacyOracle"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.4.24/oracle/LegacyOracle.sol",children:"C\xf3digo fuente"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://etherscan.io/address/0x442af784A788A5bd6F42A01Ebe9F287a871243fb",children:"Contrato desplegado"})}),"\n"]}),"\n",(0,d.jsx)(n.admonition,{type:"warning",children:(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"LegacyOracle"})," se mantendr\xe1 hasta finales de 2023.\nDespu\xe9s de ese per\xedodo, ser\xe1 descontinuado y las integraciones externas deber\xe1n depender de ",(0,d.jsx)(n.a,{href:"/contracts/accounting-oracle",children:(0,d.jsx)(n.code,{children:"AccountingOracle"})}),"."]})}),"\n",(0,d.jsx)(n.h2,{id:"qu\xe9-es-legacyoracle",children:"\xbfQu\xe9 es LegacyOracle?"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"LegacyOracle"})," es una aplicaci\xf3n de Aragon previamente conocida como ",(0,d.jsx)(n.code,{children:"LidoOracle"}),", utilizada para rastrear cambios en la Beacon Chain.\nTras la actualizaci\xf3n a Lido V2, esto fue reemplazado por ",(0,d.jsx)(n.a,{href:"/contracts/accounting-oracle",children:(0,d.jsx)(n.code,{children:"AccountingOracle"})}),"\ny el flujo del or\xe1culo fue redise\xf1ado para entregar fragmentos de datos hist\xf3ricos sincronizados para el mismo slot de referencia\ntanto para las partes de Capa de Consenso como de Ejecuci\xf3n."]}),"\n",(0,d.jsx)(n.h2,{id:"cambios-clave",children:"Cambios clave"}),"\n",(0,d.jsxs)(n.p,{children:["En Lido V2, ",(0,d.jsx)(n.code,{children:"LegacyOracle"})," solo soporta un subconjunto de funciones de vista y eventos.\n",(0,d.jsx)(n.code,{children:"AccountingOracle"})," interact\xfaa con \xe9l para enviar cambios de datos en cada reporte."]}),"\n",(0,d.jsx)(n.h3,{id:"c\xf3mo-recibe-legacyoracle-los-reportes-de-accountingoracle-de-todos-modos-flujo",children:"\xbfC\xf3mo recibe LegacyOracle los reportes de AccountingOracle de todos modos? (flujo)"}),"\n",(0,d.jsxs)(n.p,{children:["El contrato ",(0,d.jsx)(n.code,{children:"LegacyOracle"})," recibe los cambios de datos en cada reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," usando dos etapas\n(a\xfan dentro de la misma transacci\xf3n):"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["Invoca ",(0,d.jsx)(n.a,{href:"./legacy-oracle#handleconsensuslayerreport",children:(0,d.jsx)(n.code,{children:"handleConsensusLayerReport"})}),"\nproporcionando el slot de referencia y los datos de los validadores del ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," en s\xed mismo."]}),"\n",(0,d.jsxs)(n.li,{children:["Invoca ",(0,d.jsx)(n.a,{href:"./legacy-oracle#handleposttokenrebase",children:(0,d.jsx)(n.code,{children:"handlePostTokenRebase"})}),"\ndesde ",(0,d.jsx)(n.a,{href:"/contracts/lido",children:(0,d.jsx)(n.code,{children:"Lido"})}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.mermaid,{value:"graph LR;\n  A[/  \\]--submitReportData--\x3eAccountingOracle--handleConsensusLayerReport---\x3eLegacyOracle;\n  AccountingOracle--handleOracleReport--\x3eLido--handlePostTokenRebase--\x3eLegacyOracle"}),"\n",(0,d.jsx)(n.h3,{id:"rebase-y-apr",children:"Rebase y APR"}),"\n",(0,d.jsxs)(n.p,{children:["Para calcular las proyecciones diarias de rebase y APR del protocolo, se usar\xedan las API antiguas de ",(0,d.jsx)(n.code,{children:"LidoOracle"})," durante un tiempo.\nAunque la antigua forma de calcular el APR seguir\xeda dando n\xfameros relevantes, las matem\xe1ticas podr\xedan no ser precisas en caso de retiros significativos."]}),"\n",(0,d.jsx)(n.h4,{id:"c\xf3mo-era-con-lidooracle",children:"C\xf3mo era con LidoOracle"}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["La f\xf3rmula est\xe1 desactualizada e inexacta desde la ",(0,d.jsx)(n.a,{href:"https://blog.lido.fi/lido-v2-launch/",children:"actualizaci\xf3n a Lido V2"}),"."]})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"protocolAPR = (postTotalPooledEther - preTotalPooledEther) * secondsInYear / (preTotalPooledEther * timeElapsed)\nlidoFeeAsFraction = lidoFee / basisPoint\nuserAPR = protocolAPR * (1 - lidoFeeAsFraction)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"lo-nuevo-desde-lido-v2",children:"Lo nuevo desde Lido V2"}),"\n",(0,d.jsxs)(n.p,{children:["Consulte la nueva documentaci\xf3n de la API de Lido con respecto a ",(0,d.jsx)(n.a,{href:"/integrations/api#lido-apr",children:"APR"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"// Se emite cuando se reajusta el token (se cambi\xf3 el suministro total y/o las acciones totales)\nevent TokenRebased(\n    uint256 indexed reportTimestamp,\n    uint256 timeElapsed,\n    uint256 preTotalShares,\n    uint256 preTotalEther, /* preTotalPooledEther */\n    uint256 postTotalShares,\n    uint256 postTotalEther, /* postTotalPooledEther */\n    uint256 sharesMintedAsFees /* parte de la tarifa incluida en `postTotalShares` */\n);\n\npreShareRate = preTotalEther * 1e27 / preTotalShares\npostShareRate = postTotalEther * 1e27 / postTotalShares\n\nuserAPR =\n    secondsInYear * (\n        (postShareRate - preShareRate) / preShareRate\n    ) / timeElapsed\n"})}),"\n",(0,d.jsxs)(n.p,{children:["En resumen, la nueva f\xf3rmula tiene en cuenta tanto los valores de ",(0,d.jsx)(n.code,{children:"preTotalShares"})," como ",(0,d.jsx)(n.code,{children:"postTotalShares"}),", mientras que,\nen contraste, la f\xf3rmula antigua no los utilizaba. La nueva f\xf3rmula tampoco requiere calcular ",(0,d.jsx)(n.code,{children:"lidoFee"}),"\nen absoluto (porque la distribuci\xf3n de tarifas funciona cambiando la cantidad total de acciones bajo el cap\xf3)."]}),"\n",(0,d.jsx)(n.h4,{id:"por-qu\xe9-es-importante",children:"\xbfPor qu\xe9 es importante?"}),"\n",(0,d.jsxs)(n.p,{children:["Cuando el protocolo Lido V2 finaliza las solicitudes de retiro, el contrato ",(0,d.jsx)(n.code,{children:"Lido"})," env\xeda ether a la ",(0,d.jsx)(n.code,{children:"WithdrawalQueue"})," (excluyendo estos fondos de ",(0,d.jsx)(n.code,{children:"totalPooledEther"}),", es decir, disminuyendo el TVL) y asigna para quemar acciones subyacentes bloqueadas en las solicitudes ",(0,d.jsx)(n.code,{children:"stETH"}),"."]}),"\n",(0,d.jsx)(n.p,{children:"En otras palabras, la finalizaci\xf3n del retiro disminuye tanto el TVL como las acciones totales."}),"\n",(0,d.jsx)(n.p,{children:"La f\xf3rmula antigua ya no es adecuada porque captura cambios en el TVL, pero omite cambios en las acciones totales."}),"\n",(0,d.jsx)(n.p,{children:"Ejemplo ilustrativo (usando n\xfameros peque\xf1os para simplicidad):"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"preTotalEther = 1000 ETH\npreTotalShares = 1000 * 10^18 // 1 acci\xf3n : 1 wei\n\npostTotalEther = 999 ETH\npostTotalShares = 990 * 10^18\n\ntimeElapsed = 24 * 60 * 60 // 1 d\xeda, o 86400 segundos\n\n//!!! usando el m\xe9todo antiguo (impreciso)\n\n// protocolAPR = (postTotalPooledEther - preTotalPooledEther) * secondsInYear / (preTotalPooledEther * timeElapsed)\nprotocolAPR = (999ETH - 1000ETH) * 31557600 / (1000ETH * 86400) = -0.36525\n//lidoFeeAsFraction = lidoFee / basisPoint = 0.1\n//userAPR = protocolAPR * (1 - lidoFeeAsFraction) = protocolAPR * (1 - 0.1)\n\nuserAPR = -0.36525 * (1 - 0.1) = -0.328725\n\n//!!! es decir, userAPR ahora es ~menos 32.9%\n\n//!!! usando el m\xe9todo actualizado (correcto)\n\npreShareRate = 1000 ETH * 1e27 / 1000 * 10^18 = 1e27\npostShareRate = 999 ETH * 1e27 / 990 * 10^18 = 1.009090909090909e+27\nuserAPR = 31557600 * ((postShareRate - preShareRate) / preShareRate) / 86400 = 3.320454545454529\n\n//!!! es decir, userAPR ahora es ~m\xe1s 332%\n"})}),"\n",(0,d.jsx)(n.h2,{id:"m\xe9todos-de-vista",children:"M\xe9todos de vista"}),"\n",(0,d.jsx)(n.h3,{id:"getlido",children:"getLido()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve la direcci\xf3n del contrato ",(0,d.jsx)(n.code,{children:"Lido"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getLido() returns (address)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["Siempre devuelve la direcci\xf3n de ",(0,d.jsx)(n.code,{children:"Lido"})," indicada en la lista de ",(0,d.jsx)(n.a,{href:"/deployed-contracts",children:"contratos desplegados"}),"."]})}),"\n",(0,d.jsx)(n.h3,{id:"getaccountingoracle",children:"getAccountingOracle()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve la direcci\xf3n del contrato ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getAccountingOracle() returns (address)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["Siempre devuelve la direcci\xf3n de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," indicada en la lista de ",(0,d.jsx)(n.a,{href:"/deployed-contracts",children:"contratos desplegados"}),"."]})}),"\n",(0,d.jsx)(n.h3,{id:"getcontractversion",children:"getContractVersion()"}),"\n",(0,d.jsx)(n.p,{children:"Devuelve la versi\xf3n actual del contrato."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getContractVersion() returns (uint256)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["Siempre devuelve ",(0,d.jsx)(n.code,{children:"4"}),"."]})}),"\n",(0,d.jsx)(n.h3,{id:"getversion",children:"getVersion()"}),"\n",(0,d.jsx)(n.p,{children:"Devuelve la versi\xf3n actual del contrato (m\xe9todo de compatibilidad)."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getVersion() returns (uint256)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["Siempre devuelve ",(0,d.jsx)(n.code,{children:"4"}),", llama internamente a ",(0,d.jsx)(n.code,{children:"getContractVersion()"}),"."]})}),"\n",(0,d.jsx)(n.h3,{id:"getbeaconspec",children:"getBeaconSpec()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve el per\xedodo de marco de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," junto con las constantes de especificaci\xf3n de Ethereum Beacon Chain."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getBeaconSpec() returns (\n    uint64 epochsPerFrame,\n    uint64 slotsPerEpoch,\n    uint64 secondsPerSlot,\n    uint64 genesisTime\n)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsx)(n.p,{children:"Siempre devuelve (225, 32, 12, 1606824023) para Mainnet y (225, 32, 12, 1616508000) para G\xf6rli."})}),"\n",(0,d.jsx)(n.h4,{id:"devoluciones",children:"Devoluciones"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"epochsPerFrame"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint64"})}),(0,d.jsxs)(n.td,{children:["\xc9pocas de Beacon Chain por marco de reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"slotsPerEpoch"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint64"})}),(0,d.jsx)(n.td,{children:"Slots de Beacon Chain por \xe9poca de Beacon Chain"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"secondsPerSlot"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint64"})}),(0,d.jsx)(n.td,{children:"Segundos por slot de Beacon Chain"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"genesisTime"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint64"})}),(0,d.jsx)(n.td,{children:"Marca de tiempo de g\xe9nesis de Beacon Chain"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"getcurrentepochid",children:"getCurrentEpochId()"}),"\n",(0,d.jsx)(n.p,{children:"Devuelve el ID de \xe9poca de"}),"\n",(0,d.jsxs)(n.p,{children:["Beacon Chain calculado a partir del timestamp actual usando la ",(0,d.jsx)(n.a,{href:"./legacy-oracle#getbeaconspec",children:"especificaci\xf3n de cadena de Beacon"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getCurrentEpochId() returns (uint256)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"getcurrentframe",children:"getCurrentFrame()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve la primera \xe9poca del marco actual de reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," as\xed como sus tiempos de inicio y fin en segundos."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getCurrentFrame() returns (\n    uint256 frameEpochId,\n    uint256 frameStartTime,\n    uint256 frameEndTime\n)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"devoluciones-1",children:"Devoluciones"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"frameEpochId"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:["La primera \xe9poca del marco de reporte actual de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"frameStartTime"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"El timestamp de inicio del marco de reporte actual"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"frameEndTime"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"El timestamp de fin del marco de reporte actual"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"getlastcompletedepochid",children:"getLastCompletedEpochId()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve la \xe9poca de inicio del \xfaltimo marco en el que se recibi\xf3 y aplic\xf3 el \xfaltimo reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getLastCompletedEpochId() returns (uint256)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"getlastcompletedreportdelta",children:"getLastCompletedReportDelta()"}),"\n",(0,d.jsxs)(n.p,{children:["Devuelve el cambio en el suministro total ocurrido con el \xfaltimo reporte completado de ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function getLastCompletedReportDelta() returns (\n    uint256 postTotalPooledEther,\n    uint256 preTotalPooledEther,\n    uint256 timeElapsed\n)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"devoluciones-2",children:"Devoluciones"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"postTotalPooledEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total pooled ether post-report (es decir, suministro total)"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"preTotalPooledEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total pooled ether pre-report (es decir, suministro total)"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"timeElapsed"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Tiempo transcurrido desde el \xfaltimo reporte completado, segundos"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"m\xe9todos",children:"M\xe9todos"}),"\n",(0,d.jsx)(n.h3,{id:"handleposttokenrebase",children:"handlePostTokenRebase()"}),"\n",(0,d.jsxs)(n.p,{children:["Maneja un reajuste del token ",(0,d.jsx)(n.code,{children:"stETH"})," incurrido por el reporte exitoso de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," almacenando\nlas estad\xedsticas de ether total y tiempo transcurrido."]}),"\n",(0,d.jsxs)(n.p,{children:["Emite ",(0,d.jsx)(n.a,{href:"./legacy-oracle#posttotalshares",children:(0,d.jsx)(n.code,{children:"PostTotalShares"})})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function handlePostTokenRebase(\n    uint256 reportTimestamp,\n    uint256 timeElapsed,\n    uint256 preTotalShares,\n    uint256 preTotalEther,\n    uint256 postTotalShares,\n    uint256 postTotalEther,\n    uint256 totalSharesMintedAsFees\n)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["El llamante debe ser ",(0,d.jsx)(n.code,{children:"Lido"}),"."]})}),"\n",(0,d.jsx)(n.h4,{id:"par\xe1metros",children:"Par\xe1metros"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"reportTimestamp"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"El timestamp de referencia correspondiente al momento del c\xe1lculo del reporte del or\xe1culo"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"timeElapsed"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Tiempo transcurrido desde el \xfaltimo reporte completado, segundos"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"preTotalShares"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total shares pre-report"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"preTotalEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total pooled ether pre-report (es decir, suministro total)"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"postTotalShares"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total shares post-report"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"postTotalEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"stETH"})," total pooled ether post-report (es decir, suministro total)"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"totalSharesMintedAsFees"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Cantidad total de acciones acu\xf1adas como tarifas del protocolo adem\xe1s de las recompensas acumuladas"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"handleconsensuslayerreport",children:"handleConsensusLayerReport()"}),"\n",(0,d.jsxs)(n.p,{children:["Maneja un nuevo reporte completado de ",(0,d.jsx)(n.code,{children:"AccountingOracle"})," almacenando el ID de \xe9poca correspondiente de Beacon Chain."]}),"\n",(0,d.jsxs)(n.p,{children:["Emite ",(0,d.jsx)(n.a,{href:"./legacy-oracle#completed",children:(0,d.jsx)(n.code,{children:"Completed"})}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sol",children:"function handleConsensusLayerReport(\n    uint256 _refSlot,\n    uint256 _clBalance,\n    uint256 _clValidators\n)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["El llamante debe ser ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]})}),"\n",(0,d.jsx)(n.h4,{id:"par\xe1metros-1",children:"Par\xe1metros"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"_refSlot"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"El slot de referencia correspondiente al momento del c\xe1lculo del reporte del or\xe1culo"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"_clBalance"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Balance de validadores participantes de Lido en el lado de Beacon Chain"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"_clValidators"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"N\xfamero de validadores participantes de Lido en el lado de Beacon Chain"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"eventos",children:"Eventos"}),"\n",(0,d.jsx)(n.h3,{id:"completed",children:"Completed()"}),"\n",(0,d.jsxs)(n.p,{children:["Se emite cada vez que se recibe el reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,d.jsx)(n.p,{children:"Este evento todav\xeda se emite despu\xe9s de que el comit\xe9 del or\xe1culo llega a un consenso sobre un reporte, pero solo por compatibilidad.\nLos valores en este evento ya no son suficientes para calcular APR o TVL debido a los retiros, recompensas de Capa de Ejecuci\xf3n y recompensas de Capa de Consenso."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-solidity",children:"event Completed(\n    uint256 epochId,\n    uint128 beaconBalance,\n    uint128 beaconValidators\n);\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["Se emite dentro de los m\xe9todos ",(0,d.jsx)(n.a,{href:"./legacy-oracle#handleconsensuslayerreport",children:(0,d.jsx)(n.code,{children:"handleConsensusLayerReport"})}),"."]})}),"\n",(0,d.jsx)(n.h4,{id:"par\xe1metros-2",children:"Par\xe1metros"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"epochId"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Identificador de \xe9poca de referencia del reporte"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beaconBalance"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint128"})}),(0,d.jsx)(n.td,{children:"El balance de los validadores participantes de Lido en el lado de Consenso"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"beaconValidators"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint128"})}),(0,d.jsx)(n.td,{children:"El n\xfamero de los validadores participantes de Lido que han aparecido"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"posttotalshares",children:"PostTotalShares()"}),"\n",(0,d.jsxs)(n.p,{children:["Se emite cada vez que se recibe el reporte de ",(0,d.jsx)(n.code,{children:"AccountingOracle"}),"."]}),"\n",(0,d.jsx)(n.p,{children:"Este evento todav\xeda se emite despu\xe9s de cada reajuste, pero solo por compatibilidad. Los valores en este evento no son suficientes para calcular correctamente el APR del reajuste, ya que un reajuste puede resultar de la quema de acciones sin cambiar el total de ETH en posesi\xf3n del protocolo."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-solidity",children:"event PostTotalShares(\n    uint256 postTotalPooledEther,\n    uint256 preTotalPooledEther,\n    uint256 timeElapsed,\n    uint256 totalShares\n)\n"})}),"\n",(0,d.jsx)(n.admonition,{type:"note",children:(0,d.jsxs)(n.p,{children:["El nuevo evento [",(0,d.jsx)(n.code,{children:"TokenRebased"}),"](/docs/integrations/api.md#ultimo-apr-de-lido-para steth) emitido desde el contrato principal de Lido deber\xeda utilizarse en su lugar porque proporciona el total de acciones previas al reporte, que es esencial para estimar correctamente un reajuste del token y su APR proyectado."]})}),"\n",(0,d.jsx)(n.h4,{id:"par\xe1metros-3",children:"Par\xe1metros"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Nombre"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"postTotalPooledEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Ether total post-report (es decir, suministro total)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"preTotalPooledEther"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Ether total pre-report (es decir, suministro total)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"timeElapsed"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Tiempo transcurrido desde el reporte anterior, segundos"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"totalShares"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"uint256"})}),(0,d.jsx)(n.td,{children:"Acciones totales post-report"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(i,{...e})}):i(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var d=r(6540);const s={},o=d.createContext(s);function c(e){const n=d.useContext(o);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),d.createElement(o.Provider,{value:n},e.children)}}}]);