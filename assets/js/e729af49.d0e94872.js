"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1652],{9795:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>d,toc:()=>t});var r=n(4848),s=n(8453);const i={},o="Informaci\xf3n General",d={id:"gu\xedas/node-operators/exits/general-information",title:"Informaci\xf3n General",description:"\xbfQu\xe9 son los Mensajes de Salida?",source:"@site/docs/gu\xedas/node-operators/exits/general-information.md",sourceDirName:"gu\xedas/node-operators/exits",slug:"/gu\xedas/node-operators/exits/general-information",permalink:"/gu\xedas/node-operators/exits/general-information",draft:!1,unlisted:!1,editUrl:"https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/gu\xedas/node-operators/exits/general-information.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Introducci\xf3n",permalink:"/gu\xedas/node-operators/exits/introduction"},next:{title:"Generaci\xf3n y Firma de Mensajes de Salida",permalink:"/gu\xedas/node-operators/exits/exit-message-generation-signing"}},l={},t=[{value:"\xbfQu\xe9 son los Mensajes de Salida?",id:"qu\xe9-son-los-mensajes-de-salida",level:2},{value:"Pre-firmar o No Pre-firmar",id:"pre-firmar-o-no-pre-firmar",level:2},{value:"\xbfCu\xe1ntas Claves Pre-firmar?",id:"cu\xe1ntas-claves-pre-firmar",level:2},{value:"C\xf3mo Entender Qu\xe9 Claves Pre-firmar",id:"c\xf3mo-entender-qu\xe9-claves-pre-firmar",level:2},{value:"Usando KAPI (recomendado)",id:"usando-kapi-recomendado",level:3},{value:"Manualmente",id:"manualmente",level:3},{value:"Almacenamiento de Mensajes de Salida Firmados",id:"almacenamiento-de-mensajes-de-salida-firmados",level:2},{value:"C\xf3mo Iniciar un Retiro de Validador",id:"c\xf3mo-iniciar-un-retiro-de-validador",level:2}];function c(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.h1,{id:"informaci\xf3n-general",children:"Informaci\xf3n General"}),"\n",(0,r.jsx)(a.h2,{id:"qu\xe9-son-los-mensajes-de-salida",children:"\xbfQu\xe9 son los Mensajes de Salida?"}),"\n",(0,r.jsxs)(a.p,{children:["Para iniciar un retiro de validador, es necesario generar, firmar y enviar un ",(0,r.jsx)(a.a,{href:"https://github.com/ethereum/consensus-specs/blob/v1.0.1/specs/phase0/beacon-chain.md#voluntaryexit",children:"mensaje de salida"})," a un Nodo de Consenso."]}),"\n",(0,r.jsx)(a.p,{children:"Tiene el siguiente formato:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'{\n  "message": { "epoch": "123", "validator_index": "123" },\n  "signature": "0x123"\n}\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Una vez generado, se firma utilizando la clave BLS del validador que necesita ser retirado y se forma un ",(0,r.jsx)(a.a,{href:"https://github.com/ethereum/consensus-specs/blob/v1.0.1/specs/phase0/beacon-chain.md#signedvoluntaryexit",children:"mensaje de salida firmado"}),"."]}),"\n",(0,r.jsx)(a.h2,{id:"pre-firmar-o-no-pre-firmar",children:"Pre-firmar o No Pre-firmar"}),"\n",(0,r.jsx)(a.p,{children:"En resumen, es una soluci\xf3n bien equilibrada que permite lograr una automatizaci\xf3n significativa sin sacrificar la seguridad o la descentralizaci\xf3n."}),"\n",(0,r.jsxs)(a.p,{children:["Puedes encontrar la raz\xf3n detr\xe1s del enfoque sugerido en el ",(0,r.jsx)(a.a,{href:"https://hackmd.io/@lido/BkxRxAr-o",children:"RFC de Automatizaci\xf3n de Retiros de Validadores de Lido"}),"."]}),"\n",(0,r.jsx)(a.p,{children:"Sin embargo, si ya tienes herramientas establecidas para crear y enviar mensajes de salida, puedes utilizar el modo webhook del Ejector, el cual llama a un punto final para iniciar un retiro de validador."}),"\n",(0,r.jsx)(a.p,{children:"En el punto final, se enviar\xe1 un JSON con la siguiente estructura:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'{\n  "validatorIndex": "123",\n  "validatorPubkey": "0x123"\n}\n'})}),"\n",(0,r.jsx)(a.p,{children:"Una respuesta 200 se contar\xe1 como un retiro exitoso, y cualquier otra respuesta se considerar\xe1 un fallo."}),"\n",(0,r.jsxs)(a.p,{children:["Si esto no es suficiente, deber\xe1s bifurcar el Ejector o monitorear los eventos ",(0,r.jsx)(a.code,{children:"ValidatorExitRequest"})," del ",(0,r.jsx)(a.a,{href:"https://github.com/lidofinance/lido-dao/blob/feature/shapella-upgrade/contracts/0.8.9/oracle/ValidatorsExitBusOracle.sol",children:(0,r.jsx)(a.code,{children:"ValidatorsExitBusOracle"})})," en tus herramientas."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.a,{href:"https://github.com/lidofinance/validator-ejector/blob/d72cac9767a57936f29c5b54e7de4f74344342de/src/services/execution-api/service.ts#L160-L203",children:"Ejemplo en el Ejector"})}),"\n",(0,r.jsx)(a.h2,{id:"cu\xe1ntas-claves-pre-firmar",children:"\xbfCu\xe1ntas Claves Pre-firmar?"}),"\n",(0,r.jsx)(a.p,{children:"Los Operadores de Nodo deben pre-firmar una cantidad o porcentaje de validadores con los que se sientan c\xf3modos gestionando. Cantidades m\xe1s peque\xf1as significan recargas m\xe1s frecuentes y viceversa."}),"\n",(0,r.jsx)(a.p,{children:"Para preparativos de Retiros, por ejemplo, se sugiere pre-firmar retiros para el 10% de los validadores. Despu\xe9s de eso, depender\xe1 de la demanda de Retiros y de las preferencias del Operador de Nodo."}),"\n",(0,r.jsx)(a.h2,{id:"c\xf3mo-entender-qu\xe9-claves-pre-firmar",children:"C\xf3mo Entender Qu\xe9 Claves Pre-firmar"}),"\n",(0,r.jsx)(a.h3,{id:"usando-kapi-recomendado",children:"Usando KAPI (recomendado)"}),"\n",(0,r.jsx)(a.p,{children:"El primer endpoint devuelve una lista de validadores para un Operador de Nodo espec\xedfico, para los cuales generar y firmar mensajes de salida a continuaci\xf3n:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.code,{children:"/v1/modules/{module_id}/validators/validator-exits-to-prepare/{operator_id}"})}),"\n",(0,r.jsx)(a.p,{children:"Devuelve datos:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'[\n  {\n    "validatorIndex": 123,\n    "key": "0x123"\n  }\n]\n'})}),"\n",(0,r.jsx)(a.p,{children:"Adem\xe1s, tambi\xe9n hay un segundo endpoint que calcula los mismos datos, pero devuelve mensajes de salida listos para firmar:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.code,{children:"/v1/modules/{module_id}/validators/generate-unsigned-exit-messages/{operator_id}"})}),"\n",(0,r.jsx)(a.admonition,{type:"danger",children:(0,r.jsxs)(a.p,{children:["Aseg\xfarate de inspeccionar visualmente los datos devueltos como precauci\xf3n, ya que los firmar\xe1s.\nPuedes encontrar el formato esperado en la secci\xf3n ",(0,r.jsx)(a.a,{href:"#qu%C3%A9-son-los-mensajes-de-salida",children:"\xbfQu\xe9 son los Mensajes de Salida?"}),"."]})}),"\n",(0,r.jsx)(a.p,{children:"Devuelve datos:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'[\n  {\n    "validator_index": "123",\n    "epoch": "123"\n  }\n]\n'})}),"\n",(0,r.jsx)(a.p,{children:"Adem\xe1s, ambos endpoints permiten configuraci\xf3n adicional a trav\xe9s de par\xe1metros de consulta:"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"percent"})," - Porcentaje de validadores para devolver datos. El valor predeterminado es 10."]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.code,{children:"max_amount"})," - N\xfamero m\xe1ximo de validadores para devolver datos. Si el n\xfamero de validadores es menor que la cantidad especificada, se devuelven todos los validadores."]}),"\n"]}),"\n",(0,r.jsx)(a.admonition,{type:"info",children:(0,r.jsxs)(a.p,{children:["Nota: Solo un par\xe1metro est\xe1 activo a la vez. Si se proporcionan ambos, ",(0,r.jsx)(a.code,{children:"percent"})," tiene prioridad."]})}),"\n",(0,r.jsx)(a.p,{children:"KAPI filtrar\xe1 autom\xe1ticamente los validadores que ya est\xe1n retirados o que est\xe1n en proceso de retiro, por lo que solo se necesita una llamada a KAPI."}),"\n",(0,r.jsx)(a.h3,{id:"manualmente",children:"Manualmente"}),"\n",(0,r.jsx)(a.p,{children:"Si tus claves de firmado de validador se almacenan en orden de generaci\xf3n, simplemente puedes comenzar la generaci\xf3n y firma de salidas desde las claves m\xe1s antiguas, ya que el algoritmo de salida es determinista y elegir\xe1 las claves m\xe1s antiguas primero para cada Operador de Nodo."}),"\n",(0,r.jsx)(a.p,{children:"Sin embargo, para cada lote, deber\xe1s realizar un seguimiento del \xfaltimo mensaje de salida generado o consultar los estados de los validadores en el Nodo de Consenso para entender d\xf3nde comenzar despu\xe9s."}),"\n",(0,r.jsx)(a.h2,{id:"almacenamiento-de-mensajes-de-salida-firmados",children:"Almacenamiento de Mensajes de Salida Firmados"}),"\n",(0,r.jsx)(a.p,{children:"Se desaconseja almacenar los mensajes de salida firmados tal como est\xe1n. Si un atacante obtiene acceso a ellos, simplemente los enviar\xe1, lo que har\xe1 que se retiren todos los validadores para los cuales ten\xedas mensajes de salida."}),"\n",(0,r.jsx)(a.p,{children:"Se recomienda cifrar los mensajes, por ejemplo, utilizando el script de cifrado proporcionado con el Ejector."}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.a,{href:"https://hackmd.io/@lido/BJvy7eWln#Encrypting-Messages",children:"C\xf3mo Usar el Encriptador del Ejector"})}),"\n",(0,r.jsxs)(a.p,{children:["Tambi\xe9n puedes revisar el ",(0,r.jsx)(a.a,{href:"https://github.com/lidofinance/validator-ejector/blob/develop/encryptor/encrypt.ts",children:"c\xf3digo fuente"})," e integrarlo en tus propias herramientas si es necesario."]}),"\n",(0,r.jsxs)(a.p,{children:["El Ejector descifra autom\xe1ticamente los archivos cifrados con ",(0,r.jsx)(a.a,{href:"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2335.md",children:"EIP-2335"})," al iniciar la aplicaci\xf3n."]}),"\n",(0,r.jsx)(a.h2,{id:"c\xf3mo-iniciar-un-retiro-de-validador",children:"C\xf3mo Iniciar un Retiro de Validador"}),"\n",(0,r.jsxs)(a.p,{children:["Los mensajes firmados se env\xedan a un Nodo de Consenso a trav\xe9s del endpoint ",(0,r.jsx)(a.code,{children:"/eth/v1/beacon/pool/voluntary_exits"})," para iniciar un retiro."]}),"\n",(0,r.jsx)(a.p,{children:"El Ejector har\xe1 esto autom\xe1ticamente cuando sea necesario."}),"\n",(0,r.jsx)(a.p,{children:"Si no ejecutas el Ejector, deber\xe1s hacerlo manualmente o desarrollar tus propias herramientas.\nSi tus mensajes de salida est\xe1n cifrados, deber\xe1s descifrarlos primero."})]})}function m(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>d});var r=n(6540);const s={},i=r.createContext(s);function o(e){const a=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function d(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:a},e.children)}}}]);