<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guías/oracle-spec/validator-exit-bus" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">validator-exit-bus | Lido Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://adminseedlatam.github.io/lido-docs-spanish/guías/oracle-spec/validator-exit-bus"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="validator-exit-bus | Lido Docs"><meta data-rh="true" name="description" content="Autobús de Salida de Validadores: Explicación Detallada"><meta data-rh="true" property="og:description" content="Autobús de Salida de Validadores: Explicación Detallada"><link data-rh="true" rel="canonical" href="https://adminseedlatam.github.io/lido-docs-spanish/guías/oracle-spec/validator-exit-bus"><link data-rh="true" rel="alternate" href="https://adminseedlatam.github.io/lido-docs-spanish/guías/oracle-spec/validator-exit-bus" hreflang="en"><link data-rh="true" rel="alternate" href="https://adminseedlatam.github.io/lido-docs-spanish/guías/oracle-spec/validator-exit-bus" hreflang="x-default"><link rel="stylesheet" href="/lido-docs-spanish/assets/css/styles.4b5e42a6.css">
<script src="/lido-docs-spanish/assets/js/runtime~main.833d019c.js" defer="defer"></script>
<script src="/lido-docs-spanish/assets/js/main.e0d0063e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lido-docs-spanish/"><div class="navbar__logo"><img src="/lido-docs-spanish/img/logo.svg" alt="Lido Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/lido-docs-spanish/img/logo.svg" alt="Lido Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lido Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/adminseedlatam/lido-docs-spanish" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lido-docs-spanish/">Introducción</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lido-docs-spanish/lido-dao">Lido DAO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lido-docs-spanish/guías/lido-tokens-integration-guide">Guía de integración de tokens de Lido</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/lido-docs-spanish/guías/node-operators/general-overview">Guías</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lido-docs-spanish/guías/node-operators/general-overview">Node Operators</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/oracle-operator-manual">Manual del Operador del Oráculo</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/lido-docs-spanish/guías/oracle-spec/accounting-oracle">Oracle specification</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/oracle-spec/accounting-oracle">Oráculo contable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus">validator-exit-bus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/oracle-spec/penalties">Validator exits and penalties</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/deposit-security-manual">Deposit Security Committee manual</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lido-docs-spanish/guías/tooling">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/multisig-deployment">Multisig deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/protocol-levers">Protocol levers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/etherscan-voting">DAO voting with Etherscan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/easy-track-guide">Guide to Easy Track</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/address-ownership-guide">Verifying address ownership for Lido DAO ops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/multisig-signer-manual">Guide to being a signer at any Lido DAO multisigs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/checking-aragon-vote">Checking the evm script from Aragon vote</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/checking-gnosis-safe">How to verify the multisig is a Gnosis one</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/1inch-pool-rewards">How to claim 1inch stETH/LDO pool rewards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/early-staker-airdrop">How to claim Lido early stakers airdrop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/jumpgates">How to Bridge Tokens through Jumpgate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lido-docs-spanish/guías/verify-lido-v2-upgrade-manual">Lido V2 mainnet parameters</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/integrations/api">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/guías-token/steth-superuser-functions">Guías Token</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/contracts/lido-locator">Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/security/bugbounty">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/lido-docs-spanish/deployed-contracts/">Deployed contracts</a><button aria-label="Expand sidebar category &#x27;Deployed contracts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/multisigs/emergency-brakes">Multisigs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/ipfs/about">IPFS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lido-docs-spanish/staking-modules/csm/intro">Staking Modules</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/lido-docs-spanish/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guías</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Oracle specification</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">validator-exit-bus</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>validator-exit-bus</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="autobús-de-salida-de-validadores-explicación-detallada">Autobús de Salida de Validadores: Explicación Detallada<a class="hash-link" aria-label="Direct link to Autobús de Salida de Validadores: Explicación Detallada" title="Direct link to Autobús de Salida de Validadores: Explicación Detallada" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#autobús-de-salida-de-validadores-explicación-detallada">​</a></h2>
<p>El <strong>Autobús de Salida de Validadores Oracle</strong> es un mecanismo dentro del protocolo Lido responsable de solicitar la salida de validadores para cubrir los retiros de los usuarios cuando el protocolo necesita fondos adicionales. Este documento describe paso a paso el proceso para calcular y ejecutar las salidas de los validadores.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pasos-para-el-cálculo-del-informe">Pasos para el Cálculo del Informe<a class="hash-link" aria-label="Direct link to Pasos para el Cálculo del Informe" title="Direct link to Pasos para el Cálculo del Informe" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#pasos-para-el-cálculo-del-informe">​</a></h3>
<ol>
<li><strong>Calcular la cantidad de retiros a cubrir con ether.</strong></li>
<li><strong>Calcular la predicción de recompensas en ether por época.</strong></li>
<li><strong>Calcular la época de retiro para el próximo validador elegible para salir y cubrir las solicitudes de retiro si es necesario.</strong></li>
<li><strong>Preparar la cola de orden de salida de validadores.</strong></li>
<li><strong>Recorrer la cola hasta que los saldos de los validadores salientes cubran todas las solicitudes de retiro (considerando el saldo final predicho de cada validador).</strong></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="algoritmo-para-el-próximo-validador-en-salir">Algoritmo para el Próximo Validador en Salir<a class="hash-link" aria-label="Direct link to Algoritmo para el Próximo Validador en Salir" title="Direct link to Algoritmo para el Próximo Validador en Salir" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#algoritmo-para-el-próximo-validador-en-salir">​</a></h3>
<p>El algoritmo para la salida de validadores se basa en el <a href="https://research.lido.fi/t/withdrawals-on-validator-exiting-order/3048#combined-approach-17" target="_blank" rel="noopener noreferrer">algoritmo descrito en el foro de investigación</a>.</p>
<p>El algoritmo supone corregir el número futuro de validadores para cada Operador de Nodo. Supongamos que los validadores y depósitos en proceso de uno de los Operadores de Nodo se representan de la siguiente manera, donde los validadores están ordenados por sus índices:</p>
<p><img decoding="async" loading="lazy" alt="VEBO 1" src="/lido-docs-spanish/assets/images/vebo-1-145f4921e5955dba11d50f16f253a99b.png" width="1000" height="160" class="img_ev3q"></p>
<p>El algoritmo asume que los validadores más antiguos salen primero. Por lo tanto, los validadores previamente solicitados se pueden separar para salir sabiendo el índice del último solicitado.</p>
<p><img decoding="async" loading="lazy" alt="VEBO 2" src="/lido-docs-spanish/assets/images/vebo-2-fa54c7fe656cf66c7e255590ee86ecf0.png" width="1000" height="160" class="img_ev3q"></p>
<p>Cabe destacar que cada validador tiene un estado. Algunos validadores pueden estar castigados o haber salido sin una solicitud del protocolo:</p>
<p><img decoding="async" loading="lazy" alt="VEBO 3" src="/lido-docs-spanish/assets/images/vebo-3-46967b3a524c0a3a468c05b85db3281f.png" width="1000" height="180" class="img_ev3q"></p>
<p>Entre todos los validadores, los proyectados son el punto de interés. Incluyen todos los validadores activos y depósitos en proceso, pero excluyen los validadores cuyo <code>exit_epoch != FAR_FUTURE_EPOCH</code> y aquellos validadores que fueron solicitados para salir.</p>
<p><img decoding="async" loading="lazy" alt="VEBO 4" src="/lido-docs-spanish/assets/images/vebo-4-35a93314617c2d7a596a0b331b05ebcd.png" width="1000" height="240" class="img_ev3q"></p>
<p>Unas horas después, podría verse de la siguiente manera:
<img decoding="async" loading="lazy" alt="VEBO 5" src="/lido-docs-spanish/assets/images/vebo-5-3ca953cdab240ac6a58164f07e42efeb.png" width="1000" height="240" class="img_ev3q"></p>
<p>Nota que el algoritmo descrito está buscando un validador para salir solo entre aquellos que pueden salir, mientras usa el número proyectado de validadores, que incluye validadores aún no existentes. Son solo ponderaciones, por lo que no hay malentendidos aquí.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secuencia-de-predicados-para-el-orden-de-salida">Secuencia de Predicados para el Orden de Salida<a class="hash-link" aria-label="Direct link to Secuencia de Predicados para el Orden de Salida" title="Direct link to Secuencia de Predicados para el Orden de Salida" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#secuencia-de-predicados-para-el-orden-de-salida">​</a></h3>
<ol>
<li>Validador cuyo operador tenga el menor número de validadores retrasados.</li>
<li>Validador cuyo operador tenga el mayor número de validadores objetivo para salir.</li>
<li>Validador cuyo operador tenga el mayor peso de participación.</li>
<li>Validador cuyo operador tenga el mayor número de validadores.</li>
<li>Validador con el índice más bajo.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtener-información-para-preparar-la-cola-ordenada">Obtener Información para Preparar la Cola Ordenada<a class="hash-link" aria-label="Direct link to Obtener Información para Preparar la Cola Ordenada" title="Direct link to Obtener Información para Preparar la Cola Ordenada" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-información-para-preparar-la-cola-ordenada">​</a></h3>
<p>Para preparar una cola de validadores para salir, se involucran las siguientes acciones y consideraciones:</p>
<ul>
<li>El número máximo de validadores que pueden ser solicitados para salir en un informe.</li>
<li>Porcentaje de penetración en la red del operador: solo si la participación del operador es mayor al 1%.</li>
<li>Validadores &#x27;exiteables&#x27; de Lido.</li>
<li>Obtener estadísticas de los operadores de nodos para ordenar los validadores exiteables.</li>
<li>Total de validadores predecibles.</li>
<li>Índices de los últimos validadores solicitados.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="límites-del-informe">Límites del Informe<a class="hash-link" aria-label="Direct link to Límites del Informe" title="Direct link to Límites del Informe" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#límites-del-informe">​</a></h3>
<ul>
<li><code>maxValidatorExitRequestsPerReport</code>: número máximo de solicitudes de salida permitidas en el informe al <code>ValidatorsExitBusOracle</code> desde <code>OracleReportSanityChecker.getOracleReportLimits()</code>.</li>
<li><code>VALIDATOR_DELAYED_TIMEOUT_IN_SLOTS</code>: un parámetro del contrato <code>OracleDaemonConfig</code> usado para calcular los validadores que van a salir.</li>
<li><code>NODE_OPERATOR_NETWORK_PENETRATION_THRESHOLD_BP</code>: un parámetro del <code>OracleDaemonConfig</code> que se tiene en cuenta al determinar la penetración del operador en la red.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtener-validadores-exiteables">Obtener Validadores Exiteables<a class="hash-link" aria-label="Direct link to Obtener Validadores Exiteables" title="Direct link to Obtener Validadores Exiteables" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-validadores-exiteables">​</a></h3>
<p>Un validador es &#x27;exiteable&#x27; si NO se cumplen estrictamente dos condiciones:</p>
<ul>
<li><code>validator.exit_epoch != FAR_FUTURE_EPOCH</code> y</li>
<li><code>validator.index &lt;= last_requested_to_exit_index</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="estadísticas-del-operador-de-nodo">Estadísticas del Operador de Nodo<a class="hash-link" aria-label="Direct link to Estadísticas del Operador de Nodo" title="Direct link to Estadísticas del Operador de Nodo" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#estadísticas-del-operador-de-nodo">​</a></h3>
<p>Estadísticas para cada operador de nodo, necesarias para ordenar sus validadores en orden de salida:</p>
<ul>
<li>Número de validadores que aún no están en CL.</li>
<li>Validadores que están en CL y aún no han sido solicitados para salir y no están en salida.</li>
<li>Validadores que están en CL y se han solicitado para salir pero no están en salida y no se han solicitado para salir recientemente.</li>
<li>Número objetivo de validadores.</li>
<li>Comprueba si la bandera de límite de objetivo está habilitada.</li>
</ul>
<p>NB: Un validador no puede considerarse retrasado si se solicitó su salida en los últimos <code>VALIDATOR_DELAYED_TIMEOUT_IN_SLOTS</code> slots.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="índices-de-los-últimos-validadores-solicitados">Índices de los Últimos Validadores Solicitados<a class="hash-link" aria-label="Direct link to Índices de los Últimos Validadores Solicitados" title="Direct link to Índices de los Últimos Validadores Solicitados" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#índices-de-los-últimos-validadores-solicitados">​</a></h3>
<p>El contrato <a href="/lido-docs-spanish/contracts/validators-exit-bus-oracle"><code>ValidatorsExitBusOracle</code></a> almacena el índice del último validador que se solicitó para salir. Dado que los validadores se solicitan en un orden estricto desde el <code>validatorIndex</code> más bajo hasta el más alto, los índices ayudan a encontrar todos los validadores solicitados previamente sin necesidad de obtener todos los eventos.</p>
<p>Devuelve los índices de los últimos validadores que se solicitaron para salir para los <code>operator_indexes</code> dados en el <code>module</code> dado. Para los operadores de nodo que nunca solicitaron la salida de ningún validador, el índice se establece en <code>-1</code>.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ValidatorsExitBusOracle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLastRequestedValidatorIndices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> moduleId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> nodeOpIds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">int256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recopilación-de-estado">Recopilación de Estado<a class="hash-link" aria-label="Direct link to Recopilación de Estado" title="Direct link to Recopilación de Estado" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#recopilación-de-estado">​</a></h3>
<p>Para encontrar los próximos validadores que saldrán, el Autobús de Salida de Validadores Oracle recopila el siguiente estado tanto de las capas de Consenso de Ethereum como de Ejecución.</p>
<ul>
<li>Del contrato <a href="/lido-docs-spanish/contracts/oracle-daemon-config">OracleDaemonConfig</a>:<!-- -->
<ul>
<li>PREDICTION_DURATION_IN_SLOTS</li>
<li>VALIDATOR_DELAYED_TIMEOUT_IN_SLOTS</li>
</ul>
</li>
<li>De la <a href="/lido-docs-spanish/contracts/withdrawal-queue-erc721">Cola de Retiros</a>:<!-- -->
<ul>
<li>Obtener la cantidad total de solicitudes de retiro no finalizadas</li>
</ul>
</li>
<li>Del contrato <a href="/lido-docs-spanish/contracts/lido">Lido</a>:<!-- -->
<ul>
<li>Balance reciente postCL/preCL y retiros de las recompensas de la Capa de Ejecución y de los cofres de retiro a través de eventos</li>
</ul>
</li>
<li>Del nodo de la Capa de Consenso:<!-- -->
<ul>
<li>Todos los validadores y sus estados en el slot de referencia</li>
</ul>
</li>
<li>Del <a href="/lido-docs-spanish/contracts/staking-router">Staking Router</a>:<!-- -->
<ul>
<li>Claves públicas de todos los validadores de Lido</li>
<li>Índices del último validador solicitado para salir para cada Operador de Nodo</li>
<li>Estadísticas de claves de validadores para cada Operador de Nodo</li>
</ul>
</li>
<li>Del contrato Oracle:<!-- -->
<ul>
<li>Número máximo de solicitudes de salida para el marco actual</li>
<li>Claves públicas solicitadas recientemente a través del Autobús de Salida</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtener-datos">Obtener Datos<a class="hash-link" aria-label="Direct link to Obtener Datos" title="Direct link to Obtener Datos" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-datos">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="obtener-la-cantidad-de-solicitudes-de-retiro-de-steth-no-cubiertas">Obtener la Cantidad de Solicitudes de Retiro de stETH No Cubiertas<a class="hash-link" aria-label="Direct link to Obtener la Cantidad de Solicitudes de Retiro de stETH No Cubiertas" title="Direct link to Obtener la Cantidad de Solicitudes de Retiro de stETH No Cubiertas" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-la-cantidad-de-solicitudes-de-retiro-de-steth-no-cubiertas">​</a></h4>
<p>Recopila la cantidad de stETH en la cola aún por finalizar de <code>WithdrawalQueue.unfinalizedStETH()</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="calcular-la-velocidad-promedio-de-recompensas-por-época">Calcular la Velocidad Promedio de Recompensas por Época<a class="hash-link" aria-label="Direct link to Calcular la Velocidad Promedio de Recompensas por Época" title="Direct link to Calcular la Velocidad Promedio de Recompensas por Época" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#calcular-la-velocidad-promedio-de-recompensas-por-época">​</a></h4>
<p>Obtiene los eventos <code>ETHDistributed</code> y <code>TokenRebased</code> del contrato <a href="/lido-docs-spanish/contracts/lido"><code>Lido</code></a> y calcula la cantidad promedio de recompensas por época. El período de predicción de recompensas se obtiene del contrato <a href="/lido-docs-spanish/contracts/oracle-daemon-config">OracleDaemonConfig</a>.</p>
<p>Para obtener eventos en el pasado, abordando los casos donde puede haber slots con bloque perdido, se introduce el siguiente esquema:</p>
<p><img decoding="async" loading="lazy" alt="VEBO 6" src="/lido-docs-spanish/assets/images/vebo-6-f4da2f2471dcb76ffd9a05a3abd9c0b5.png" width="3712" height="1888" class="img_ev3q"></p>
<ul>
<li>Obtener el valor <code>PREDICTION_DURATION_IN_SLOTS</code> del contrato <a href="/lido-docs-spanish/contracts/oracle-daemon-config">OracleDaemonConfig</a>.</li>
<li>Obtener eventos <code>TokenRebased</code> de Lido.</li>
<li>Obtener eventos <code>ETHDistributed</code> de Lido.</li>
<li>Agrupar esos eventos por hash de transacción.</li>
<li>Recopilar de los eventos:<!-- -->
<ul>
<li><code>total_rewards</code> como <code>postCLBalance + withdrawalsWithdrawn - preCLBalance executionLayerRewardsWithdrawn</code>.</li>
<li><code>time_spent</code> como suma de <code>timeElapsed</code> de cada evento.</li>
</ul>
</li>
<li>Calcular <code>rewards_speed_per_epoch</code> como <code>max(total_rewards * chain_configs.seconds_per_slot * chain_configs.slots_per_epoch // time_spent, 0)</code>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="calcular-las-épocas-necesarias-para-el-barrido">Calcular las Épocas Necesarias para el Barrido<a class="hash-link" aria-label="Direct link to Calcular las Épocas Necesarias para el Barrido" title="Direct link to Calcular las Épocas Necesarias para el Barrido" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#calcular-las-épocas-necesarias-para-el-barrido">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="predicción-promedio-del-barrido">Predicción Promedio del Barrido<a class="hash-link" aria-label="Direct link to Predicción Promedio del Barrido" title="Direct link to Predicción Promedio del Barrido" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#predicción-promedio-del-barrido">​</a></h5>
<p>Predice las épocas promedio del ciclo de barrido. En la especificación: <a href="https://github.com/ethereum/consensus-specs/blob/dev/specs/capella/beacon-chain.md#new-get_expected_withdrawals" target="_blank" rel="noopener noreferrer">get expected withdrawals</a>, <a href="https://github.com/ethereum/consensus-specs/blob/dev/specs/capella/beacon-chain.md#new-process_withdrawals" target="_blank" rel="noopener noreferrer">process withdrawals</a>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="validadores-retirables">Validadores retirables<a class="hash-link" aria-label="Direct link to Validadores retirables" title="Direct link to Validadores retirables" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#validadores-retirables">​</a></h5>
<ul>
<li>Verifica si <code>validator</code> tiene las credenciales de retiro &quot;eth1&quot; con prefijo 0x01, y</li>
<li>Verifica si <code>validator</code> es parcialmente retirable, o</li>
<li>Verifica si <code>validator</code> es completamente retirable</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="predicción-del-ether-disponible-antes-del-próximo-retiro">Predicción del ether disponible antes del próximo retiro<a class="hash-link" aria-label="Direct link to Predicción del ether disponible antes del próximo retiro" title="Direct link to Predicción del ether disponible antes del próximo retiro" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#predicción-del-ether-disponible-antes-del-próximo-retiro">​</a></h4>
<p>Para estimar la cantidad necesaria para cubrir completamente las solicitudes de retiro no finalizadas, se calculan los siguientes valores:</p>
<ul>
<li><strong>Recompensas futuras</strong></li>
<li><strong>Cantidad futura de retiros</strong></li>
<li><strong>Saldo total disponible</strong></li>
<li><strong>Suma acumulativa de los validadores a expulsar</strong></li>
<li><strong>Balance que se va a retirar</strong></li>
</ul>
<p>Para calcular las <strong>recompensas futuras</strong>, es necesario <a href="https://github.com/lidofinance/lido-oracle/blob/master/src/modules/ejector/ejector.py#L244" target="_blank" rel="noopener noreferrer">predecir</a> un epoch en el cual todos los validadores en la cola y <code>validators_to_eject</code> serán retirados:</p>
<ol>
<li>Calcula el número de epoch de salida más reciente y la cantidad de validadores que están saliendo en este epoch.</li>
<li>Si la cola está vacía, el epoch de salida se calculará como <code>epoch actual + MAX_SEED_LOOK AHEAD + 1</code>. La constante <strong>MAX_SEED_LOOKAHEAD</strong> ayuda a mitigar algunos ataques, m ás detalles <a href="https://eth2book.info/bellatrix/part3/config/preset/#max_seed_lookahead" target="_blank" rel="noopener noreferrer">aquí</a>.</li>
<li>Calcula el <strong>límite de churn</strong> - similar a un límite de velocidad en los cambios al conjunto de validadores. El mínimo es de 4 validadores por epoch y se recalcula cada <code>CHURN_LIMIT_QUOTIENT = 2**16</code>. Por ejemplo, cuando el número de validadores activos alcanza hasta 327,680, el límite de churn aumenta a 5, <a href="https://github.com/ethereum/consensus-specs/blob/master/specs/phase0/beacon-chain.md#get_validator_churn_limit" target="_blank" rel="noopener noreferrer">especificación</a>.</li>
<li>Calcula la capacidad de slots para la salida:</li>
</ol>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">remain_exits_capacity_for_epoch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> churn_limit </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cantidad de validadores que están saliendo en este epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>Calcula el epoch para retirar todos los <code>validators_to_eject_count</code>:</li>
</ol>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">epochs_required_to_exit_validators </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validators_to_eject_count </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> remain_exits_capacity_for_epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">//</span><span class="token plain"> churn_limit </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>Entonces el epoch predecible para retirar:</li>
</ol>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">withdrawal_epoch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> max_exit_epoch_number </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> epochs_required_to_exit_validators </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> MIN_VALIDATOR_WITHDRAWABILITY_DELAY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MIN_VALIDATOR_WITHDRAWABILITY_DELAY <a href="https://eth2book.info/altair/part3/config/configuration#min_validator_withdrawability_delay" target="_blank" rel="noopener noreferrer">aquí</a></p>
<p>Ahora podemos calcular la cantidad (y el número de validadores) necesarios para cubrir completamente la cantidad de solicitudes de retiro no finalizadas en la cola de retirada.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="calcular-el-saldo-esperado-a-retirar">Calcular el saldo esperado a retirar<a class="hash-link" aria-label="Direct link to Calcular el saldo esperado a retirar" title="Direct link to Calcular el saldo esperado a retirar" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#calcular-el-saldo-esperado-a-retirar">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="recompensas-futuras">Recompensas futuras<a class="hash-link" aria-label="Direct link to Recompensas futuras" title="Direct link to Recompensas futuras" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#recompensas-futuras">​</a></h5>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">future_rewards </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">withdrawal_epoch </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> epochs_to_sweep </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> blockstamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ref_epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> rewards_speed_per_epoch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="cantidad-futura-de-retiros">Cantidad futura de retiros<a class="hash-link" aria-label="Direct link to Cantidad futura de retiros" title="Direct link to Cantidad futura de retiros" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#cantidad-futura-de-retiros">​</a></h5>
<p>Obtener el saldo total de los validadores que pueden ser retirados completamente.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="saldo-total-disponible">Saldo total disponible<a class="hash-link" aria-label="Direct link to Saldo total disponible" title="Direct link to Saldo total disponible" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#saldo-total-disponible">​</a></h5>
<p>Obtén el saldo total como suma de:</p>
<ul>
<li><code>Lido.getBufferedEther()</code> +</li>
<li>Saldo de <code>elRewardsVault</code> +</li>
<li>Saldo de <code>withdrawalVault</code></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="suma-acumulativa-de-los-validadores-a-expulsar">Suma acumulativa de los validadores a expulsar<a class="hash-link" aria-label="Direct link to Suma acumulativa de los validadores a expulsar" title="Direct link to Suma acumulativa de los validadores a expulsar" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#suma-acumulativa-de-los-validadores-a-expulsar">​</a></h5>
<p>Obtén el saldo del próximo validador en la cola de salida.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="validadores-que-van-a-salir">Validadores que van a salir<a class="hash-link" aria-label="Direct link to Validadores que van a salir" title="Direct link to Validadores que van a salir" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#validadores-que-van-a-salir">​</a></h5>
<p>Recupera eventos <code>ValidatorExitRequest</code> emitidos recientemente del contrato <code>ValidatorsExitBusOracle</code> y extrae claves públicas de ellos. La configuración de timeout diferido se obtiene del contrato <code>OracleDaemonConfig</code>.</p>
<p>Validadores que han solicitado salir, pero no han enviado un mensaje de salida:</p>
<ul>
<li>Si el epoch de activación no es lo suficientemente antiguo para iniciar la salida.</li>
<li>Si el operador del nodo no tuvo suficiente tiempo para enviar el mensaje de salida (VALIDATOR_DELAYED_TIMEOUT_IN_SLOTS).</li>
</ul>
<p>Para obtener los validadores, el oráculo calcula:</p>
<ul>
<li><code>lido_validators_by_operator</code> - Recupera todas las claves Lido utilizadas desde <a href="https://github.com/lidofinance/lido-keys-api" target="_blank" rel="noopener noreferrer">Keys API</a> + Recupera todos los validadores en el slot de referencia y los fusiona con las claves.</li>
<li><code>ejected_indexes</code> - Obtiene los operadores con los últimos índices de validadores que han salido de todos los módulos de estaca y operadores de nodos mediante <code>ValidatorsExitBusOracle.getLastRequestedValidatorIndices(module_id, uint256[] nodeOpIds)</code>.</li>
<li><code>recent_pubkeys</code> - Obtiene las últimas claves públicas solicitadas para salir del evento <code>ValidatorExitRequest</code>.</li>
</ul>
<p>Para cada <code>lido_validators_by_operator</code>, el oráculo intenta encontrar <strong>validadores no salidos</strong>:</p>
<ul>
<li>Si no <code>validator_asked_to_exit</code> -&gt; devuelve Falso.</li>
<li>Si <code>is_on_exit</code> -&gt; devuelve Falso.</li>
<li>Si <code>validator_recently_asked_to_exit</code> -&gt; devuelve <strong>Verdadero</strong>.</li>
<li>Si no <code>validator_eligible_to_exit</code> -&gt; devuelve <strong>Verdadero</strong>.</li>
<li>De lo contrario, devuelve Falso.</li>
</ul>
<p>El oráculo calcula <code>going_to_withdraw_balance</code> para todos los <strong>validadores no salidos</strong>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="comparar-saldo-esperado-vs-saldo-a-retirar">Comparar saldo esperado vs. saldo a retirar<a class="hash-link" aria-label="Direct link to Comparar saldo esperado vs. saldo a retirar" title="Direct link to Comparar saldo esperado vs. saldo a retirar" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#comparar-saldo-esperado-vs-saldo-a-retirar">​</a></h5>
<p>El saldo esperado es:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">expected_balance = (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  future_withdrawals +  # Validadores que tienen epoch de retiro</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  future_rewards +  # Recompensas que obtenemos hasta que se retire el último validador en validators_to_eject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  total_available_balance +  # Saldo actual de EL (el vault, wc vault, buffered eth)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  validator_to_eject_balance_sum +  # Validadores que esperamos que sean expulsados (solicitados para salir, no demorados)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  going_to_withdraw_balance  # Saldo de validadores_to_eject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Primero, se verifica sin sacar al validador si el protocolo ya tiene suficiente ether disponible para cubrir las solicitudes de retiro en la cola. Si es así, no es razonable expulsar validadores.</p>
<p>Si no hay suficiente, se considera sacar a un validador más y se vuelve a calcular el saldo esperado. El proceso continúa hasta que el saldo esperado sea mayor o igual a la cantidad de solicitudes de retiro no finalizadas.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enlaces-útiles">Enlaces útiles<a class="hash-link" aria-label="Direct link to Enlaces útiles" title="Direct link to Enlaces útiles" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#enlaces-útiles">​</a></h2>
<ul>
<li><a href="https://github.com/lidofinance/lido-oracle" target="_blank" rel="noopener noreferrer">Código fuente de Lido Oracle</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/adminseedlatam/lido-docs-spanish/edit/main/docs/guías/oracle-spec/validator-exit-bus.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/lido-docs-spanish/guías/oracle-spec/accounting-oracle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Oráculo contable</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/lido-docs-spanish/guías/oracle-spec/penalties"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Validator exits and penalties</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#autobús-de-salida-de-validadores-explicación-detallada">Autobús de Salida de Validadores: Explicación Detallada</a><ul><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#pasos-para-el-cálculo-del-informe">Pasos para el Cálculo del Informe</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#algoritmo-para-el-próximo-validador-en-salir">Algoritmo para el Próximo Validador en Salir</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#secuencia-de-predicados-para-el-orden-de-salida">Secuencia de Predicados para el Orden de Salida</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-información-para-preparar-la-cola-ordenada">Obtener Información para Preparar la Cola Ordenada</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#límites-del-informe">Límites del Informe</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-validadores-exiteables">Obtener Validadores Exiteables</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#estadísticas-del-operador-de-nodo">Estadísticas del Operador de Nodo</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#índices-de-los-últimos-validadores-solicitados">Índices de los Últimos Validadores Solicitados</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#recopilación-de-estado">Recopilación de Estado</a></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#obtener-datos">Obtener Datos</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/lido-docs-spanish/guías/oracle-spec/validator-exit-bus#enlaces-útiles">Enlaces útiles</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>